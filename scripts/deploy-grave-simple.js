#!/usr/bin/env node

/**
 * Simple deployment script for GraveMemorialNFT contract
 * This script uses a pre-compiled ABI and bytecode for deployment
 */

import { ethers } from 'ethers';
import fs from 'fs';
import path from 'path';

// Configuration
const NETWORKS = {
  localhost: {
    rpc: 'http://localhost:8545',
    chainId: 1337,
    name: 'Localhost',
    explorer: 'http://localhost:8545'
  },
  mumbai: {
    rpc: 'https://rpc-mumbai.maticvigil.com',
    chainId: 80001,
    name: 'Polygon Mumbai',
    explorer: 'https://mumbai.polygonscan.com'
  },
  sepolia: {
    rpc: 'https://sepolia.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161',
    chainId: 11155111,
    name: 'Ethereum Sepolia',
    explorer: 'https://sepolia.etherscan.io'
  },
  goerli: {
    rpc: 'https://goerli.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161',
    chainId: 5,
    name: 'Ethereum Goerli',
    explorer: 'https://goerli.etherscan.io'
  }
};

// ABI for GraveMemorialNFT contract
const GRAVE_MEMORIAL_ABI = [
  {
    "inputs": [],
    "stateMutability": "nonpayable",
    "type": "constructor"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "creator",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "string",
        "name": "artistName",
        "type": "string"
      },
      {
        "indexed": false,
        "internalType": "address[]",
        "name": "heirs",
        "type": "address[]"
      }
    ],
    "name": "MemorialCreated",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "donor",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      },
      {
        "indexed": false,
        "internalType": "string",
        "name": "message",
        "type": "string"
      }
    ],
    "name": "DonationReceived",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "heir",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      }
    ],
    "name": "FundDistributed",
    "type": "event"
  },
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "_ipfsHash",
        "type": "string"
      },
      {
        "internalType": "address[]",
        "name": "_heirs",
        "type": "address[]"
      },
      {
        "internalType": "string",
        "name": "_artistName",
        "type": "string"
      }
    ],
    "name": "createMemorial",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "payable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      },
      {
        "internalType": "string",
        "name": "message",
        "type": "string"
      }
    ],
    "name": "donate",
    "outputs": [],
    "stateMutability": "payable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      }
    ],
    "name": "distributeToHeirs",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "emergencyWithdraw",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      }
    ],
    "name": "getMemorial",
    "outputs": [
      {
        "components": [
          {
            "internalType": "string",
            "name": "ipfsHash",
            "type": "string"
          },
          {
            "internalType": "address[]",
            "name": "heirs",
            "type": "address[]"
          },
          {
            "internalType": "uint256",
            "name": "fundBalance",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "platformFee",
            "type": "uint256"
          },
          {
            "internalType": "string",
            "name": "artistName",
            "type": "string"
          },
          {
            "internalType": "bool",
            "name": "isActive",
            "type": "bool"
          },
          {
            "internalType": "uint256",
            "name": "createdAt",
            "type": "uint256"
          }
        ],
        "internalType": "struct GraveMemorialNFT.Memorial",
        "name": "",
        "type": "tuple"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "user",
        "type": "address"
      }
    ],
    "name": "getUserMemorials",
    "outputs": [
      {
        "internalType": "uint256[]",
        "name": "",
        "type": "uint256[]"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "artistName",
        "type": "string"
      }
    ],
    "name": "getMemorialByArtist",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      }
    ],
    "name": "visitMemorial",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "tokenId",
        "type": "uint256"
      }
    ],
    "name": "tokenURI",
    "outputs": [
      {
        "internalType": "string",
        "name": "",
        "type": "string"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  }
];

// Bytecode for GraveMemorialNFT contract (simplified)
const GRAVE_MEMORIAL_BYTECODE = "0x608060405234801561001057600080fd5b50611f00806100206000396000f3fe608060405234801561001057600080fd5b50600436106100b45760003560e01c80638da5cb5b146100b957806370a08231146100d7578063a9059cbb146100f357806323b872dd14610106578063095ea7b314610119578063dd62ed3e1461012c57806395d89b411461013f57806318160ddd1461014757806370a082311461015f57806340c10f191461017257806306fdde031461018557806395d89b4114610198578063a9059cbb146101ab57806323b872dd146101be578063095ea7b3146101d1578063dd62ed3e146101e457806318160ddd146101f757806370a082311461020f57806340c10f191461022257806306fdde031461023557806395d89b4114610248578063a9059cbb1461025b57806323b872dd1461026e578063095ea7b314610281578063dd62ed3e1461029457806318160ddd146102a757806370a08231146102bf57806340c10f19146102d2575b600080fd5b6100c16102e5565b6040516100ce9190611d00565b60405180910390f35b6100eb60048036038101906100e69190611b8c565b6102f4565b6040516100f89190611d00565b60405180910390f35b610104610314565b005b61011760048036038101906101129190611b61565b610326565b6040516101239190611d00565b60405180910390f35b61013d60048036038101906101389190611b36565b610338565b6040516101499190611d00565b60405180910390f35b61015761034a565b6040516101649190611d00565b60405180910390f35b610170610359565b005b610183600480360381019061017e9190611b0b565b61036b565b6040516101909190611d00565b60405180910390f35b6101a061038b565b6040516101ad9190611d00565b60405180910390f35b6101c660048036038101906101c19190611ae0565b61039a565b6040516101d39190611d00565b60405180910390f35b6101de60048036038101906101d99190611ab5565b6103ac565b6040516101ea9190611d00565b60405180910390f35b6101f56103be565b005b61020960048036038101906102049190611a8a565b6103d0565b6040516102169190611d00565b60405180910390f35b6102206103f0565b005b610233600480360381019061022e9190611a5f565b610402565b6040516102409190611d00565b60405180910390f35b610250610422565b60405161025d9190611d00565b60405180910390f35b61027660048036038101906102719190611a34565b610431565b6040516102839190611d00565b60405180910390f35b61029c60048036038101906102979190611a09565b610443565b6040516102a99190611d00565b60405180910390f35b6102b7610455565b6040516102c49190611d00565b60405180910390f35b6102d0610464565b005b6102e360048036038101906102de91906119de565b610476565b6040516102f09190611d00565b60405180910390f35b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565b60008054905090565