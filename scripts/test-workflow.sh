#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è NORMALDANCE Enterprise Automation Workflow

echo "üöÄ –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è NORMALDANCE Enterprise Automation Workflow..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."

if ! command -v node &> /dev/null; then
    echo "‚ùå Node.js –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º."
    exit 1
fi

if ! command -v npm &> /dev/null; then
    echo "‚ùå npm –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ npm –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ ChromaDB
if ! curl -s http://localhost:8000 &> /dev/null; then
    echo "‚ö†Ô∏è ChromaDB –Ω–µ –∑–∞–ø—É—â–µ–Ω –Ω–∞ localhost:8000. –ó–∞–ø—É—Å—Ç–∏—Ç–µ ChromaDB –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è."
else
    echo "‚úÖ ChromaDB –¥–æ—Å—Ç—É–ø–µ–Ω"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ n8n
if ! curl -s http://localhost:5678 &> /dev/null; then
    echo "‚ö†Ô∏è n8n –Ω–µ –∑–∞–ø—É—â–µ–Ω –Ω–∞ localhost:5678. –ó–∞–ø—É—Å—Ç–∏—Ç–µ n8n –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è."
else
    echo "‚úÖ n8n –¥–æ—Å—Ç—É–ø–µ–Ω"
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
if [ ! -d "node_modules" ]; then
    echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
    npm install
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."

# –ó–∞–ø—É—Å–∫–∞–µ–º unit —Ç–µ—Å—Ç—ã
echo "üìã –ó–∞–ø—É—Å–∫ unit —Ç–µ—Å—Ç–æ–≤..."
npm test -- --testPathPattern="unit" --passWithNoTests

# –ó–∞–ø—É—Å–∫–∞–µ–º integration —Ç–µ—Å—Ç—ã
echo "üîó –ó–∞–ø—É—Å–∫ integration —Ç–µ—Å—Ç–æ–≤..."
npm test -- --testPathPattern="integration" --passWithNoTests

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã workflow
echo "üîÑ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ workflow..."
npm test -- --testPathPattern="workflow-integration" --passWithNoTests

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
if [ $? -eq 0 ]; then
    echo "‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!"
else
    echo "‚ùå –û–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤ –Ω–µ –ø—Ä–æ—à–ª–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
echo "üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º MemoryBank
echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ MemoryBank..."
node -e "
const { ChromaSetup } = require('./memorybank/chroma-setup');
const setup = new ChromaSetup();
setup.initialize()
    .then(() => console.log('‚úÖ MemoryBank —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ'))
    .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ –≤ MemoryBank:', err.message));
"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º Todoist –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω)
if [ ! -z "$TODOIST_TOKEN" ]; then
    echo "‚úÖ Todoist –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω"
else
    echo "‚ö†Ô∏è Todoist —Ç–æ–∫–µ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω)
if [ ! -z "$OPENAI_API_KEY" ]; then
    echo "ü§ñ AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω"
else
    echo "‚ö†Ô∏è OpenAI —Ç–æ–∫–µ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è"
fi

echo "üéâ –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üìã –†–µ–∑—é–º–µ:"
echo "   - Unit —Ç–µ—Å—Ç—ã: –ó–ê–í–ï–†–®–ï–ù–´"
echo "   - Integration —Ç–µ—Å—Ç—ã: –ó–ê–í–ï–†–®–ï–ù–´" 
echo "   - Workflow —Ç–µ—Å—Ç—ã: –ó–ê–í–ï–†–®–ï–ù–´"
echo "   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: –ó–ê–í–ï–†–®–ï–ù–ê"
echo ""
echo "‚úÖ NORMALDANCE Enterprise Automation Workflow –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!"