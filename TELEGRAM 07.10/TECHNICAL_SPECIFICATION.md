# Технический спецификационный документ: TELEGRAM 07.10

## 1. Введение

### 1.1 Назначение документа

Данный технический спецификационный документ описывает архитектуру, функциональность и технические характеристики проекта TELEGRAM 07.10 — платформы для создания и продажи музыкальных NFT с интеграцией Telegram Mini App.

### 1.2 Обзор проекта

Проект TELEGRAM 07.10 представляет собой современную платформу для создания и торговли музыкальными NFT, интегрированную с Telegram через Mini App. Платформа поддерживает два блокчейна (Solana и TON) и предоставляет пользователям возможность майнтинга, покупки и воспроизведения музыки в виде NFT.

### 1.3 Целевая аудитория

- Разработчики платформы
- Архитекторы систем
- Тестировщики
- Системные администраторы
- Бизнес-аналитики

## 2. Архитектура системы

### 2.1 Общая архитектура

Проект построен на следующих технологических компонентах:

- **Frontend**: Next.js 15 с App Router, TypeScript 5, Tailwind CSS 4
- **UI**: shadcn/ui компоненты, Lucide React иконки
- **State Management**: Zustand, TanStack Query
- **Backend**: Node.js, Express (через Next.js API routes)
- **База данных**: Prisma ORM с SQLite
- **Аутентификация**: NextAuth.js
- **Web3**: Solana Pay, TON Connect, WalletConnect
- **Коммуникации**: Socket.IO для реального времени

### 2.2 Структура проекта

```
src/
├── app/                    # Next.js App Router pages
├── components/             # React компоненты
│   ├── ui/                # shadcn/ui компоненты
│   ├── telegram/          # Компоненты Telegram Mini App
│   ├── wallet/            # Компоненты кошельков
│   ├── music/             # Музыкальные компоненты
│   └── marketplace/       # Компоненты маркетплейса
├── lib/                    # Утилиты и конфигурации
├── types/                  # TypeScript типы
└── hooks/                  # Custom React хуки
```

### 2.3 Компоненты системы

1. **Telegram Mini App**: Интеграция с Telegram WebApp API
2. **Кошельки**: Поддержка Phantom (Solana) и TON Connect
3. **Маркетплейс**: Просмотр и покупка музыкальных NFT
4. **Музыкальный проигрыватель**: Воспроизведение музыки
5. **Загрузка музыки**: Для художников
6. **Дашборд художника**: Управление контентом
7. **История транзакций**: Отслеживание операций

## 3. Функциональность Telegram Mini App

### 3.1 Особенности интеграции

- Поддержка Telegram WebApp API через `window.Telegram.WebApp`
- Автоматическое определение окружения (Telegram vs Web)
- Использование Telegram темизации и UI компонентов
- Поддержка нативных функций Telegram: кнопки, уведомления, бэк-кнопку

### 3.2 Аутентификация

- Использует `initDataUnsafe.user` для получения данных пользователя
- Поддерживает проверку HMAC для безопасности
- Работает как в Telegram, так и в обычном браузере

### 3.3 Функции Telegram Mini App

- **Уведомления**: `showAlert` для пользовательских сообщений
- **Навигация**: Использование Telegram BackButton и MainButton
- **Темизация**: Автоматическое применение светлой/темной темы
- **Оптимизация**: Mobile Optimized для мобильных устройств

## 4. Интеграция с блокчейнами

### 4.1 Поддерживаемые блокчейны

1. **Solana**:

   - Использует Phantom wallet
   - Интеграция через Solana Pay
   - Поддержка SPL Token и NFT

2. **TON (The Open Network)**:
   - Интеграция через TON Connect
   - Поддержка TON NFT и токенов
   - Низкие комиссии и высокая скорость

### 4.2 Технологии Web3

- **WalletConnect**: Универсальный протокол подключения кошельков
- **Solana Pay**: Для криптовалютных платежей на Solana
- **TON Connect**: Для взаимодействия с TON блокчейном
- **Кастомные транзакции**: Собственные методы для работы с NFT

## 5. Система оплаты

### 5.1 Методы оплаты

1. **Telegram Stars**:

   - Нативная система оплаты Telegram
   - Низкая франшиза для пользователей
   - Простая интеграция через Bot API

2. **Solana Pay**:

   - Прямые криптовалютные платежи
   - Высокая скорость обработки транзакций
   - Низкие комиссии

3. **TON Connect**:
   - Платежи в TON валюте
   - Экстремально низкие комиссии
   - Высокая пропускная способность

### 5.2 Безопасность платежей

- Все транзакции проверяются on-chain
- Поддержка HMAC верификации данных
- Rate limiting для предотвращения abuse
- Санитизация всех входных данных

## 6. База данных

### 6.1 Схема базы данных

Система использует Prisma ORM с SQLite базой данных со следующими моделями:

#### Модель User (Пользователь)

- `id`: UUID
- `email`: Уникальный email
- `name`: Имя пользователя
- `solanaAddress`: Адрес Solana кошелька
- `tonAddress`: Адрес TON кошелька
- `telegramId`: ID Telegram пользователя
- `isArtist`: Флаг художника
- `createdAt`, `updatedAt`

#### Модель Track (Трек)

- `id`: UUID
- `title`: Название трека
- `genre`: Жанр
- `description`: Описание
- `coverArt`: URL обложки
- `audioUrl`: URL аудио файла
- `ipfsHash`: Хеш файла в IPFS
- `price`: Цена
- `currency`: Валюта (SOL или TON)
- `artistId`: ID художника
- `isMinted`: Флаг майнтинга
- `mintAddress`: Адрес NFT
- `createdAt`, `updatedAt`

#### Модель Nft (NFT)

- `id`: UUID
- `trackId`: ID трека
- `blockchain`: Блокчейн (SOL или TON)
- `mintAddress`: Адрес NFT
- `ownerAddress`: Адрес владельца
- `price`: Цена
- `currency`: Валюта
- `metadata`: Метаданные NFT
- `createdAt`, `updatedAt`

#### Модель Purchase (Покупка)

- `id`: UUID
- `nftId`: ID NFT
- `buyerId`: ID покупателя
- `price`: Цена
- `currency`: Валюта
- `transaction`: Хэш транзакции
- `createdAt`

#### Модель Transaction (Транзакция)

- `id`: UUID
- `userId`: ID пользователя
- `type`: Тип транзакции (MINT, PURCHASE, SALE)
- `blockchain`: Блокчейн
- `hash`: Хэш транзакции
- `amount`: Сумма
- `currency`: Валюта
- `status`: Статус (PENDING, CONFIRMED, FAILED)
- `metadata`: Метаданные
- `createdAt`

## 7. API и маршруты

### 7.1 Основные API эндпоинты

1. **Health Check** (`/api/health`)

   - GET: Проверка состояния сервера

2. **Tracks** (`/api/tracks`)

   - GET: Получение списка треков с фильтрами
   - POST: Создание нового трека

3. **NFTs** (`/api/nfts`)

   - GET: Получение NFT информации
   - POST: Создание NFT

4. **Transactions** (`/api/transactions`)
   - GET: Получение истории транзакций
   - POST: Создание новой транзакции

### 7.2 Фильтрация и параметры

- Фильтрация по жанру, блокчейну и исполнителю
- Сортировка по дате создания
- Поддержка пагинации

## 8. Безопасность

### 8.1 Аутентификация и авторизация

- Использование NextAuth.js для управления сессиями
- HMAC верификация данных Telegram
- Защита от CSRF атак
- Проверка времени жизни токенов

### 8.2 Защита данных

- Шифрование чувствительных данных
- Контроль доступа на уровне ролей
- Логирование критических операций
- Соблюдение GDPR и других нормативов

### 8.3 Безопасность Web3

- Верификация транзакций on-chain
- Защита от повторных транзакций
- Контроль доступа к кошелькам
- Предотвращение атак типа "double spend"

## 9. Развертывание

### 9.1 Требования к среде

- Node.js 18+
- npm или yarn
- SQLite база данных
- Telegram Bot Token
- RPC endpoints для Solana и TON

### 9.2 Переменные окружения

```
NEXT_PUBLIC_APP_URL=https://your-app.com
NEXT_PUBLIC_TELEGRAM_BOT_TOKEN=your_telegram_bot_token
NEXT_PUBLIC_SOLANA_RPC_URL=https://api.mainnet-beta.solana.com
NEXT_PUBLIC_TON_RPC_URL=https://toncenter.com/api/v2/jsonRPC
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
DATABASE_URL=sqlite:./dev.db
```

### 9.3 Процесс развертывания

1. Установка зависимостей: `npm install`
2. Сборка приложения: `npm run build`
3. Запуск сервера: `npm start`
4. Настройка Telegram Bot через BotFather
5. Настройка WebApp URL в BotFather

### 9.4 Рекомендации по производительности

- Использование кэширования данных
- Оптимизация запросов к базе данных
- Минификация и оптимизация статики
- Использование CDN для медиафайлов

## 10. Технические ограничения

### 10.1 Технические ограничения

- Поддержка только Solana и TON блокчейнов
- Ограничения Telegram Mini App (ограниченный функционал)
- Зависимость от внешних сервисов (RPC, IPFS)

### 10.2 Планы развития

- Расширение поддержки других блокчейнов
- Интеграция с дополнительными платежными системами
- Улучшение UX/UI интерфейса
- Добавление функционала для аналитики

## 11. Заключение

Проект TELEGRAM 07.10 представляет собой современную платформу для создания и торговли музыкальными NFT с интеграцией Telegram Mini App. Архитектура проекта позволяет легко масштабироваться и расширяться, обеспечивая высокую степень безопасности и удобство использования для пользователей.
