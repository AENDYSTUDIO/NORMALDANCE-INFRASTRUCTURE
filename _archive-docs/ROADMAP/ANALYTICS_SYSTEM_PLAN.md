# –ü–ª–∞–Ω —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

## –û–±–∑–æ—Ä

–í —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ NormalDance. –≠—Ç–æ —É–ª—É—á—à–µ–Ω–∏–µ –∏–º–µ–µ—Ç –Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è Q3-Q4 2025 –≥–æ–¥–∞, —Ç–∞–∫ –∫–∞–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏ –ª—É—á—à–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

## –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

- –ë–∞–∑–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Google Analytics
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
- –ù–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤

### –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –ù–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ Web3-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏

## –¶–µ–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
- –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤ –¥–ª—è –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç—á–µ—Ç–æ–≤

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ü–µ–ª–∏

- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ Web3-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
- –°–∏—Å—Ç–µ–º–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ê–Ω–∞–ª–∏–∑ –∏ –≤—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–ù–µ–¥–µ–ª—è 1-2)

- –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ
- –í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ö–µ–º—ã —Å–æ–±—ã—Ç–∏–π

### –≠—Ç–∞–ø 2: Backend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–ù–µ–¥–µ–ª—è 3-4)

- –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ —Å–æ–±—ã—Ç–∏–π
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è API –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### –≠—Ç–∞–ø 3: Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ù–µ–¥–µ–ª—è 5-6)

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Web3-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ SDK
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

### –≠—Ç–∞–ø 4: –î–∞—à–±–æ—Ä–¥—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (–ù–µ–¥–µ–ª—è 7-8)

- –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤ –¥–ª—è –º–µ—Ç—Ä–∏–∫
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç—á–µ—Ç–æ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UX

### –≠—Ç–∞–ø 5: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ (–ù–µ–¥–µ–ª—è 9)

- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

#### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

```prisma
// schema.prisma
model AnalyticsEvent {
  id          String     @id @default(cuid())
  userId      String?    // –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
  user        User?      @relation(fields: [userId], references: [id])
  sessionId   String
  eventName   String
 properties  Json       // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Å–æ–±—ã—Ç–∏—è
  timestamp   DateTime   @default(now())
  userAgent   String?
  ip          String?
  pageUrl     String?
  referrer    String?

  @@index([userId])
  @@index([eventName])
  @@index([timestamp])
  @@index([sessionId])
}

model UserBehaviorMetric {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  metricName    String   // –Ω–∞–ø—Ä–∏–º–µ—Ä, "session_duration", "tracks_played", "nfts_purchased"
  metricValue   Decimal
  periodStart   DateTime
  periodEnd     DateTime
  createdAt     DateTime @default(now())

  @@index([userId, metricName])
  @@index([periodStart])
}

model BusinessMetric {
  id            String   @id @default(cuid())
  metricName    String   // –Ω–∞–ø—Ä–∏–º–µ—Ä, "daily_active_users", "revenue", "conversion_rate"
  metricValue   Decimal
  periodStart   DateTime
  periodEnd     DateTime
  createdAt     DateTime @default(now())

  @@index([metricName])
  @@index([periodStart])
}

model AnalyticsDashboard {
  id          String   @id @default(cuid())
  name        String
  description String?
  userId      String   // –í–ª–∞–¥–µ–ª–µ—Ü –¥–∞—à–±–æ—Ä–¥–∞ (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤)
 config      Json     // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–∞
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([isPublic])
}
```

### –°–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

#### –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

```typescript
// src/lib/analytics-service.ts
import { prisma } from "@/lib/db";

export interface AnalyticsEventInput {
  userId?: string;
  sessionId: string;
  eventName: string;
  properties?: any;
  userAgent?: string;
  ip?: string;
  pageUrl?: string;
  referrer?: string;
}

export class AnalyticsService {
  static async trackEvent(event: AnalyticsEventInput): Promise<void> {
    try {
      await prisma.analyticsEvent.create({
        data: {
          userId: event.userId,
          sessionId: event.sessionId,
          eventName: event.eventName,
          properties: event.properties || {},
          userAgent: event.userAgent,
          ip: event.ip,
          pageUrl: event.pageUrl,
          referrer: event.referrer,
        },
      });
    } catch (error) {
      console.error("Error tracking analytics event:", error);
      // –ù–µ –±—Ä–æ—Å–∞–µ–º –æ—à–∏–±–∫—É, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
    }
  }

  static async trackPageView(
    userId: string,
    sessionId: string,
    pageUrl: string,
    referrer?: string
  ): Promise<void> {
    await this.trackEvent({
      userId,
      sessionId,
      eventName: "page_view",
      properties: { pageUrl },
      pageUrl,
      referrer,
    });
  }

  static async trackTrackPlay(
    userId: string,
    sessionId: string,
    trackId: string,
    duration?: number
  ): Promise<void> {
    await this.trackEvent({
      userId,
      sessionId,
      eventName: "track_play",
      properties: {
        trackId,
        duration,
        isComplete: duration !== undefined, // –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —Ç—Ä–µ–∫ –ø—Ä–æ—Å–ª—É—à–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é
      },
    });
  }

  static async trackNFTPurchase(
    userId: string,
    sessionId: string,
    nftId: string,
    price: number
  ): Promise<void> {
    await this.trackEvent({
      userId,
      sessionId,
      eventName: "nft_purchase",
      properties: { nftId, price },
    });
  }

  static async trackWalletConnection(
    userId: string,
    sessionId: string,
    walletType: string
  ): Promise<void> {
    await this.trackEvent({
      userId,
      sessionId,
      eventName: "wallet_connected",
      properties: { walletType },
    });
  }

  static async trackStakeAction(
    userId: string,
    sessionId: string,
    action: string,
    amount: number
  ): Promise<void> {
    await this.trackEvent({
      userId,
      sessionId,
      eventName: "stake_action",
      properties: { action, amount },
    });
  }

  // –ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
  static async getUserBehavior(userId: string, days: number = 30) {
    const startDate = new Date(Date.now() - days * 24 * 60 * 60 * 1000);

    const events = await prisma.analyticsEvent.findMany({
      where: {
        userId,
        timestamp: { gte: startDate },
      },
      orderBy: { timestamp: "desc" },
    });

    // –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    const stats = {
      totalEvents: events.length,
      pageViews: events.filter((e) => e.eventName === "page_view").length,
      trackPlays: events.filter((e) => e.eventName === "track_play").length,
      nftPurchases: events.filter((e) => e.eventName === "nft_purchase").length,
      walletConnections: events.filter(
        (e) => e.eventName === "wallet_connected"
      ).length,
    };

    return { events, stats };
  }

  static async getDailyActiveUsers(date: Date) {
    const startOfDay = new Date(date.setHours(0, 0, 0, 0));
    const endOfDay = new Date(date.setHours(23, 59, 59, 999));

    const uniqueUsers = await prisma.analyticsEvent.groupBy({
      by: ["userId"],
      where: {
        timestamp: {
          gte: startOfDay,
          lt: endOfDay,
        },
        userId: { not: null },
      },
      _count: true,
    });

    return uniqueUsers.length;
  }

  static async getRevenueMetrics(startDate: Date, endDate: Date) {
    const purchaseEvents = await prisma.analyticsEvent.findMany({
      where: {
        eventName: "nft_purchase",
        timestamp: {
          gte: startDate,
          lt: endDate,
        },
      },
    });

    const totalRevenue = purchaseEvents.reduce((sum, event) => {
      const price = event.properties["price"] as number;
      return sum + (price || 0);
    }, 0);

    return {
      totalRevenue,
      totalPurchases: purchaseEvents.length,
      averageOrderValue:
        purchaseEvents.length > 0 ? totalRevenue / purchaseEvents.length : 0,
    };
  }
}
```

### API –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

#### API-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

```typescript
// src/app/api/analytics/events/route.ts
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { AnalyticsService } from "@/lib/analytics-service";

export async function POST(request: NextRequest) {
  const session = await getServerSession(authOptions);

  try {
    const body = await request.json();
    const { eventName, properties, sessionId } = body;

    if (!eventName || !sessionId) {
      return NextResponse.json(
        { error: "Missing required fields" },
        { status: 400 }
      );
    }

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
    await AnalyticsService.trackEvent({
      userId: session?.user?.id,
      sessionId,
      eventName,
      properties,
      userAgent: request.headers.get("user-agent") || undefined,
      ip:
        request.headers.get("x-forwarded-for")?.split(",")[0]?.trim() ||
        undefined,
      pageUrl: request.url,
    });

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error("Error tracking event:", error);
    return NextResponse.json(
      { error: "Internal Server Error" },
      { status: 500 }
    );
  }
}

// src/app/api/analytics/metrics/route.ts
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { AnalyticsService } from "@/lib/analytics-service";

export async function GET(request: NextRequest) {
  const session = await getServerSession(authOptions);

  if (!session || session.user.role !== "admin") {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  try {
    const { searchParams } = new URL(request.url);
    const metricType = searchParams.get("type");
    const startDate = searchParams.get("startDate");
    const endDate = searchParams.get("endDate");

    let result;

    switch (metricType) {
      case "daily-active-users":
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: –ø–æ–ª—É—á–µ–Ω–∏–µ DAU –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
        result = await getDailyActiveUsersMetric(startDate, endDate);
        break;
      case "revenue":
        const start = startDate
          ? new Date(startDate)
          : new Date(Date.now() - 30 * 24 * 60 * 1000);
        const end = endDate ? new Date(endDate) : new Date();
        result = await AnalyticsService.getRevenueMetrics(start, end);
        break;
      case "user-behavior":
        if (!searchParams.get("userId")) {
          return NextResponse.json(
            { error: "userId is required for user-behavior" },
            { status: 400 }
          );
        }
        result = await AnalyticsService.getUserBehavior(
          searchParams.get("userId")!,
          30
        );
        break;
      default:
        return NextResponse.json(
          { error: "Invalid metric type" },
          { status: 400 }
        );
    }

    return NextResponse.json(result);
  } catch (error) {
    console.error("Error fetching metrics:", error);
    return NextResponse.json(
      { error: "Internal Server Error" },
      { status: 500 }
    );
  }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è DAU
async function getDailyActiveUsersMetric(startDate?: string, endDate?: string) {
  const start = startDate
    ? new Date(startDate)
    : new Date(Date.now() - 30 * 24 * 60 * 1000);
  const end = endDate ? new Date(endDate) : new Date();

  // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è DAU
  // –ø–æ –¥–Ω—è–º –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
  const days = Math.ceil(
    (end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)
  );
  const dauData = [];

  for (let i = 0; i < Math.min(days, 30); i++) {
    const date = new Date(end);
    date.setDate(date.getDate() - i);
    const dau = await AnalyticsService.getDailyActiveUsers(new Date(date));

    dauData.push({
      date: date.toISOString().split("T")[0],
      dau,
    });
  }

  return {
    dauData,
    average: dauData.reduce((sum, day) => sum + day.dau, 0) / dauData.length,
  };
}
```

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π SDK –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

#### –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π SDK –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π

```typescript
// src/lib/client-analytics.ts
declare global {
  interface Window {
    analytics: any;
  }
}

export class ClientAnalytics {
  private static instance: ClientAnalytics;
  private sessionId: string;
  private userId: string | null = null;
  private initialized: boolean = false;

  private constructor() {
    this.sessionId = this.generateSessionId();
    this.init();
  }

  static getInstance(): ClientAnalytics {
    if (!ClientAnalytics.instance) {
      ClientAnalytics.instance = new ClientAnalytics();
    }
    return ClientAnalytics.instance;
  }

  private init() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    this.initialized = true;

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    this.trackPageView(window.location.href);

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–¥–ª—è SPA)
    this.setupNavigationTracking();
  }

  private generateSessionId(): string {
    return Date.now().toString(36) + Math.random().toString(36).substr(2);
  }

  private setupNavigationTracking() {
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
    let currentUrl = window.location.href;

    // –î–ª—è Next.js —Ä–æ—É—Ç–∏–Ω–≥–∞
    if (typeof window !== "undefined" && (window as any).next) {
      // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Next.js —Ä–æ—É—Ç–∏–Ω–≥–æ–º
      const handleRouteChange = (url: string) => {
        this.trackPageView(url);
      };

      // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è —Ä–æ—É—Ç–∏–Ω–≥–∞ Next.js
    }

    // –î–ª—è –æ–±—ã—á–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    const handlePopState = () => {
      if (window.location.href !== currentUrl) {
        this.trackPageView(window.location.href);
        currentUrl = window.location.href;
      }
    };

    window.addEventListener("popstate", handlePopState);
  }

  async identify(userId: string) {
    this.userId = userId;
  }

  async track(eventName: string, properties: any = {}) {
    if (!this.initialized) return;

    try {
      await fetch("/api/analytics/events", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          eventName,
          properties,
          sessionId: this.sessionId,
          userId: this.userId,
        }),
      });
    } catch (error) {
      console.error("Error sending analytics event:", error);
    }
  }

  trackPageView(pageUrl: string, referrer?: string) {
    this.track("page_view", {
      pageUrl,
      referrer: referrer || document.referrer,
    });
  }

  trackTrackPlay(trackId: string, duration?: number) {
    this.track("track_play", { trackId, duration });
  }

  trackNFTPurchase(nftId: string, price: number) {
    this.track("nft_purchase", { nftId, price });
  }

  trackWalletConnection(walletType: string) {
    this.track("wallet_connected", { walletType });
  }

  trackButtonClick(elementId: string, elementText?: string) {
    this.track("button_click", {
      elementId,
      elementText,
      pageUrl: window.location.href,
    });
  }

  // –ú–µ—Ç–æ–¥ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–ª–∏–∫–æ–≤
  setupAutoTracking() {
    document.addEventListener("click", (event) => {
      const target = event.target as HTMLElement;

      // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–Ω–æ–ø–∫–∞–º –∏ —Å—Å—ã–ª–∫–∞–º
      if (target.tagName === "BUTTON" || target.tagName === "A") {
        const elementId =
          target.id || target.textContent?.substring(0, 20) || "unknown";
        this.trackButtonClick(
          target.tagName === "A" ? target.href : elementId,
          target.textContent || ""
        );
      }
    });
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
export const analytics = ClientAnalytics.getInstance();
```

### –î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–∞—à–±–æ—Ä–¥–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

```tsx
// src/app/admin/analytics/page.tsx
'use client';

import { useState, useEffect } from 'react';
import { DashboardLayout } from '@/components/admin/DashboardLayout';
import {
  LineChart,
  Line,
 BarChart,
 Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer
} from 'recharts';

const AnalyticsDashboard = () => {
  const [metrics, setMetrics] = useState<any>(null);
  const [loading, setLoading] = useState(true);
 const [dateRange, setDateRange] = useState('7d');

  useEffect(() => {
    const fetchMetrics = async () => {
      try {
        const response = await fetch(`/api/analytics/metrics?type=daily-active-users&startDate=${getDateRangeStart(dateRange)}`);
        const data = await response.json();
        setMetrics(data);
      } catch (error) {
        console.error('Error fetching metrics:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchMetrics();
  }, [dateRange]);

  const getDateRangeStart = (range: string) => {
    const today = new Date();
    switch (range) {
      case '7d':
        today.setDate(today.getDate() - 7);
        break;
      case '30d':
        today.setDate(today.getDate() - 30);
        break;
      case '90d':
        today.setDate(today.getDate() - 90);
        break;
      default:
        today.setDate(today.getDate() - 7);
    }
    return today.toISOString().split('T')[0];
  };

  if (loading) {
    return (
      <DashboardLayout>
        <div className="flex justify-center items-center h-64">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-60"></div>
        </div>
      </DashboardLayout>
    );
  }

  return (
    <DashboardLayout>
      <div className="space-y-6">
        <div className="flex justify-between items-center">
          <h1 className="text-2xl font-bold">Analytics Dashboard</h1>
          <div className="flex space-x-2">
            <select
              value={dateRange}
              onChange={(e) => setDateRange(e.target.value)}
              className="border border-gray-300 rounded-md px-3 py-2"
            >
              <option value="7d">Last 7 days</option>
              <option value="30d">Last 30 days</option>
              <option value="90d">Last 90 days</option>
            </select>
          </div>

        {/* –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <MetricCard
            title="Daily Active Users"
            value={metrics?.dauData?.slice(-1)[0]?.dau || 0}
            change={calculateChange(metrics?.dauData)}
            icon="üë§"
          />
          <MetricCard
            title="Total Revenue"
            value={`$${(metrics?.revenue?.totalRevenue || 0).toFixed(2)}`}
            change={0}
            icon="üí∞"
          />
          <MetricCard
            title="NFT Sales"
            value={metrics?.nftSales || 0}
            change={0}
            icon="üñºÔ∏è"
          />
          <MetricCard
            title="Track Plays"
            value={metrics?.trackPlays || 0}
            change={0}
            icon="üéµ"
          />
        </div>

        {/* –ì—Ä–∞—Ñ–∏–∫–∏ */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {/* DAU –≥—Ä–∞—Ñ–∏–∫ */}
          <div className="bg-white rounded-lg shadow p-6">
            <h2 className="text-lg font-semibold mb-4">Daily Active Users</h2>
            <ResponsiveContainer width="10%" height={300}>
              <LineChart data={metrics?.dauData || []}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="date" />
                <YAxis />
                <Tooltip />
                <Legend />
                <Line type="monotone" dataKey="dau" stroke="#8884d8" activeDot={{ r: 8 }} />
              </LineChart>
            </ResponsiveContainer>
          </div>

          {/* –¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π */}
          <div className="bg-white rounded-lg shadow p-6">
            <h2 className="text-lg font-semibold mb-4">Event Distribution</h2>
            <ResponsiveContainer width="10%" height={300}>
              <BarChart data={[
                { name: 'Page Views', value: 1200 },
                { name: 'Track Plays', value: 800 },
                { name: 'NFT Purchases', value: 150 },
                { name: 'Wallet Connects', value: 300 },
                { name: 'Sign Ups', value: 50 }
              ]}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="name" />
                <YAxis />
                <Tooltip />
                <Legend />
                <Bar dataKey="value" fill="#82ca9d" />
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>

        {/* –¢–∞–±–ª–∏—Ü–∞ —Å–æ–±—ã—Ç–∏–π */}
        <div className="bg-white rounded-lg shadow p-6">
          <h2 className="text-lg font-semibold mb-4">Recent Events</h2>
          <div className="overflow-x-auto">
            <table className="min-w-full divide-y divide-gray-200">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Event</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Properties</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {/* –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: –¥–∞–Ω–Ω—ã–µ –∏–∑ API */}
                <tr>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">user123</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">track_play</td>
                  <td className="px-6 py-4 text-sm text-gray-500">{"{trackId: '456', duration: 180}"}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2 min ago</td>
                </tr>
                <tr>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">user456</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">nft_purchase</td>
                  <td className="px-6 py-4 text-sm text-gray-500">{"{nftId: '789', price: 0.5}"}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">5 min ago</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </DashboardLayout>
  );
};

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–µ—Ç—Ä–∏–∫–∏
const MetricCard = ({ title, value, change, icon }: any) => (
  <div className="bg-white rounded-lg shadow p-6">
    <div className="flex items-center justify-between">
      <div>
        <p className="text-sm font-medium text-gray-600">{title}</p>
        <p className="text-2xl font-semibold">{value}</p>
      </div>
      <div className="text-2xl">{icon}</div>
    </div>
    <p className={`text-sm mt-2 ${change >= 0 ? 'text-green-600' : 'text-red-600'}`}>
      {change >= 0 ? '‚Üë' : '‚Üì'} {Math.abs(change)}% from last period
    </p>
  </div>
);

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
const calculateChange = (data: any[]) => {
  if (!data || data.length < 2) return 0;

  const current = data[data.length - 1]?.dau || 0;
  const previous = data[data.length - 2]?.dau || 0;

  if (previous === 0) return current > 0 ? 100 : 0;

  return ((current - previous) / previous) * 100;
};
```

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ Web3-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π

#### –°–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ Web3-—Å–æ–±—ã—Ç–∏–π

```typescript
// src/lib/web3-analytics-service.ts
import { AnalyticsService } from "./analytics-service";

export class Web3AnalyticsService {
  static async trackWalletConnection(
    userId: string,
    sessionId: string,
    walletType: string
  ) {
    await AnalyticsService.trackEvent({
      userId,
      sessionId,
      eventName: "wallet_connected",
      properties: {
        walletType,
        timestamp: new Date().toISOString(),
      },
    });

    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    console.log(`Wallet connected: ${walletType} by user ${userId}`);
  }

  static async trackTransaction(
    userId: string,
    sessionId: string,
    transactionType: string,
    amount: number,
    token: string = "SOL"
  ) {
    await AnalyticsService.trackEvent({
      userId,
      sessionId,
      eventName: "web3_transaction",
      properties: {
        transactionType,
        amount,
        token,
        timestamp: new Date().toISOString(),
      },
    });
  }

  static async trackNFTMint(
    userId: string,
    sessionId: string,
    nftId: string,
    collection: string
  ) {
    await AnalyticsService.trackEvent({
      userId,
      sessionId,
      eventName: "nft_minted",
      properties: {
        nftId,
        collection,
        timestamp: new Date().toISOString(),
      },
    });
  }

  static async trackTokenSwap(
    userId: string,
    sessionId: string,
    fromToken: string,
    toToken: string,
    amount: number
  ) {
    await AnalyticsService.trackEvent({
      userId,
      sessionId,
      eventName: "token_swapped",
      properties: {
        fromToken,
        toToken,
        amount,
        timestamp: new Date().toISOString(),
      },
    });
  }

  static async trackStakeAction(
    userId: string,
    sessionId: string,
    action: string,
    amount: number,
    duration?: number
  ) {
    await AnalyticsService.trackEvent({
      userId,
      sessionId,
      eventName: "stake_action",
      properties: {
        action,
        amount,
        duration,
        timestamp: new Date().toISOString(),
      },
    });
  }
}
```

## –†–∏—Å–∫–∏ –∏ –º–µ—Ä—ã –ø–æ –∏—Ö —Å–Ω–∏–∂–µ–Ω–∏—é

### –†–∏—Å–∫ 1: –ù–∞—Ä—É—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏

- **–ú–µ—Ä–∞**: –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **–ú–µ—Ä–∞**: –°–æ–±–ª—é–¥–µ–Ω–∏–µ GDPR –∏ CCPA

### –†–∏—Å–∫ 2: –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã

- **–ú–µ—Ä–∞**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
- **–ú–µ—Ä–∞**: –ëatching –∑–∞–ø—Ä–æ—Å–æ–≤

### –†–∏—Å–∫ 3: –ù–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- **–ú–µ—Ä–∞**: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ú–µ—Ä–∞**: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–æ–≤

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

- –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –î–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
- –£–¥–æ–±–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã
- –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
- –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –†–µ—Å—É—Ä—Å—ã

- 2-3 —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –Ω–∞ 9 –Ω–µ–¥–µ–ª—å
- –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –¥–∞–Ω–Ω—ã–º –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∞—à–±–æ—Ä–¥–æ–≤
- QA-–∏–Ω–∂–µ–Ω–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –°—Ä–æ–∫–∏

- –ù–∞—á–∞–ª–æ: 1 –Ω–æ—è–±—Ä—è 2025
- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ: 6 –¥–µ–∫–∞–±—Ä—è 2025
- –û–±—â–µ–µ –≤—Ä–µ–º—è: 9 –Ω–µ–¥–µ–ª—å
