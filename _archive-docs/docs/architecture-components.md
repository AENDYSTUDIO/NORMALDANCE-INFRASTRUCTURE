# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã NORMAL DANCE v1.0.1

## üìã –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

NORMAL DANCE - —ç—Ç–æ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –º—É–∑—ã–∫–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–µ–±-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ Web3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

### üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π
- **–ë–µ–∑—Å–µ—Ä–≤–µ—Ä–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Kubernetes –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- **Web3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–ª–æ–∫—á–µ–π–Ω–æ–º Solana
- **–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è** - WebSocket –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üìä –°—Ö–µ–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     NORMAL DANCE v1.0.1                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Frontend Layer                                             ‚îÇ
‚îÇ  ‚îú‚îÄ Web App (Next.js 15)                                    ‚îÇ
‚îÇ  ‚îú‚îÄ Mobile App (React Native)                              ‚îÇ
‚îÇ  ‚îî‚îÄ Admin Panel (Next.js)                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  API Gateway Layer                                          ‚îÇ
‚îÇ  ‚îú‚îÄ Next.js API Routes                                      ‚îÇ
‚îÇ  ‚îú‚îÄ WebSocket Server (Socket.IO)                           ‚îÇ
‚îÇ  ‚îî‚îÄ Rate Limiting & Authentication                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Business Logic Layer                                       ‚îÇ
‚îÇ  ‚îú‚îÄ Audio Service                                           ‚îÇ
‚îÇ  ‚îú‚îÄ NFT Service                                             ‚îÇ
‚îÇ  ‚îú‚îÄ User Service                                            ‚îÇ
‚îÇ  ‚îú‚îÄ Wallet Service                                          ‚îÇ
‚îÇ  ‚îú‚îÄ Staking Service                                         ‚îÇ
‚îÇ  ‚îî‚îÄ Analytics Service                                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Data Layer                                                 ‚îÇ
‚îÇ  ‚îú‚îÄ PostgreSQL (Primary DB)                                ‚îÇ
‚îÇ  ‚îú‚îÄ Redis (Cache & Session)                                ‚îÇ
‚îÇ  ‚îú‚îÄ IPFS (File Storage)                                     ‚îÇ
‚îÇ  ‚îî‚îÄ Solana Blockchain                                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Infrastructure Layer                                       ‚îÇ
‚îÇ  ‚îú‚îÄ Kubernetes Cluster                                      ‚îÇ
‚îÇ  ‚îú‚îÄ Monitoring (Prometheus + Grafana)                      ‚îÇ
‚îÇ  ‚îú‚îÄ Logging (ELK Stack)                                    ‚îÇ
‚îÇ  ‚îî‚îÄ CDN (CloudFlare)                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üéµ –ê—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞

### üéº AudioPlayer –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

**–§–∞–π–ª:** [`src/components/audio/audio-player.tsx`](src/components/audio/audio-player.tsx:1)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞–º–∏ –∏ –æ—á–µ—Ä–µ–¥—å—é
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –≠–∫–≤–∞–ª–∞–π–∑–µ—Ä —Å –ø—Ä–µ—Å–µ—Ç–∞–º–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—Ä–µ–∫–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

#### 1. –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞
```typescript
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∑–≤—É–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ—Ç–∏
const audioSrc = useCallback(() => {
  if (!currentTrack) return ''
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞
  let quality = audioQualities.find(q => q.id === selectedQuality)
  if (!quality || selectedQuality === 'auto') {
    quality = audioQualities[1] // –°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  }
  
  // –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º –ø–æ–¥ —Å–µ—Ç—å
  const useLowQualityAudio = effectiveType === 'slow-2g' || effectiveType === '2g'
  
  if (useLowQualityAudio && quality.id !== 'low') {
    const lowQuality = audioQualities[0] // –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
    const parts = currentTrack.audioUrl.split('.')
    const extension = parts.pop()
    return `${parts.join('.')}_low.${extension}`
  }
  
  return currentTrack.audioUrl
}, [currentTrack, selectedQuality, effectiveType])
```

#### 2. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
```typescript
<AudioVisualizer
  audioElement={audioRef.current}
  isPlaying={isPlaying}
  type={visualizerType}
  color={visualizerColor}
  sensitivity={visualizerSensitivity}
/>
```

#### 3. –≠–∫–≤–∞–ª–∞–π–∑–µ—Ä —Å –ø—Ä–µ—Å–µ—Ç–∞–º–∏
```typescript
const equalizerPresets: EqualizerPreset[] = [
  {
    id: 'flat',
    name: '–ü–ª–æ—Å–∫–∏–π',
    settings: { bass: 0, mid: 0, treble: 0, gain: 0 },
    icon: <Square className="h-4 w-4" />
  },
  {
    id: 'bass_boost',
    name: '–£—Å–∏–ª–µ–Ω–∏–µ –±–∞—Å–∞',
    settings: { bass: 8, mid: 0, treble: -2, gain: 2 },
    icon: <Triangle className="h-4 w-4" />
  }
]
```

#### 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞–º–∏
```typescript
const handleCreatePlaylist = async () => {
  if (!newPlaylistName.trim()) return
  
  try {
    const playlist = await createPlaylist({
      name: newPlaylistName,
      description: newPlaylistDescription,
      isPublic: false
    })
    
    setPlaylists(prev => [...prev, playlist])
    setNewPlaylistName('')
    setNewPlaylistDescription('')
    setShowCreatePlaylist(false)
  } catch (error) {
    console.error('Error creating playlist:', error)
  }
}
```

### üéµ –ê—É–¥–∏–æ–∫–∞—á–µ—Å—Ç–≤–æ

| –ö–∞—á–µ—Å—Ç–≤–æ | –ë–∏—Ç—Ä–µ–π—Ç | –ß–∞—Å—Ç–æ—Ç–∞ | –†–∞–∑–º–µ—Ä | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
|----------|---------|---------|--------|-------------|
| –ù–∏–∑–∫–æ–µ | 64 kbps | 22.05 kHz | 2-5 MB | –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Å–µ—Ç—å |
| –°—Ä–µ–¥–Ω–µ–µ | 128 kbps | 44.1 kHz | 4-10 MB | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ |
| –í—ã—Å–æ–∫–æ–µ | 320 kbps | 48 kHz | 8-15 MB | –•–æ—Ä–æ—à–∏–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç |
| Lossless | 1411 kbps | 96 kHz | 20-40 MB | Hi-Fi –∞—É–¥–∏–æ |

## üí∞ Web3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### ü™ô Wallet Adapter

**–§–∞–π–ª:** [`src/components/wallet/wallet-adapter.tsx`](src/components/wallet/wallet-adapter.tsx:1)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—à–µ–ª—å–∫–æ–º Phantom
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Solana —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤
- –†–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏ NDT

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

#### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Solana
```typescript
export function createConnection(): Connection {
  return new Connection(RPC_URL, 'confirmed')
}
```

#### 2. –•—É–∫ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞
```typescript
export function useSolanaWallet() {
  const wallet = useWallet()
  const { connection } = useConnection()

  const connectWallet = async () => {
    if (!wallet.connected) {
      if (!wallet.connect) throw new Error('Wallet does not support connection')
      await wallet.connect()
    }
  }

  const sendTransaction = async (transaction: Transaction): Promise<string> => {
    if (!wallet.connected) throw new WalletNotConnectedError()
    if (!wallet.sendTransaction) throw new Error('Wallet does not support transaction sending')
    
    try {
      const signature = await wallet.sendTransaction(transaction, connection)
      return signature
    } catch (error) {
      console.error('Error sending transaction:', error)
      throw error
    }
  }
}
```

#### 3. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤
```typescript
export function formatAddress(address: PublicKey, length: number = 4): string {
  const str = address.toBase58()
  return `${str.slice(0, length)}...${str.slice(-length)}`
}
```

#### 4. –†–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏
```typescript
export function formatSol(amount: number): string {
  return new Intl.NumberFormat('ru-RU', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 6,
  }).format(amount)
}

export function formatTokens(amount: number, decimals: number = 9): string {
  return new Intl.NumberFormat('ru-RU', {
    minimumFractionDigits: 2,
    maximumFractionDigits: decimals,
  }).format(amount)
}
```

### üéµ Solana –ø—Ä–æ–≥—Ä–∞–º–º—ã

#### 1. NDT Token Program
```typescript
export const NDT_PROGRAM_ID = new PublicKey('NDT111111111111111111111111111111111111111')
export const NDT_MINT_ADDRESS = new PublicKey('11111111111111111111111111111111')
```

#### 2. TrackNFT Program
```typescript
export const TRACKNFT_PROGRAM_ID = new PublicKey('TRACKNFT111111111111111111111111111111111111111')
```

#### 3. Staking Program
```typescript
export const STAKING_PROGRAM_ID = new PublicKey('STAKING111111111111111111111111111111111111111')
```

## üéØ –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### ü§ñ Recommendation Engine

**–§–∞–π–ª:** [`src/components/recommendations/recommendation-engine.tsx`](src/components/recommendations/recommendation-engine.tsx:1)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π
- –ö–æ–ª–ª–∞–±–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- –¢—Ä–µ–Ω–¥–æ–≤—ã–µ —Ç—Ä–µ–∫–∏
- –°—Ö–æ–¥—Å—Ç–≤–æ —Ç—Ä–µ–∫–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

#### 1. –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```typescript
const generatePersonalRecommendations = async (userId: string): Promise<Track[]> => {
  // –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const history = await getUserListeningHistory(userId)
  
  // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
  const preferences = analyzePreferences(history)
  
  // –ù–∞—Ö–æ–¥–∏–º –ø–æ—Ö–æ–∂–∏–µ —Ç—Ä–µ–∫–∏
  const similarTracks = await findSimilarTracks(preferences)
  
  return similarTracks.slice(0, 10) // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ø-10 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
}
```

#### 2. –ö–æ–ª–ª–∞–±–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
```typescript
const generateCollaborativeRecommendations = async (userId: string): Promise<Track[]> => {
  // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ—Ö–æ–∂–∏–º–∏ –≤–∫—É—Å–∞–º–∏
  const similarUsers = await findSimilarUsers(userId)
  
  // –°–æ–±–∏—Ä–∞–µ–º —Ç—Ä–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–∏—Å—å –ø–æ—Ö–æ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
  const recommendedTracks = await getTracksFromUsers(similarUsers)
  
  // –§–∏–ª—å—Ç—Ä—É–µ–º —É–∂–µ –ø—Ä–æ—Å–ª—É—à–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏
  const newTracks = filterUnheardTracks(userId, recommendedTracks)
  
  return newTracks.slice(0, 10)
}
```

#### 3. –¢—Ä–µ–Ω–¥–æ–≤—ã–µ —Ç—Ä–µ–∫–∏
```typescript
const getTrendingTracks = async (): Promise<Track[]> => {
  const now = new Date()
  const lastWeek = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000)
  
  return await prisma.track.findMany({
    where: {
      createdAt: {
        gte: lastWeek
      },
      playCount: {
        gt: 1000
      }
    },
    orderBy: {
      playCount: 'desc'
    },
    take: 10
  })
}
```

## üíé –°—Ç–µ–π–∫–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–∞

### üèÜ Staking Interface

**–§–∞–π–ª:** [`src/components/staking/staking-interface.tsx`](src/components/staking/staking-interface.tsx:1)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É–ª–∞–º–∏ —Å—Ç–µ–π–∫–∏–Ω–≥–∞
- –†–∞—Å—á–µ—Ç –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

#### 1. –¢–∏–ø—ã —Å—Ç–µ–π–∫–∏–Ω–≥–∞
```typescript
enum StakingType {
  FIXED = 'fixed',        // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ä–æ–∫
  FLEXIBLE = 'flexible',  // –ì–∏–±–∫–∏–π —Å—Ä–æ–∫
  LIQUIDITY = 'liquidity', // –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å
  NFT = 'nft',           // NFT —Å—Ç–µ–π–∫–∏–Ω–≥
  TIERED = 'tiered'      // –¢–∏—Ä–µ–¥ —Å—Ç–µ–π–∫–∏–Ω–≥
}
```

#### 2. –†–∞—Å—á–µ—Ç –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π
```typescript
const calculateRewards = useCallback((amount: number, apy: number, days: number, compound: string): StakingRewards => {
  const frequencies = {
    daily: 365,
    weekly: 52,
    monthly: 12
  }
  
  const compoundPerYear = frequencies[compound as keyof typeof frequencies] || 365
  const rate = apy / 100
  const years = days / 365
  
  // –§–æ—Ä–º—É–ª–∞ —Å–ª–æ–∂–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞: A = P(1 + r/n)^(nt)
  const totalAmount = amount * Math.pow(1 + rate / compoundPerYear, compoundPerYear * years)
  const totalEarned = totalAmount - amount
  
  return {
    daily: (totalEarned / days) * 1,
    weekly: (totalEarned / days) * 7,
    monthly: (totalEarned / days) * 30,
    yearly: totalEarned / years,
    total: totalEarned
  }
}, [])
```

#### 3. –ü—É–ª—ã —Å—Ç–µ–π–∫–∏–Ω–≥–∞
```typescript
interface StakingPool {
  id: string
  name: string
  type: StakingType
  apy: number
  minAmount: number
  maxAmount: number
  duration: number
  totalStaked: number
  participants: number
  isAvailable: boolean
  description: string
  riskLevel: 'low' | 'medium' | 'high'
  earlyWithdrawalPenalty: number
  compoundFrequency: 'daily' | 'weekly' | 'monthly'
  performanceFee: number
  bonus?: {
    type: 'volume' | 'referral'
    value: number
    description: string
  }
}
```

#### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–µ–π–∫–∏–Ω–≥–∞
```typescript
const handleStake = async () => {
  const amount = parseFloat(stakeAmount)
  if (!amount || amount <= 0) {
    setError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É')
    return
  }

  if (amount > userBalance) {
    setError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ')
    return
  }

  if (amount < selectedPool.minAmount) {
    setError(`–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è —Å—Ç–µ–π–∫–∏–Ω–≥–∞: ${selectedPool.minAmount} NDT`)
    return
  }

  setIsStaking(true)
  setError(null)
  setSuccess(null)

  try {
    // Simulate staking transaction
    await new Promise(resolve => setTimeout(resolve, 2000))
    
    // Update user balance
    setUserBalance(prev => prev - amount)
    
    // Add new stake
    const newStake: UserStake = {
      id: Date.now().toString(),
      poolName: selectedPool.name,
      poolId: selectedPool.id,
      amount,
      apy: selectedPool.apy,
      startDate: new Date().toISOString(),
      endDate: selectedPool.duration > 0 
        ? new Date(Date.now() + selectedPool.duration * 24 * 60 * 60 * 1000).toISOString()
        : null,
      earned: 0,
      status: 'active',
      type: selectedPool.type,
      compoundCount: 0
    }
    
    setStakes(prev => [newStake, ...prev])
    setSuccess(`–£—Å–ø–µ—à–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ ${amount} NDT –≤ –ø—É–ª–µ ${selectedPool.name}`)
    setStakeAmount('')
  } catch (err) {
    setError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç–µ–π–∫–∏–Ω–≥–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.')
  } finally {
    setIsStaking(false)
  }
}
```

## üìä –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### üìà Monitoring System

**–§–∞–π–ª:** [`src/lib/monitoring.ts`](src/lib/monitoring.ts:1)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

#### 1. –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫
```typescript
export class MetricsCollector {
  private static instance: MetricsCollector
  private metrics: Map<string, number> = new Map()

  static getInstance(): MetricsCollector {
    if (!MetricsCollector.instance) {
      MetricsCollector.instance = new MetricsCollector()
    }
    return MetricsCollector.instance
  }

  increment(metric: string, value: number = 1): void {
    const current = this.metrics.get(metric) || 0
    this.metrics.set(metric, current + value)
  }

  set(metric: string, value: number): void {
    this.metrics.set(metric, value)
  }

  get(metric: string): number {
    return this.metrics.get(metric) || 0
  }

  getAll(): Record<string, number> {
    return Object.fromEntries(this.metrics)
  }
}
```

#### 2. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
```typescript
export class ErrorTracker {
  static trackError(error: Error, context?: any): void {
    console.error('Error tracked:', error, context)
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Sentry
    if (typeof Sentry !== 'undefined') {
      Sentry.captureException(error, { extra: context })
    }
    
    // –õ–æ–∫–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    const errorLog = {
      timestamp: new Date().toISOString(),
      error: error.message,
      stack: error.stack,
      context
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    const errors = JSON.parse(localStorage.getItem('errorLogs') || '[]')
    errors.push(errorLog)
    localStorage.setItem('errorLogs', JSON.stringify(errors.slice(-100))) // –•—Ä–∞–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 –æ—à–∏–±–æ–∫
  }
}
```

#### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
```typescript
export class PerformanceMonitor {
  static measure(name: string): () => void {
    const start = performance.now()
    
    return () => {
      const end = performance.now()
      const duration = end - start
      
      console.log(`${name} took ${duration}ms`)
      
      // –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Ç—Ä–∏–∫
      MetricsCollector.getInstance().set(`performance.${name}`, duration)
    }
  }

  static measureAsync(name: string, fn: () => Promise<any>): Promise<any> {
    const start = performance.now()
    
    return fn().finally(() => {
      const end = performance.now()
      const duration = end - start
      
      console.log(`${name} took ${duration}ms`)
      MetricsCollector.getInstance().set(`performance.${name}`, duration)
    })
  }
}
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### üìä –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  username VARCHAR(50) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  wallet_address VARCHAR(44) UNIQUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  last_login TIMESTAMP,
  is_active BOOLEAN DEFAULT true
);

-- –¢—Ä–µ–∫–∏
CREATE TABLE tracks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(255) NOT NULL,
  artist_id UUID REFERENCES users(id),
  genre VARCHAR(50),
  duration INTEGER,
  bitrate INTEGER,
  sample_rate INTEGER,
  file_url VARCHAR(500) NOT NULL,
  cover_image_url VARCHAR(500),
  play_count INTEGER DEFAULT 0,
  like_count INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  is_active BOOLEAN DEFAULT true
);

-- NFT
CREATE TABLE nfts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  token_id VARCHAR(66) UNIQUE NOT NULL,
  track_id UUID REFERENCES tracks(id),
  owner_id UUID REFERENCES users(id),
  creator_id UUID REFERENCES users(id),
  price DECIMAL(18, 8),
  currency VARCHAR(10) DEFAULT 'SOL',
  category VARCHAR(50),
  metadata JSONB,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  is_active BOOLEAN DEFAULT true
);

-- –ü–ª–µ–π–ª–∏—Å—Ç—ã
CREATE TABLE playlists (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(255) NOT NULL,
  description TEXT,
  user_id UUID REFERENCES users(id),
  is_public BOOLEAN DEFAULT false,
  cover_image_url VARCHAR(500),
  play_count INTEGER DEFAULT 0,
  like_count INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –¢—Ä–µ–∫–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç–∞—Ö
CREATE TABLE playlist_tracks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  playlist_id UUID REFERENCES playlists(id),
  track_id UUID REFERENCES tracks(id),
  position INTEGER NOT NULL,
  added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(playlist_id, track_id)
);

-- –°—Ç–µ–π–∫–∏–Ω–≥
CREATE TABLE staking_pools (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(255) NOT NULL,
  type VARCHAR(50) NOT NULL,
  apy DECIMAL(5, 2) NOT NULL,
  min_amount DECIMAL(18, 8) NOT NULL,
  max_amount DECIMAL(18, 8),
  duration INTEGER,
  total_staked DECIMAL(18, 8) DEFAULT 0,
  participants INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT true,
  description TEXT,
  risk_level VARCHAR(20) DEFAULT 'medium',
  early_withdrawal_penalty DECIMAL(5, 2) DEFAULT 0,
  compound_frequency VARCHAR(20) DEFAULT 'daily',
  performance_fee DECIMAL(5, 2) DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –°—Ç–µ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE user_stakes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  pool_id UUID REFERENCES staking_pools(id),
  amount DECIMAL(18, 8) NOT NULL,
  apy DECIMAL(5, 2) NOT NULL,
  start_date TIMESTAMP NOT NULL,
  end_date TIMESTAMP,
  earned DECIMAL(18, 8) DEFAULT 0,
  status VARCHAR(20) DEFAULT 'active',
  type VARCHAR(50) NOT NULL,
  compound_count INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
CREATE TABLE analytics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  track_id UUID REFERENCES tracks(id),
  user_id UUID REFERENCES users(id),
  event_type VARCHAR(50) NOT NULL,
  metadata JSONB,
  ip_address INET,
  user_agent TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_tracks_created_at ON tracks(created_at);
CREATE INDEX idx_tracks_genre ON tracks(genre);
CREATE INDEX idx_tracks_artist_id ON tracks(artist_id);
CREATE INDEX idx_nfts_created_at ON nfts(created_at);
CREATE INDEX idx_nfts_category ON nfts(category);
CREATE INDEX idx_nfts_owner_id ON nfts(owner_id);
CREATE INDEX idx_playlists_user_id ON playlists(user_id);
CREATE INDEX idx_playlist_tracks_playlist_id ON playlist_tracks(playlist_id);
CREATE INDEX idx_staking_pools_type ON staking_pools(type);
CREATE INDEX idx_user_stakes_user_id ON user_stakes(user_id);
CREATE INDEX idx_user_stakes_pool_id ON user_stakes(pool_id);
CREATE INDEX idx_analytics_track_id ON analytics(track_id);
CREATE INDEX idx_analytics_user_id ON analytics(user_id);
CREATE INDEX idx_analytics_event_type ON analytics(event_type);
```

### üîß Prisma —Å—Ö–µ–º–∞

```typescript
// schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  username      String   @unique
  passwordHash  String
  walletAddress String?  @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  lastLogin     DateTime?
  isActive      Boolean  @default(true)

  // Relations
  tracks         Track[]
  nfts           Nft[]
  playlists      Playlist[]
  userStakes     UserStake[]
  analytics      Analytics[]

  @@map("users")
}

model Track {
  id            String   @id @default(cuid())
  title         String
  artistId      String
  genre         String?
  duration      Int?
  bitrate       Int?
  sampleRate    Int?
  fileUrl       String
  coverImageUrl String?
  playCount     Int      @default(0)
  likeCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  isActive      Boolean  @default(true)

  // Relations
  artist        User         @relation(fields: [artistId], references: [id])
  nfts          Nft[]
  playlistTracks PlaylistTrack[]
  analytics     Analytics[]

  @@map("tracks")
}

model Nft {
  id          String   @id @default(cuid())
  tokenId     String   @unique
  trackId     String
  ownerId     String
  creatorId   String
  price       Decimal?
  currency    String   @default("SOL")
  category    String?
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  isActive    Boolean  @default(true)

  // Relations
  track       Track           @relation(fields: [trackId], references: [id])
  owner       User            @relation(fields: [ownerId], references: [id])
  creator     User            @relation(fields: [creatorId], references: [id])
  userStakes  UserStake[]

  @@map("nfts")
}

model Playlist {
  id            String   @id @default(cuid())
  name          String
  description   String?
  userId        String
  isPublic      Boolean  @default(false)
  coverImageUrl String?
  playCount     Int      @default(0)
  likeCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user          User             @relation(fields: [userId], references: [id])
  playlistTracks PlaylistTrack[]

  @@map("playlists")
}

model PlaylistTrack {
  id         String   @id @default(cuid())
  playlistId String
  trackId    String
  position   Int
  addedAt    DateTime @default(now())

  // Relations
  playlist   Playlist @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  track      Track    @relation(fields: [trackId], references: [id])

  @@unique([playlistId, trackId])
  @@map("playlist_tracks")
}

model StakingPool {
  id                     String   @id @default(cuid())
  name                   String
  type                   String
  apy                    Decimal
  minAmount              Decimal
  maxAmount              Decimal?
  duration               Int?
  totalStaked            Decimal  @default(0)
  participants           Int      @default(0)
  isActive               Boolean  @default(true)
  description            String?
  riskLevel              String   @default("medium")
  earlyWithdrawalPenalty Decimal  @default(0)
  compoundFrequency      String   @default("daily")
  performanceFee         Decimal  @default(0)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  // Relations
  userStakes UserStake[]

  @@map("staking_pools")
}

model UserStake {
  id            String   @id @default(cuid())
  userId        String
  poolId        String
  amount        Decimal
  apy           Decimal
  startDate     DateTime
  endDate       DateTime?
  earned        Decimal  @default(0)
  status        String   @default("active")
  type          String
  compoundCount Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user User  @relation(fields: [userId], references: [id])
  pool StakingPool @relation(fields: [poolId], references: [id])

  @@map("user_stakes")
}

model Analytics {
  id         String   @id @default(cuid())
  trackId    String?
  userId     String?
  eventType  String
  metadata   Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  // Relations
  track Track? @relation(fields: [trackId], references: [id])
  user  User?  @relation(fields: [userId], references: [id])

  @@map("analytics")
}
```

## üîê –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

#### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ NextAuth.js
import NextAuth from 'next-auth'
import CredentialsProvider from 'next-auth/providers/credentials'

export default NextAuth({
  providers: [
    CredentialsProvider({
      name: 'credentials',
      credentials: {
        email: { label: 'Email', type: 'email' },
        password: { label: 'Password', type: 'password' }
      },
      async authorize(credentials) {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        const user = await authenticateUser(credentials.email, credentials.password)
        if (user) {
          return user
        }
        return null
      }
    })
  ],
  session: {
    strategy: 'jwt'
  },
  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.walletAddress = user.walletAddress
      }
      return token
    },
    async session({ session, token }) {
      if (token) {
        session.user.walletAddress = token.walletAddress
      }
      return session
    }
  }
})
```

#### 2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```typescript
// Middleware –¥–ª—è –∑–∞—â–∏—Ç—ã —Ä–æ—É—Ç–æ–≤
export async function middleware(request: NextRequest) {
  const session = await getServerSession(authOptions)
  
  if (!session) {
    return NextResponse.redirect(new URL('/auth/signin', request.url))
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
  const { pathname } = request.nextUrl
  if (pathname.startsWith('/admin') && session.user.role !== 'admin') {
    return NextResponse.redirect(new URL('/unauthorized', request.url))
  }
  
  return NextResponse.next()
}

export const config = {
  matcher: ['/admin/:path*', '/api/tracks/:path*']
}
```

#### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
```typescript
import { z } from 'zod'

const trackSchema = z.object({
  title: z.string().min(1).max(255),
  genre: z.string().min(1).max(50),
  duration: z.number().positive(),
  file: z.instanceof(File).refine(file => file.size <= 50 * 1024 * 1024) // 50MB
})

export async function uploadTrack(formData: FormData) {
  const validatedData = trackSchema.parse({
    title: formData.get('title'),
    genre: formData.get('genre'),
    duration: parseInt(formData.get('duration')),
    file: formData.get('file')
  })
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
  return await processTrackUpload(validatedData)
}
```

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### 1. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```typescript
// Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
import { createClient } from 'redis'

const redisClient = createClient({
  url: process.env.REDIS_URL
})

export async function getCachedData(key: string): Promise<any> {
  try {
    const cached = await redisClient.get(key)
    if (cached) {
      return JSON.parse(cached)
    }
    
    const data = await fetchDataFromDatabase(key)
    await redisClient.setex(key, 3600, JSON.stringify(data)) // –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 1 —á–∞—Å
    
    return data
  } catch (error) {
    console.error('Cache error:', error)
    return await fetchDataFromDatabase(key)
  }
}
```

#### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Prisma —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
export async function getTrackWithAnalytics(trackId: string) {
  return await prisma.track.findUnique({
    where: { id: trackId },
    include: {
      artist: {
        select: { id: true, username: true }
      },
      analytics: {
        where: {
          createdAt: {
            gte: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000) // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
          }
        },
        orderBy: { createdAt: 'desc' }
      }
    }
  })
}
```

#### 3. –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
```typescript
// React.lazy –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
const LazyAnalytics = React.lazy(() => import('./components/Analytics'))

function Dashboard() {
  return (
    <div>
      <h1>Dashboard</h1>
      <Suspense fallback={<div>Loading analytics...</div>}>
        <LazyAnalytics />
      </Suspense>
    </div>
  )
}
```

## üì± –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### üì± React Native Integration

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```
mobile-app/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/     # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI
‚îÇ   ‚îú‚îÄ‚îÄ hooks/         # Custom hooks
‚îÇ   ‚îú‚îÄ‚îÄ navigation/    # –ù–∞–≤–∏–≥–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ screens/       # –≠–∫—Ä–∞–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/      # API —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îî‚îÄ‚îÄ utils/         # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ App.tsx            # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îî‚îÄ‚îÄ package.json       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

#### 1. –°–µ—Ä–≤–∏—Å –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```typescript
// mobile-app/src/services/mobileService.ts
import AsyncStorage from '@react-native-async-storage/async-storage'

export class MobileService {
  private static instance: MobileService
  
  static getInstance(): MobileService {
    if (!MobileService.instance) {
      MobileService.instance = new MobileService()
    }
    return MobileService.instance
  }

  async getStoredData(key: string): Promise<any> {
    try {
      const jsonValue = await AsyncStorage.getItem(key)
      return jsonValue != null ? JSON.parse(jsonValue) : null
    } catch (e) {
      console.error('Error reading from storage', e)
      return null
    }
  }

  async storeData(key: string, value: any): Promise<void> {
    try {
      const jsonValue = JSON.stringify(value)
      await AsyncStorage.setItem(key, jsonValue)
    } catch (e) {
      console.error('Error saving to storage', e)
    }
  }

  async playAudio(trackUrl: string): Promise<void> {
    try {
      // –ò–º–∏—Ç–∞—Ü–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ
      console.log('Playing audio:', trackUrl)
    } catch (error) {
      console.error('Error playing audio:', error)
    }
  }
}
```

#### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—à–µ–ª—å–∫–æ–º
```typescript
// mobile-app/src/services/walletService.ts
import { WalletAdapter } from '../types/wallet'

export class MobileWalletService implements WalletAdapter {
  private isConnected = false
  private publicKey: string | null = null

  async connect(): Promise<void> {
    try {
      // –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–æ—à–µ–ª—å–∫—É
      this.isConnected = true
      this.publicKey = 'mock_public_key'
    } catch (error) {
      console.error('Error connecting wallet:', error)
      throw error
    }
  }

  async disconnect(): Promise<void> {
    this.isConnected = false
    this.publicKey = null
  }

  async signTransaction(transaction: any): Promise<string> {
    if (!this.isConnected) {
      throw new Error('Wallet not connected')
    }
    
    // –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    return 'mock_signature'
  }

  get connected(): boolean {
    return this.isConnected
  }

  get publicKeyString(): string | null {
    return this.publicKey
  }
}
```

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏

### üìà –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

#### 1. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
```typescript
// utils/analytics.ts
export class Analytics {
  static track(event: string, properties?: any): void {
    if (typeof window !== 'undefined') {
      // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google Analytics
      gtag('event', event, properties)
      
      // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
      const events = JSON.parse(localStorage.getItem('analytics_events') || '[]')
      events.push({
        event,
        properties,
        timestamp: new Date().toISOString(),
        url: window.location.href
      })
      localStorage.setItem('analytics_events', JSON.stringify(events.slice(-1000)))
    }
  }

  static identify(userId: string, traits?: any): void {
    if (typeof window !== 'undefined') {
      // –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      gtag('config', GA_TRACKING_ID, {
        user_id: userId,
        ...traits
      })
    }
  }
}
```

#### 2. –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```typescript
// utils/performance.ts
export class PerformanceMetrics {
  static startMeasure(name: string): () => void {
    if (typeof window !== 'undefined' && 'performance' in window) {
      const start = performance.now()
      
      return () => {
        const end = performance.now()
        const duration = end - start
        
        console.log(`${name} took ${duration}ms`)
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Ç—Ä–∏–∫
        Analytics.track('performance_metric', {
          name,
          duration,
          timestamp: new Date().toISOString()
        })
      }
    }
    
    return () => {}
  }

  static measurePageLoad(): void {
    const measure = this.startMeasure('page_load')
    
    if (document.readyState === 'complete') {
      measure()
    } else {
      window.addEventListener('load', measure)
    }
  }
}
```

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### üîó –í–Ω–µ—à–Ω–∏–µ API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

#### 1. Solana Web3
```typescript
// lib/solana.ts
import { Connection, PublicKey, Transaction } from '@solana/web3.js'

export class SolanaService {
  private connection: Connection

  constructor() {
    this.connection = new Connection(
      process.env.NEXT_PUBLIC_SOLANA_RPC_URL || 'https://api.devnet.solana.com',
      'confirmed'
    )
  }

  async getBalance(publicKey: string): Promise<number> {
    try {
      const balance = await this.connection.getBalance(new PublicKey(publicKey))
      return balance / 1e9 // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ SOL
    } catch (error) {
      console.error('Error getting balance:', error)
      return 0
    }
  }

  async sendTransaction(transaction: Transaction): Promise<string> {
    try {
      const signature = await this.connection.sendRawTransaction(
        transaction.serialize()
      )
      return signature
    } catch (error) {
      console.error('Error sending transaction:', error)
      throw error
    }
  }
}
```

#### 2. IPFS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```typescript
// lib/ipfs.ts
import { create } from 'ipfs-http-client'

export class IPFSService {
  private client: any

  constructor() {
    this.client = create({
      url: process.env.IPFS_API_URL || 'https://ipfs.infura.io:5001'
    })
  }

  async uploadFile(file: File): Promise<string> {
    try {
      const result = await this.client.add(file)
      return result.path
    } catch (error) {
      console.error('Error uploading to IPFS:', error)
      throw error
    }
  }

  async getFile(cid: string): Promise<Buffer> {
    try {
      const chunks: Buffer[] = []
      for await (const chunk of this.client.cat(cid)) {
        chunks.push(chunk)
      }
      return Buffer.concat(chunks)
    } catch (error) {
      console.error('Error fetching from IPFS:', error)
      throw error
    }
  }
}
```

## üìö –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ NORMAL DANCE v1.0.1 –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –∏ –±–µ–∑–æ–ø–∞—Å–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –º—É–∑—ã–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ —Å Web3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- **–ê—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞** —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
- **Web3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å –∫–æ—à–µ–ª—å–∫–æ–º Phantom –∏ Solana
- **–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π** –Ω–∞ –æ—Å–Ω–æ–≤–µ ML
- **–°—Ç–µ–π–∫–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–∞** —ÅÂ§öÁßçÊ±†Á±ªÂûã
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- **–ú–æ–±–∏–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –¥–ª—è –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç–∏

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

---

**–°–æ–∑–¥–∞–Ω–æ:** –°–µ–Ω—Ç—è–±—Ä—å 2025
**–í–µ—Ä—Å–∏—è:** v1.0.1
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –°–µ–Ω—Ç—è–±—Ä—å 2025
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Lead Architect - –ü–µ—Ç—Ä–æ–≤ –ò.–ê.