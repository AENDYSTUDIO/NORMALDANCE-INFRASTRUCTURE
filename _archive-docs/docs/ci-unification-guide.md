# Руководство по унификации CI-проверок

## Обзор

В проекте была реализована унификация CI-проверок для обеспечения единообразия и полноты проверок безопасности, качества кода и функциональности. Новый унифицированный CI-файл объединяет все необходимые проверки в одном месте.

## Текущая архитектура CI

### Старые конфигурации

- `.github/workflows/ci.yml` - базовые проверки
- `.github/workflows/security-scan.yml` - отдельные проверки безопасности
- `.github/workflows/ci-cd.yml` - полный CI/CD пайплайн
- `.github/workflows/ci-cd-optimized.yml` - оптимизированный CI/CD пайплайн

### Новая унифицированная конфигурация

- `.github/workflows/ci-unified.yml` - единый пайплайн для всех проверок

## Структура унифицированного CI

### 1. Code Quality Checks

- ESLint для проверки кода
- TypeScript проверки
- npm audit для безопасности зависимостей

### 2. Тестирование

- Unit тесты
- Integration тесты
- Поддержка стратегии матрицы для разных типов тестов

### 3. Унифицированное сканирование безопасности

- Внутренний сканер секретов (`npm run security:secrets`)
- Trivy для сканирования уязвимостей
- Snyk для дополнительной проверки безопасности
- CodeQL анализ

### 4. Сборка

- Проверка сборки приложения
- Убедиться, что все зависимости корректны

### 5. Финальная верификация

- Комплексная проверка всех аспектов безопасности

## Преимущества унификации

1. **Единообразие**: Все проверки в одном месте
2. **Полнота**: Все необходимые проверки выполняются последовательно
3. **Прозрачность**: Легко отследить, какие проверки выполняются
4. **Поддержка**: Один файл для управления всеми проверками
5. **Безопасность**: Унифицированный подход к сканированию секретов

## Запуск проверок локально

### Все проверки

```bash
npm run lint && npm run type-check && npm run security:audit && npm test
```

### Проверка безопасности

```bash
npm run security:secrets
npm run security:audit
npm run security:check
```

### Сборка

```bash
npm run build
```

## Настройка для новых разработчиков

Новые разработчики автоматически получают все проверки через pre-commit хуки. Для ручной проверки можно использовать:

```bash
# Установка husky
npm install
npx husky install

# Запуск всех проверок
npm run test
npm run lint
npm run type-check
npm run security:secrets
```

## Миграция со старых конфигураций

### Рекомендуемые действия

1. Использовать `ci-unified.yml` как основной CI-файл
2. Сохранить `ci-cd-optimized.yml` для полного CD пайплайна
3. Удалить дублирующиеся проверки из других файлов
4. Обновить документацию

### Проверка совместимости

- Убедиться, что все необходимые проверки присутствуют в новом файле
- Проверить, что все environment переменные доступны
- Протестировать на тестовой ветке

## Рекомендации по использованию

### Для Pull Requests

- Все проверки должны проходить успешно
- Код должен соответствовать стандартам
- Не должно быть утечек секретов

### Для основных веток (main, develop)

- Дополнительные проверки безопасности
- Проверка сборки
- Комплексное тестирование

## Troubleshooting

### Проблемы с производительностью

Если CI становится слишком медленным, можно:

- Использовать кеширование зависимостей
- Оптимизировать порядок задач
- Разделить на несколько параллельных job'ов

### Ложные срабатывания

- Обновить регулярные выражения в сканере
- Добавить исключения в конфигурацию
- Использовать фиктивные значения в тестах

## Будущие улучшения

1. Добавить проверку производительности
2. Интеграция с SonarQube
3. Автоматическое исправление кода
4. Расширенное сканирование уязвимостей
