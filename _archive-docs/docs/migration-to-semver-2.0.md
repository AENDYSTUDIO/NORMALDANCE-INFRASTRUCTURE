# Миграция на Семантическое Версионирование 2.0.0

## Обзор

Этот документ описывает процесс миграции с текущей системы версионирования на полную реализацию Семантического Версионирования 2.0.0 для проекта NormalDANCE.

## Текущая система версионирования

На данный момент проект использует базовую систему семантического версионирования с форматом `MAJOR.MINOR.PATCH`, но без полной поддержки:

- Предрелизных версий (альфа, бета, RC)
- Метаданных сборки
- Строгой валидации формата версий по спецификации SemVer 2.0.0

## Новая система версионирования

Новая система полностью соответствует спецификации SemVer 2.0.0 и включает:

- Формат: `MAJOR.MINOR.PATCH[-PRERELEASE][+BUILD_METADATA]`
- Поддержка предрелизных версий: `1.0.0-alpha`, `1.0.0-beta.1`, `1.0.0-rc.1`
- Поддержка метаданных сборки: `1.0.0+20250101.abc123`
- Автоматическое определение типа версии по коммитам
- Расширенные команды управления версиями

## Шаги миграции

### 1. Обновление скриптов версионирования

#### Замена старых скриптов

- Удалите или замените `scripts/version-manager-enhanced.js` на новый `scripts/version-manager.js`
- Обновите скрипты в `package.json` (уже выполнено)

#### Новые команды

```bash
# Основные команды
npm run version:major    # Увеличение MAJOR версии (1.0.0 -> 2.0.0)
npm run version:minor    # Увеличение MINOR версии (1.0 -> 1.1.0)
npm run version:patch    # Увеличение PATCH версии (1.0.0 -> 1.0.1)

# Предрелизные команды
npm run version:alpha    # Создание/увеличение alpha версии (1.0.0 -> 1.0.0-alpha.0)
npm run version:beta     # Создание/увеличение beta версии (1.0.0 -> 1.0.0-beta.0)
npm run version:rc       # Создание/увеличение rc версии (1.0.0 -> 1.0.0-rc.0)
npm run version:prerelease  # Универсальная команда для предрелизов

# Команды для метаданных
npm run version:build    # Добавление метаданных сборки (1.0.0 -> 1.0.0+timestamp.hash)

# Вспомогательные команды
npm run version:current  # Показать текущую версию
npm run version:report   # Отчет о версиях
npm run version:tags     # Показать теги версий
npm run version:changelog # Генерация changelog
npm run version:release  # Создание релиза
```

### 2. Обновление процессов разработки

#### Формат коммитов

Убедитесь, что все коммиты следуют стандарту Conventional Commits для корректного определения типа версии:

- `feat:` - Новая функциональность (увеличивает MINOR)
- `feat!:` или `BREAKING CHANGE:` - С изменениями, нарушающими совместимость (увеличивает MAJOR)
- `fix:` - Исправление багов (увеличивает PATCH)
- `docs:`, `style:`, `refactor:`, `perf:`, `test:`, `chore:` - различные вспомогательные изменения (увеличивают PATCH)

#### Примеры

```bash
git commit -m "feat: add user authentication system"
git commit -m "feat!: remove deprecated API endpoints"  # Обратите внимание на !
git commit -m "fix: resolve login issue"
```

### 3. Обновление CI/CD пайплайнов

#### GitHub Actions

Обновите workflow файлы для использования новых команд версионирования:

```yaml
name: Release Management
on:
  push:
    branches: [main]

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      - name: Install dependencies
        run: npm ci

      - name: Bump version and create release
        run: |
          # Определяем тип версии на основе коммитов
          # Можно использовать специальные библиотеки или логику для автоматического определения
          npm run version:patch  # или minor/major в зависимости от изменений

      - name: Create GitHub Release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: v${{ env.NEW_VERSION }}
          release_name: Release v${{ env.NEW_VERSION }}
          draft: false
          prerelease: false
```

### 4. Обновление документации

#### Обновленные файлы

- `docs/versioning-strategy.md` - полное руководство по новой системе
- `SEMVER_2_0_0.md` - спецификация SemVer 2.0.0 для проекта
- `docs/migration-to-semver-2.0.md` - этот документ

### 5. Обновление зависимостей и инструментов

#### Совместимость

Убедитесь, что все инструменты, которые работают с версиями, поддерживают формат SemVer 2.0.0:

- npm/yarn
- Docker
- Kubernetes
- Системы мониторинга
- Инструменты деплоя

## Проверка миграции

### Тестирование новых функций

1. Создайте тестовую ветку
2. Выполните команды версионирования
3. Проверьте корректность формата версий
4. Убедитесь, что changelog генерируется правильно
5. Проверьте, что теги создаются корректно

### Пример процесса

```bash
# Создание предрелизной версии
npm run version:alpha

# Добавление изменений
git add .
git commit -m "feat: new feature for testing"

# Обновление предрелизной версии
npm run version:alpha  # 1.0-alpha.0 -> 1.0.0-alpha.1

# Выпуск финальной версии
npm run version:patch  # 1.0-alpha.1 -> 1.0.0
```

## Обратная совместимость

### Существующие версии

- Все существующие версии в формате `MAJOR.MINOR.PATCH` остаются валидными
- Старые теги продолжают работать
- История changelog сохраняется

### Переходные положения

- Временно поддерживайте обе системы при необходимости
- Постепенно переводите команды на новую систему
- Обновляйте документацию по мере миграции

## Проверочный лист

- [ ] Скрипт `version-manager.js` обновлен и работает корректно
- [ ] Команды в `package.json` обновлены
- [ ] CI/CD пайплайны обновлены
- [ ] Документация обновлена
- [ ] Команда разработчиков проинформирована о изменениях
- [ ] Тестирование новой системы завершено
- [ ] Резервное копирование выполнено

## Рекомендации

1. **Постепенная миграция**: Начните с тестовых веток и постепенно переходите на новую систему
2. **Обучение команды**: Обязательно ознакомьте всех разработчиков с новыми правилами версионирования
3. **Автоматизация**: Используйте автоматические проверки для формата коммитов
4. **Документирование**: Ведите документацию по принятым соглашениям в команде
5. **Мониторинг**: Следите за корректной работой новых скриптов в продакшене

## Часто задаваемые вопросы

### Q: Что происходит с существующими версиями?

A: Все существующие версии остаются валидными. Новая система полностью обратно совместима.

### Q: Как перейти с текущей системы?

A: Просто начните использовать новые команды. Текущая версия из package.json будет использоваться как базовая.

### Q: Можно ли использовать предрелизные версии немедленно?

A: Да, вы можете начать использовать предрелизные версии с текущей версии, например: 1.0.4 -> 1.0.4-alpha.0

## Контакты для поддержки

Если у вас возникли вопросы по процессу миграции, обращайтесь:

- В Slack канал `#versions`
- По email: versions@normaldance.com
- Создавайте issue в репозитории
