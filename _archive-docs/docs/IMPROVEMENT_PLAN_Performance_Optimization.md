# ‚ö° –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ NORMAL DANCE

## üéØ –¶–µ–ª—å

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã NORMAL DANCE –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞, —Å–Ω–∏–∂–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–≤—ã—à–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- –í–∫–ª—é—á–µ–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (WebP, AVIF)
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è CSS –∏ –∏–º–ø–æ—Ä—Ç–æ–≤ –ø–∞–∫–µ—Ç–æ–≤
- –í–∫–ª—é—á–µ–Ω–æ —Å–∂–∞—Ç–∏–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º—ã

1. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç—ã, –Ω–µ—Ç –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏)
2. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. –ù–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤
4. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
5. –ù–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (memoization, virtualization)
6. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
7. –ù–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–±–æ—Ä–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## üìà –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏—è

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

#### –ü—Ä–æ–±–ª–µ–º–∞

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ProgressiveImage –±–∞–∑–æ–≤–∞—è –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Next.js Image.

#### –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ –∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–æ–π.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```typescript
// src/components/ui/advanced-image.tsx
"use client";

import Image, { ImageProps } from "next/image";
import { useState, useEffect, useRef } from "react";
import { useInView } from "react-intersection-observer";

interface AdvancedImageProps extends Omit<ImageProps, "src" | "placeholder"> {
  src: string;
  placeholderSrc?: string;
  lazy?: boolean;
  priority?: boolean;
  preload?: boolean;
  onLoad?: () => void;
  onError?: () => void;
  sizes?: string;
  // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  responsiveSizes?: {
    mobile?: number;
    tablet?: number;
    desktop?: number;
  };
}

const AdvancedImage: React.FC<AdvancedImageProps> = ({
  src,
  placeholderSrc,
  lazy = true,
  priority = false,
  preload = false,
  onLoad,
  onError,
  sizes,
  responsiveSizes,
  ...props
}) => {
  const [isLoaded, setIsLoaded] = useState(false);
  const [hasError, setHasError] = useState(false);
  const imgRef = useRef<HTMLImageElement>(null);

  // –ò—Å–ø–æ–ª—å–∑—É–µ–º Intersection Observer –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
  const { ref, inView } = useInView({
    triggerOnce: true,
    threshold: 0.1,
    rootMargin: "50px 0px",
  });

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  const getSizes = () => {
    if (sizes) return sizes;

    if (responsiveSizes) {
      const mobile = responsiveSizes.mobile || 400;
      const tablet = responsiveSizes.tablet || 600;
      const desktop = responsiveSizes.desktop || 800;

      return `(max-width: 768px) ${mobile}px, (max-width: 1024px) ${tablet}px, ${desktop}px`;
    }

    // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
    return "(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw";
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏
  const handleError = () => {
    setHasError(true);
    if (onError) onError();
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
  const handleLoad = () => {
    setIsLoaded(true);
    if (onLoad) onLoad();
  };

  // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  useEffect(() => {
    if (preload && typeof window !== "undefined") {
      const link = document.createElement("link");
      link.rel = "preload";
      link.as = "image";
      link.href = src;
      document.head.appendChild(link);

      return () => {
        document.head.removeChild(link);
      };
    }
  }, [preload, src]);

  // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder
  if (hasError) {
    return (
      <div
        ref={ref}
        className={`bg-gray-200 border-2 border-dashed rounded-xl w-full h-full flex items-center justify-center ${
          props.className || ""
        }`}
      >
        <span className="text-gray-500 text-sm">Image unavailable</span>
      </div>
    );
  }

  // –î–ª—è –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder –ø–æ–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –≤ –∑–æ–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏
  if (lazy && !inView && !priority) {
    return (
      <div
        ref={ref}
        className={`bg-gray-100 rounded-xl w-full h-full flex items-center justify-center overflow-hidden ${
          props.className || ""
        }`}
      >
        {placeholderSrc ? (
          <img
            src={placeholderSrc}
            alt={props.alt || ""}
            className="w-full h-full object-cover blur-sm"
          />
        ) : (
          <div className="animate-pulse bg-gray-200 w-full h-full" />
        )}
      </div>
    );
  }

  return (
    <div
      ref={ref}
      className={`relative overflow-hidden ${props.className || ""}`}
    >
      <Image
        {...props}
        src={src}
        alt={props.alt || ""}
        sizes={getSizes()}
        priority={priority}
        onLoad={handleLoad}
        onError={handleError}
        className={`${props.className || ""} ${
          isLoaded ? "opacity-100 blur-0" : "opacity-80 blur-sm"
        } transition-all duration-300`}
        style={{
          ...props.style,
          transition: "opacity 0.3s ease, filter 0.3s ease",
        }}
      />

      {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */}
      {!isLoaded && (
        <div className="absolute inset-0 flex items-center justify-center bg-gray-100">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600" />
        </div>
      )}
    </div>
  );
};

export default AdvancedImage;
```

#### –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Next.js –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:

```typescript
// next.config.ts (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ...

  images: {
    formats: ["image/webp", "image/avif"],
    deviceSizes: [320, 420, 768, 1024, 1200, 1600, 1920, 2560],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
    minimumCacheTTL: 31536000, // 1 –≥–æ–¥
    domains: [
      "ipfs.io",
      "gateway.pinata.cloud",
      "cloudflare-ipfs.com",
      "localhost",
      "normaldance.com",
      "www.normaldance.com",
    ],
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    remotePatterns: [
      {
        protocol: "https",
        hostname: "*.ipfs.io",
        port: "",
      },
      {
        protocol: "https",
        hostname: "*.pinata.cloud",
        port: "",
      },
      {
        protocol: "https",
        hostname: "cloudflare-ipfs.com",
        port: "",
      },
    ],
  },

  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ...
};

export default nextConfig;
```

### 2. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### –ü—Ä–æ–±–ª–µ–º–∞

–ë–∞–∑–æ–≤–∞—è –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏.

#### –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å —É–ª—É—á—à–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫, –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–æ–π –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏ –∑–∞–≥—Ä—É–∑–∫–∏.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```typescript
// src/lib/advanced-lazy-loading.ts
import { lazy, ComponentType, ReactElement } from "react";

interface LazyOptions {
  fallback?: ReactElement;
  errorFallback?: ReactElement;
  preload?: boolean;
  delay?: number;
}

// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
export const createLazyComponent = <T extends ComponentType<any>>(
  importFn: () => Promise<{ default: T }>,
  options: LazyOptions = {}
) => {
  const {
    fallback = (
      <div className="animate-pulse bg-gray-200 rounded-lg h-32 w-full" />
    ),
    errorFallback = (
      <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
        Failed to load component
      </div>
    ),
    preload = false,
    delay = 150,
  } = options;

  // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è
  if (preload) {
    importFn().catch((err) => {
      console.warn("Preload failed:", err);
    });
  }

  return lazy(() => {
    return new Promise<{ default: T }>((resolve, reject) => {
      // –î–æ–±–∞–≤–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –ª—É—á—à–µ–≥–æ UX
      const delayPromise = new Promise((resolve) => setTimeout(resolve, delay));

      Promise.all([importFn(), delayPromise])
        .then(([module]) => {
          resolve(module);
        })
        .catch((error) => {
          console.error("Lazy load error:", error);
          // –í–æ–∑–≤—Ä–∞—â–∞–µ–º fallback –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
          resolve({
            default: () => errorFallback,
          } as any);
        });
    });
  });
};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π
export const preloadModule = (importFn: () => Promise<any>) => {
  return importFn().catch((err) => {
    console.warn("Preload failed:", err);
  });
};

// –•—É–∫ –¥–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –≤ –∑–æ–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏
export const useIntersectionObserver = (
  threshold: number = 0.1,
  rootMargin: string = "50px"
) => {
  // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Intersection Observer —Ö—É–∫–∞
  // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å react-intersection-observer
  return { ref: null, inView: false };
};
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:

```typescript
// src/app/page.tsx (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
import { Suspense } from "react";
import { createLazyComponent } from "@/lib/advanced-lazy-loading";

// –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
const AudioPlayer = createLazyComponent(
  () => import("@/components/audio/audio-player"),
  {
    fallback: <div className="h-20 bg-gray-100 rounded-lg animate-pulse" />,
    errorFallback: (
      <div className="h-20 bg-red-100 rounded-lg flex items-center justify-center">
        Failed to load audio player
      </div>
    ),
    preload: true,
  }
);

const TrackCard = createLazyComponent(
  () => import("@/components/audio/track-card"),
  {
    fallback: <div className="h-64 bg-gray-100 rounded-lg animate-pulse" />,
  }
);

export default function Home() {
  return (
    <MainLayout>
      <div className="space-y-6">
        {/* ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç ... */}

        {/* –õ–µ–Ω–∏–≤–æ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–π –∞—É–¥–∏–æ–ø–ª–µ–µ—Ä */}
        <Suspense
          fallback={
            <div className="h-20 bg-gray-100 rounded-lg animate-pulse" />
          }
        >
          <AudioPlayer />
        </Suspense>
      </div>
    </MainLayout>
  );
}
```

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

#### –ü—Ä–æ–±–ª–µ–º–∞

–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –º–µ–º–æ–∏–∑–∞—Ü–∏—è –∏ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤.

#### –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ–º–æ–∏–∑–∞—Ü–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª–∏–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```typescript
// src/lib/rendering-optimizations.ts
import { memo, useMemo, useCallback } from "react";

// –•—É–∫ –¥–ª—è –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
export const useHeavyComputation = <T>(
  computeFn: () => T,
  dependencies: any[]
): T => {
  return useMemo(() => {
    console.time("Heavy computation");
    const result = computeFn();
    console.timeEnd("Heavy computation");
    return result;
  }, dependencies);
};

// –•—É–∫ –¥–ª—è –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
export const useEventCallback = <T extends (...args: any[]) => any>(
  callback: T
): T => {
  return useCallback(callback, []);
};

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ø–∏—Å–∫–æ–≤
import { useState, useEffect, useRef } from "react";

interface VirtualListProps<T> {
  items: T[];
  itemHeight: number;
  renderItem: (item: T, index: number) => React.ReactNode;
  overscan?: number;
  className?: string;
}

export const VirtualList = <T>({
  items,
  itemHeight,
  renderItem,
  overscan = 5,
  className = "",
}: VirtualListProps<T>) => {
  const [scrollTop, setScrollTop] = useState(0);
  const containerRef = useRef<HTMLDivElement>(null);

  const visibleRange = useMemo(() => {
    if (!containerRef.current) return { start: 0, end: 0 };

    const containerHeight = containerRef.current.clientHeight;
    const start = Math.max(0, Math.floor(scrollTop / itemHeight) - overscan);
    const end = Math.min(
      items.length,
      Math.ceil((scrollTop + containerHeight) / itemHeight) + overscan
    );

    return { start, end };
  }, [scrollTop, items.length, itemHeight, overscan]);

  const totalHeight = items.length * itemHeight;
  const offsetY = visibleRange.start * itemHeight;
  const visibleItems = items.slice(visibleRange.start, visibleRange.end);

  const handleScroll = (e: React.UIEvent<HTMLDivElement>) => {
    setScrollTop(e.currentTarget.scrollTop);
  };

  return (
    <div
      ref={containerRef}
      className={`overflow-auto ${className}`}
      onScroll={handleScroll}
    >
      <div style={{ height: totalHeight, position: "relative" }}>
        <div
          style={{
            transform: `translateY(${offsetY}px)`,
            position: "absolute",
            width: "100%",
          }}
        >
          {visibleItems.map((item, index) => (
            <div
              key={visibleRange.start + index}
              style={{ height: itemHeight }}
            >
              {renderItem(item, visibleRange.start + index)}
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

// –ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç—Ä–µ–∫–∞
import { memo } from "react";

interface TrackCardProps {
  track: any;
  onPlay?: () => void;
  onLike?: () => void;
}

const TrackCardComponent: React.FC<TrackCardProps> = ({
  track,
  onPlay,
  onLike,
}) => {
  // –ú–µ–º–æ–∏–∑–∏—Ä—É–µ–º —Å–ª–æ–∂–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
  const formattedDuration = useMemo(() => {
    const minutes = Math.floor(track.duration / 60);
    const seconds = track.duration % 60;
    return `${minutes}:${seconds.toString().padStart(2, "0")}`;
  }, [track.duration]);

  // –ú–µ–º–æ–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
  const handlePlay = useCallback(() => {
    onPlay?.();
  }, [onPlay]);

  const handleLike = useCallback(() => {
    onLike?.();
  }, [onLike]);

  return (
    <div className="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
      {/* ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π JSX ... */}
    </div>
  );
};

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
export const TrackCard = memo(TrackCardComponent);
```

### 4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

#### –ü—Ä–æ–±–ª–µ–º–∞

–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

#### –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å TTL –∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```typescript
// src/lib/data-cache.ts
interface CacheEntry<T> {
  data: T;
  timestamp: number;
  ttl: number; // –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
}

class DataCache {
  private cache: Map<string, CacheEntry<any>> = new Map();
  private cleanupInterval: NodeJS.Timeout | null = null;

  constructor() {
    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
    this.cleanupInterval = setInterval(() => {
      this.cleanup();
    }, 60000); // –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫—ç—à–∞
  get<T>(key: string): T | null {
    const entry = this.cache.get(key);

    if (!entry) {
      return null;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏—Å—Ç–µ–∫–ª–æ –ª–∏ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏
    if (Date.now() - entry.timestamp > entry.ttl) {
      this.cache.delete(key);
      return null;
    }

    return entry.data;
  }

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∫—ç—à
  set<T>(key: string, data: T, ttl: number = 300000): void {
    // 5 –º–∏–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    this.cache.set(key, {
      data,
      timestamp: Date.now(),
      ttl,
    });
  }

  // –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø–æ –∫–ª—é—á—É
  invalidate(key: string): void {
    this.cache.delete(key);
  }

  // –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É
  invalidatePattern(pattern: string): void {
    const keysToDelete: string[] = [];

    this.cache.forEach((_, key) => {
      if (key.includes(pattern)) {
        keysToDelete.push(key);
      }
    });

    keysToDelete.forEach((key) => this.cache.delete(key));
  }

  // –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
  private cleanup(): void {
    const now = Date.now();
    const keysToDelete: string[] = [];

    this.cache.forEach((entry, key) => {
      if (now - entry.timestamp > entry.ttl) {
        keysToDelete.push(key);
      }
    });

    keysToDelete.forEach((key) => this.cache.delete(key));
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫—ç—à–∞
  getStats(): { size: number; keys: string[] } {
    return {
      size: this.cache.size,
      keys: Array.from(this.cache.keys()),
    };
  }

  // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫—ç—à–∞
  clear(): void {
    this.cache.clear();
  }

  // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏
  destroy(): void {
    if (this.cleanupInterval) {
      clearInterval(this.cleanupInterval);
    }
  }
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫—ç—à–∞
export const dataCache = new DataCache();

// –•—É–∫ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—ç—à–∞ –≤ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
import { useState, useEffect } from "react";

export const useCachedData = <T>(
  key: string,
  fetchFn: () => Promise<T>,
  ttl: number = 300000
): { data: T | null; loading: boolean; error: Error | null } => {
  const [data, setData] = useState<T | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  useEffect(() => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
    const cachedData = dataCache.get<T>(key);

    if (cachedData) {
      setData(cachedData);
      setLoading(false);
      return;
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    const fetchData = async () => {
      try {
        setLoading(true);
        const result = await fetchFn();
        dataCache.set(key, result, ttl);
        setData(result);
      } catch (err) {
        setError(err instanceof Error ? err : new Error("Unknown error"));
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [key, fetchFn, ttl]);

  return { data, loading, error };
};

// –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞ –ø—Ä–∏ –º—É—Ç–∞—Ü–∏—è—Ö
export const invalidateCacheOnMutation = (mutationKey: string) => {
  // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫—ç—à–∏
  const patternsToInvalidate = ["tracks", "playlists", "user", "search"];

  patternsToInvalidate.forEach((pattern) => {
    if (mutationKey.includes(pattern)) {
      dataCache.invalidatePattern(pattern);
    }
  });
};
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ API –∫–ª–∏–µ–Ω—Ç–∞—Ö:

```typescript
// src/lib/api-client.ts
import { dataCache, invalidateCacheOnMutation } from "./data-cache";

class ApiClient {
  private baseUrl: string;

  constructor(baseUrl: string) {
    this.baseUrl = baseUrl;
  }

  // GET –∑–∞–ø—Ä–æ—Å —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
  async get<T>(endpoint: string, cacheTtl: number = 300000): Promise<T> {
    const cacheKey = `GET:${this.baseUrl}${endpoint}`;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
    const cached = dataCache.get<T>(cacheKey);
    if (cached) {
      return cached;
    }

    // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
    const response = await fetch(`${this.baseUrl}${endpoint}`);
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }

    const data = await response.json();

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
    dataCache.set(cacheKey, data, cacheTtl);

    return data;
  }

  // POST –∑–∞–ø—Ä–æ—Å —Å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∫—ç—à–∞
  async post<T>(endpoint: string, body: any): Promise<T> {
    const response = await fetch(`${this.baseUrl}${endpoint}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(body),
    });

    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }

    const data = await response.json();

    // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫—ç—à–∏
    invalidateCacheOnMutation(`POST:${endpoint}`);

    return data;
  }

  // PUT –∑–∞–ø—Ä–æ—Å —Å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∫—ç—à–∞
  async put<T>(endpoint: string, body: any): Promise<T> {
    const response = await fetch(`${this.baseUrl}${endpoint}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(body),
    });

    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }

    const data = await response.json();

    // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫—ç—à–∏
    invalidateCacheOnMutation(`PUT:${endpoint}`);

    return data;
  }

  // DELETE –∑–∞–ø—Ä–æ—Å —Å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∫—ç—à–∞
  async delete<T>(endpoint: string): Promise<T> {
    const response = await fetch(`${this.baseUrl}${endpoint}`, {
      method: "DELETE",
    });

    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }

    const data = await response.json();

    // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫—ç—à–∏
    invalidateCacheOnMutation(`DELETE:${endpoint}`);

    return data;
  }
}

export const apiClient = new ApiClient("/api");
```

### 5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏

#### –ü—Ä–æ–±–ª–µ–º–∞

–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤.

#### –†–µ—à–µ–Ω–∏–µ

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é —Å–±–æ—Ä–∫—É –∏ code splitting.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```javascript
// next.config.js (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
const withBundleAnalyzer = require("@next/bundle-analyzer")({
  enabled: process.env.ANALYZE === "true",
});

/** @type {import('next').NextConfig} */
const nextConfig = {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ...

  // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è webpack
  webpack: (config, { dev, isServer }) => {
    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
    if (!dev && !isServer) {
      // Split chunks –¥–ª—è –ª—É—á—à–µ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
      config.optimization.splitChunks = {
        chunks: "all",
        cacheGroups: {
          vendor: {
            test: /[\\/]node_modules[\\/]/,
            name: "vendors",
            chunks: "all",
            priority: 10,
            reuseExistingChunk: true,
          },
          common: {
            minChunks: 2,
            chunks: "all",
            priority: 5,
            reuseExistingChunk: true,
          },
        },
      };

      // Runtime chunk –¥–ª—è –ª—É—á—à–µ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
      config.optimization.runtimeChunk = "single";

      // –ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è
      config.optimization.minimize = true;
      config.optimization.minimizer = [
        ...config.optimization.minimizer,
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞ –¥–ª—è CSS
        require("css-minimizer-webpack-plugin"),
      ];
    }

    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    config.module.rules.push({
      test: /\.(jpe?g|png|webp|gif|svg)$/i,
      type: "asset/resource",
      generator: {
        filename: "images/[hash][ext][query]",
      },
    });

    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —à—Ä–∏—Ñ—Ç–æ–≤
    config.module.rules.push({
      test: /\.(woff|woff2|eot|ttf|otf)$/i,
      type: "asset/resource",
      generator: {
        filename: "fonts/[hash][ext][query]",
      },
    });

    // Add fallback for node-specific modules
    if (!isServer) {
      config.resolve.fallback = {
        ...config.resolve.fallback,
        fs: false,
        net: false,
        tls: false,
      };
    }

    return config;
  },

  // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
  experimental: {
    optimizeCss: true,
    optimizePackageImports: [
      "lucide-react",
      "@radix-ui/react-icons",
      "@solana/web3.js",
      "@solana/wallet-adapter-react",
    ],
    serverActions: {},
    // –í–∫–ª—é—á–∞–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
    largePageDataBytes: 256 * 1000, // 256KB
  },

  // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  images: {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ...
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    unoptimized: false, // –í–∫–ª—é—á–∞–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
  },

  // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
  swcMinify: true,

  // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Vercel
  poweredByHeader: false,
  compress: true,

  // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
  async headers() {
    return [
      {
        source: "/(.*)",
        headers: [
          // Cache control –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
          {
            key: "Cache-Control",
            value: "public, max-age=31536000, immutable",
          },
          // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
          {
            key: "Link",
            value:
              "</fonts/inter-var-latin.woff2>; rel=preload; as=font; type=font/woff2; crossorigin",
          },
        ],
      },
      // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è API routes
      {
        source: "/api/(.*)",
        headers: [
          {
            key: "Cache-Control",
            value: "no-cache, no-store, must-revalidate",
          },
        ],
      },
    ];
  },
};

module.exports = withBundleAnalyzer(nextConfig);
```

### 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### –ü—Ä–æ–±–ª–µ–º–∞

–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

#### –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Core Web Vitals –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```typescript
// src/lib/performance-monitoring.ts
import { getCLS, getFID, getFCP, getLCP, getTTFB } from "web-vitals";

// –¢–∏–ø—ã –¥–ª—è –º–µ—Ç—Ä–∏–∫
interface PerformanceMetric {
  name: string;
  value: number;
  id: string;
  navigationType?: string;
  entries?: PerformanceEntry[];
}

// –ö–ª–∞—Å—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
class PerformanceMonitor {
  private metrics: PerformanceMetric[] = [];
  private observers: MutationObserver[] = [];

  // –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Web Vitals
  startWebVitalsMonitoring() {
    if (typeof window !== "undefined") {
      getCLS(this.sendToAnalytics);
      getFID(this.sendToAnalytics);
      getFCP(this.sendToAnalytics);
      getLCP(this.sendToAnalytics);
      getTTFB(this.sendToAnalytics);
    }
  }

  // –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Ç—Ä–∏–∫ –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
  private sendToAnalytics = (metric: PerformanceMetric) => {
    this.metrics.push(metric);

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, Vercel Analytics)
    if (typeof window !== "undefined" && (window as any).gtag) {
      (window as any).gtag("event", metric.name, {
        value: Math.round(
          metric.name === "CLS" ? metric.value * 1000 : metric.value
        ),
        event_label: metric.id,
        non_interaction: true,
      });
    }

    // –¢–∞–∫–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    this.sendToServer(metric);
  };

  // –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Ç—Ä–∏–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  private async sendToServer(metric: PerformanceMetric) {
    try {
      await fetch("/api/analytics/performance", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          metric,
          userAgent:
            typeof navigator !== "undefined" ? navigator.userAgent : "",
          timestamp: new Date().toISOString(),
        }),
      });
    } catch (error) {
      console.warn("Failed to send performance metric:", error);
    }
  }

  // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  measureTimeToInteractive() {
    if (typeof window !== "undefined") {
      const startTime = performance.now();

      const checkInteractive = () => {
        if (document.readyState === "complete") {
          const tti = performance.now() - startTime;
          this.sendToAnalytics({
            name: "TTI",
            value: tti,
            id: `tti-${Date.now()}`,
          });
        } else {
          setTimeout(checkInteractive, 100);
        }
      };

      checkInteractive();
    }
  }

  // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ FPS
  monitorFPS() {
    if (typeof window !== "undefined") {
      let frameCount = 0;
      let lastTime = performance.now();
      let fps = 0;

      const measureFPS = () => {
        frameCount++;
        const currentTime = performance.now();

        if (currentTime - lastTime >= 1000) {
          fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
          frameCount = 0;
          lastTime = currentTime;

          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫—É FPS –µ—Å–ª–∏ –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞
          if (fps < 30) {
            this.sendToAnalytics({
              name: "LowFPS",
              value: fps,
              id: `fps-${Date.now()}`,
            });
          }
        }

        requestAnimationFrame(measureFPS);
      };

      requestAnimationFrame(measureFPS);
    }
  }

  // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
  monitorMemoryUsage() {
    if (typeof window !== "undefined" && (performance as any).memory) {
      const memory = (performance as any).memory;

      setInterval(() => {
        this.sendToAnalytics({
          name: "MemoryUsage",
          value: memory.usedJSHeapSize,
          id: `memory-${Date.now()}`,
        });

        // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º –æ –≤—ã—Å–æ–∫–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–∞–º—è—Ç–∏
        if (memory.usedJSHeapSize > memory.jsHeapSizeLimit * 0.8) {
          this.sendToAnalytics({
            name: "HighMemoryUsage",
            value: memory.usedJSHeapSize / memory.jsHeapSizeLimit,
            id: `high-memory-${Date.now()}`,
          });
        }
      }, 30000); // –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    }
  }

  // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤
  monitorScriptErrors() {
    if (typeof window !== "undefined") {
      window.addEventListener("error", (event) => {
        this.sendToAnalytics({
          name: "ScriptError",
          value: 1,
          id: `script-error-${Date.now()}`,
          entries: [
            {
              name: event.error?.message || "Unknown script error",
              entryType: "error",
            } as PerformanceEntry,
          ],
        });
      });
    }
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
  getMetrics(): PerformanceMetric[] {
    return [...this.metrics];
  }

  // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
  destroy() {
    this.observers.forEach((observer) => observer.disconnect());
    this.observers = [];
  }
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –º–æ–Ω–∏—Ç–æ—Ä–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
export const performanceMonitor = new PerformanceMonitor();

// –•—É–∫ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
import { useEffect } from "react";

export const usePerformanceMonitoring = () => {
  useEffect(() => {
    // –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
    performanceMonitor.startWebVitalsMonitoring();
    performanceMonitor.measureTimeToInteractive();
    performanceMonitor.monitorFPS();
    performanceMonitor.monitorMemoryUsage();
    performanceMonitor.monitorScriptErrors();

    // –û—á–∏—â–∞–µ–º –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
    return () => {
      performanceMonitor.destroy();
    };
  }, []);
};

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ dev —Ä–µ–∂–∏–º–µ
import { useState, useEffect } from "react";

export const PerformanceDevTools: React.FC = () => {
  const [metrics, setMetrics] = useState<PerformanceMetric[]>([]);

  useEffect(() => {
    if (process.env.NODE_ENV === "development") {
      const interval = setInterval(() => {
        setMetrics(performanceMonitor.getMetrics());
      }, 1000);

      return () => clearInterval(interval);
    }
  }, []);

  if (process.env.NODE_ENV !== "development") {
    return null;
  }

  return (
    <div className="fixed bottom-4 right-4 bg-black text-white p-4 rounded-lg text-xs z-50 max-w-xs">
      <h3 className="font-bold mb-2">Performance Metrics</h3>
      <div className="space-y-1 max-h-40 overflow-y-auto">
        {metrics.slice(-10).map((metric, index) => (
          <div key={index} className="flex justify-between">
            <span>{metric.name}:</span>
            <span className="font-mono">{metric.value.toFixed(2)}</span>
          </div>
        ))}
      </div>
    </div>
  );
};
```

## üìÖ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ù–µ–¥–µ–ª—è 1

- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ Next.js
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ–º–æ–∏–∑–∞—Ü–∏—é –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –ù–µ–¥–µ–ª—è 2

- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ API –∫–ª–∏–µ–Ω—Ç—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª–∏–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–±–æ—Ä–∫—É —Å code splitting

### –ù–µ–¥–µ–ª—è 3

- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Core Web Vitals
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- [ ] –°–æ–∑–¥–∞—Ç—å –¥–∞—à–±–æ—Ä–¥—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ù–µ–¥–µ–ª—è 4

- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç —Ç–µ–∫—É—â–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—É—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- –°–Ω–∏–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –Ω–∞ 40%
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ Core Web Vitals –æ—Ü–µ–Ω–∫–∏ –¥–æ 90+
- –°–Ω–∏–∂–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ JavaScript –±–∞–Ω–¥–ª–∞ –Ω–∞ 30%
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ First Contentful Paint (FCP) –Ω–∞ 50%
- –°–Ω–∏–∂–µ–Ω–∏–µ Largest Contentful Paint (LCP) –¥–æ 2.5 —Å–µ–∫—É–Ω–¥
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–æ 85%

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- Next.js Image Optimization
- React.lazy –∏ Suspense
- Webpack Bundle Analyzer
- Lighthouse –¥–ª—è –∞—É–¥–∏—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- Web Vitals –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- React Developer Tools
- Chrome DevTools Performance Panel
