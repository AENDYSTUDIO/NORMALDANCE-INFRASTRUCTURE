# План обновления зависимостей с ломающими изменениями

## 1. @solana/wallet-adapter-wallets

### Текущая версия

`^0.19.37`

### Целевая версия

`0.19.33` (содержит исправления безопасности)

### Ломающие изменения

- Изменения в интерфейсах кошельков
- Обновления API для подключения кошельков
- Изменения в типах данных

### План обновления

1. Создать отдельную ветку `security-upgrade-solana-adapters`
2. Обновить зависимость до `0.19.33`
3. Проверить и обновить импорты в `src/components/wallet/wallet-adapter.tsx`
4. Обновить типы интерфейсы в кошельковом адаптере
5. Протестировать все функции подключения кошельков
6. Обновить тесты в `src/components/wallet/__tests__/wallet-adapter.test.tsx`

### Пример изменений

```typescript
// В wallet-adapter.tsx могут потребоваться изменения в импортах:
// Было:
import {
  WalletAdapterNetwork,
  WalletConnectionError,
  BaseMessageSignerWalletAdapter,
} from "@solana/wallet-adapter-base";

// Стало:
import {
  WalletAdapterNetwork,
  WalletConnectionError,
  BaseMessageSignerWalletAdapter,
} from "@solana/wallet-adapter-base";

// Также могут измениться типы в WalletContext
```

## 2. ipfs-http-client

### Текущая версия

`^60.0.1`

### Целевая версия

`39.0.2` (содержит исправления безопасности)

### Ломающие изменения

- Изменения в API для загрузки и извлечения файлов
- Изменения в типах данных
- Изменения в структуре ответов

### План обновления

1. Создать отдельную ветку `security-upgrade-ipfs-client`
2. Обновить зависимость до `39.0.2`
3. Обновить импорты и использование в `src/lib/ipfs.ts` и `src/lib/ipfs-enhanced.ts`
4. Проверить и обновить все вызовы IPFS API
5. Протестировать загрузку и извлечение файлов
6. Обновить тесты в `src/lib/__tests__/ipfstest.ts`

### Пример изменений

```typescript
// В ipfs.ts могут потребоваться изменения в API:
// Было:
const result = await ipfs.add(file, { pin: true });

// Может измениться на:
const result = await ipfs.add(file, { pin: true, cidVersion: 1 });
```

## 3. Общие рекомендации по обновлению

### Подготовка

1. Создать резервную копию проекта
2. Убедиться, что все тесты проходят до обновления
3. Подготовить откатные изменения на случай проблем

### Тестирование

1. Проверить все основные функции приложения после каждого обновления
2. Запустить все юнит- и интеграционные тесты
3. Провести ручное тестирование критических сценариев:
   - Подключение кошельков
   - Транзакции с токенами
   - Загрузка и извлечение файлов через IPFS
   - Работа с NFT

### Постепенное обновление

1. Обновлять зависимости по одной, начиная с наименее критичных
2. После каждого обновления проводить полное тестирование
3. Использовать feature flags для постепенного включения изменений

## 4. Резервный план

### Если обновления вызывают проблемы:

1. Откатить изменения
2. Временно отключить функции, зависящие от уязвимых пакетов
3. Использовать альтернативные решения
4. Продолжить мониторинг обновлений от разработчиков

### Временные меры безопасности:

1. Добавить дополнительную валидацию данных
2. Внедрить более строгие проверки ввода
3. Усилить логирование и мониторинг
