# üìä –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é NORMAL DANCE v1.0.1

## üìã –í–≤–µ–¥–µ–Ω–∏–µ

–≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã NORMAL DANCE v1.0.1. –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞–ª–µ—Ä—Ç–∏–Ω–≥ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

### üéØ –¶–µ–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º** —Ä–∞–Ω–Ω–µ–µ –≤—ã—è–≤–ª–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π –∏ —Å–±–æ–µ–≤
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤** —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Data Collection Layer                                      ‚îÇ
‚îÇ  ‚îú‚îÄ Prometheus (Metrics)                                   ‚îÇ
‚îÇ  ‚îú‚îÄ Fluentd (Logs)                                         ‚îÇ
‚îÇ  ‚îú‚îÄ Jaeger (Traces)                                        ‚îÇ
‚îÇ  ‚îî‚îÄ StatsD (Custom Metrics)                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Processing Layer                                          ‚îÇ
‚îÇ  ‚îú‚îÄ Alertmanager (Alerts)                                  ‚îÇ
‚îÇ  ‚îú‚îÄ Grafana (Visualization)                                ‚îÇ
‚îÇ  ‚îú‚îÄ Kibana (Log Analysis)                                  ‚îÇ
‚îÇ  ‚îî‚îÄ Elasticsearch (Log Storage)                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Storage Layer                                             ‚îÇ
‚îÇ  ‚îú‚îÄ Prometheus (Time Series Data)                          ‚îÇ
‚îÇ  ‚îú‚îÄ Elasticsearch (Log Data)                              ‚îÇ
‚îÇ  ‚îú‚îÄ InfluxDB (Metrics)                                     ‚îÇ
‚îÇ  ‚îî‚îÄ Loki (Log Aggregation)                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Alerting Layer                                            ‚îÇ
‚îÇ  ‚îú‚îÄ Slack/Email Notifications                              ‚îÇ
‚îÇ  ‚îú‚îÄ PagerDuty (Critical Alerts)                            ‚îÇ
‚îÇ  ‚îú‚îÄ Webhooks (Custom Integrations)                         ‚îÇ
‚îÇ  ‚îî‚îÄ SMS (Emergency Alerts)                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìà –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫

### Prometheus Configuration

#### –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
```yaml
# monitoring/prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "alert_rules.yml"

scrape_configs:
  - job_name: 'normaldance-api'
    static_configs:
      - targets: ['normaldance-api:3000']
    metrics_path: '/metrics'
    scrape_interval: 15s
    scrape_timeout: 10s
    labels:
      environment: 'production'
      service: 'api'

  - job_name: 'normaldance-websocket'
    static_configs:
      - targets: ['normaldance-websocket:3001']
    metrics_path: '/metrics'
    scrape_interval: 15s
    scrape_timeout: 10s
    labels:
      environment: 'production'
      service: 'websocket'

  - job_name: 'normaldance-database'
    static_configs:
      - targets: ['postgres:5432']
    metrics_path: '/metrics'
    scrape_interval: 30s
    scrape_timeout: 10s
    labels:
      environment: 'production'
      service: 'database'

  - job_name: 'normaldance-redis'
    static_configs:
      - targets: ['redis:6379']
    metrics_path: '/metrics'
    scrape_interval: 30s
    scrape_timeout: 10s
    labels:
      environment: 'production'
      service: 'redis'

  - job_name: 'normaldance-solana'
    static_configs:
      - targets: ['solana:8899']
    metrics_path: '/metrics'
    scrape_interval: 30s
    scrape_timeout: 10s
    labels:
      environment: 'production'
      service: 'solana'
```

#### –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤
```yaml
# monitoring/alert_rules.yml
groups:
  - name: normaldance_alerts
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High error rate on {{ $labels.instance }}"
          description: "Error rate is {{ $value }} errors per second"

      - alert: HighResponseTime
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High response time on {{ $labels.instance }}"
          description: "95th percentile response time is {{ $value }} seconds"

      - alert: DatabaseConnectionErrors
        expr: rate(pg_stat_database_deadlocks[5m]) > 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Database connection errors on {{ $labels.instance }}"
          description: "Deadlock rate is {{ $value }} per second"

      - alert: HighMemoryUsage
        expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage on {{ $labels.instance }}"
          description: "Memory usage is {{ $value }}%"

      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage on {{ $labels.instance }}"
          description: "CPU usage is {{ $value }}%"

      - alert: SolanaConnectionErrors
        expr: rate(solana_rpc_errors_total[5m]) > 0.1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Solana connection errors on {{ $labels.instance }}"
          description: "Error rate is {{ $value }} errors per second"

      - alert: WebSocketConnectionErrors
        expr: rate(socketio_errors_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "WebSocket connection errors on {{ $labels.instance }}"
          description: "Error rate is {{ $value }} errors per second"
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

#### –í Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
```typescript
// src/lib/metrics.ts
import { Counter, Histogram, Gauge } from 'prom-client'

// –°—á–µ—Ç—á–∏–∫–∏
export const httpRequestCounter = new Counter({
  name: 'http_requests_total',
  help: 'Total number of HTTP requests',
  labelNames: ['method', 'route', 'status', 'service']
})

export const errorCounter = new Counter({
  name: 'errors_total',
  help: 'Total number of errors',
  labelNames: ['type', 'service', 'environment']
})

export const userActionCounter = new Counter({
  name: 'user_actions_total',
  help: 'Total number of user actions',
  labelNames: ['action', 'user_type', 'service']
})

// –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
export const httpRequestDuration = new Histogram({
  name: 'http_request_duration_seconds',
  help: 'HTTP request duration in seconds',
  labelNames: ['method', 'route', 'status', 'service'],
  buckets: [0.1, 0.5, 1, 2, 5, 10]
})

export const databaseQueryDuration = new Histogram({
  name: 'database_query_duration_seconds',
  help: 'Database query duration in seconds',
  labelNames: ['query_type', 'table', 'service'],
  buckets: [0.01, 0.05, 0.1, 0.5, 1, 5]
})

export const websocketMessageDuration = new Histogram({
  name: 'websocket_message_duration_seconds',
  help: 'WebSocket message processing duration in seconds',
  labelNames: ['message_type', 'service'],
  buckets: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5]
})

// –ò–∑–º–µ—Ä–∏—Ç–µ–ª–∏
export const activeUsersGauge = new Gauge({
  name: 'active_users_total',
  help: 'Number of active users',
  labelNames: ['service', 'environment']
})

export const activeConnectionsGauge = new Gauge({
  name: 'active_connections_total',
  help: 'Number of active connections',
  labelNames: ['service', 'connection_type']
})

export const systemHealthGauge = new Gauge({
  name: 'system_health_score',
  help: 'System health score (0-100)',
  labelNames: ['service', 'component']
})
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –≤ API
```typescript
// src/app/api/tracks/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { httpRequestCounter, httpRequestDuration, errorCounter } from '@/lib/metrics'

export async function GET(request: NextRequest) {
  const startTime = Date.now()
  
  try {
    const tracks = await getTracks()
    
    httpRequestCounter.inc({
      method: 'GET',
      route: '/api/tracks',
      status: '200',
      service: 'api'
    })
    
    httpRequestDuration.observe({
      method: 'GET',
      route: '/api/tracks',
      status: '200',
      service: 'api'
    }, (Date.now() - startTime) / 1000)
    
    return NextResponse.json(tracks)
  } catch (error) {
    errorCounter.inc({
      type: 'database_error',
      service: 'api',
      environment: process.env.NODE_ENV
    })
    
    httpRequestDuration.observe({
      method: 'GET',
      route: '/api/tracks',
      status: '500',
      service: 'api'
    }, (Date.now() - startTime) / 1000)
    
    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 })
  }
}
```

#### WebSocket –º–µ—Ç—Ä–∏–∫–∏
```typescript
// src/lib/websocket-metrics.ts
import { websocketMessageDuration, activeConnectionsGauge } from './metrics'

export class WebSocketMetrics {
  private static instance: WebSocketMetrics
  private connectionCounts = new Map<string, number>()

  static getInstance(): WebSocketMetrics {
    if (!WebSocketMetrics.instance) {
      WebSocketMetrics.instance = new WebSocketMetrics()
    }
    return WebSocketMetrics.instance
  }

  trackConnection(service: string, connectionType: string, increment: number = 1) {
    const key = `${service}:${connectionType}`
    const current = this.connectionCounts.get(key) || 0
    this.connectionCounts.set(key, current + increment)
    
    activeConnectionsGauge.set(
      { service, connection_type: connectionType },
      current + increment
    )
  }

  trackMessageProcessing(service: string, messageType: string, duration: number) {
    websocketMessageDuration.observe(
      { service, message_type: messageType },
      duration
    )
  }
}
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Winston
```typescript
// src/lib/logger.ts
import winston from 'winston'
import { ElasticsearchTransport } from '@elastic/transport'
import { Client } from '@elastic/elasticsearch'

const esClient = new Client({
  node: process.env.ELASTICSEARCH_URL || 'http://localhost:9200'
})

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: { service: 'normaldance-api' },
  transports: [
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      )
    }),
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' }),
    new ElasticsearchTransport({
      level: 'info',
      client: esClient,
      index: 'normaldance-logs'
    })
  ]
})

export default logger
```

#### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ª–æ–≥–≥–µ—Ä—ã
```typescript
// src/lib/request-logger.ts
import logger from './logger'

export class RequestLogger {
  static logRequest(req: any, res: any, startTime: number) {
    const duration = Date.now() - startTime
    
    logger.info('HTTP Request', {
      method: req.method,
      url: req.url,
      userAgent: req.get('User-Agent'),
      ip: req.ip,
      statusCode: res.statusCode,
      duration,
      service: 'api'
    })
  }

  static logError(error: Error, req: any) {
    logger.error('Request Error', {
      error: error.message,
      stack: error.stack,
      method: req.method,
      url: req.url,
      userAgent: req.get('User-Agent'),
      ip: req.ip,
      service: 'api'
    })
  }

  static logUserAction(userId: string, action: string, details: any = {}) {
    logger.info('User Action', {
      userId,
      action,
      details,
      timestamp: new Date().toISOString(),
      service: 'api'
    })
  }
}
```

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
```typescript
// src/lib/transaction-logger.ts
import logger from './logger'

export class TransactionLogger {
  static logTransaction(transaction: any) {
    logger.info('Blockchain Transaction', {
      signature: transaction.signature,
      type: transaction.type,
      from: transaction.from,
      to: transaction.to,
      amount: transaction.amount,
      timestamp: new Date().toISOString(),
      service: 'blockchain'
    })
  }

  static logNFTTransfer(nftId: string, from: string, to: string, price: number) {
    logger.info('NFT Transfer', {
      nftId,
      from,
      to,
      price,
      timestamp: new Date().toISOString(),
      service: 'nft'
    })
  }

  static logStaking(stakeId: string, userId: string, amount: number, poolId: string) {
    logger.info('Staking Operation', {
      stakeId,
      userId,
      amount,
      poolId,
      timestamp: new Date().toISOString(),
      service: 'staking'
    })
  }
}
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```typescript
// src/lib/security-logger.ts
import logger from './logger'

export class SecurityLogger {
  static logSecurityEvent(event: string, details: any) {
    logger.warn('Security Event', {
      event,
      details,
      timestamp: new Date().toISOString(),
      service: 'security'
    })
  }

  static logFailedLogin(email: string, ip: string, userAgent: string) {
    logger.warn('Failed Login Attempt', {
      email,
      ip,
      userAgent,
      timestamp: new Date().toISOString(),
      service: 'security'
    })
  }

  static logSuspiciousActivity(userId: string, activity: string, details: any) {
    logger.warn('Suspicious Activity', {
      userId,
      activity,
      details,
      timestamp: new Date().toISOString(),
      service: 'security'
    })
  }

  static logDataAccess(userId: string, dataType: string, operation: string, details: any) {
    logger.info('Data Access', {
      userId,
      dataType,
      operation,
      details,
      timestamp: new Date().toISOString(),
      service: 'security'
    })
  }
}
```

## üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –¥–∞—à–±–æ—Ä–¥—ã

### Grafana –¥–∞—à–±–æ—Ä–¥—ã

#### –û—Å–Ω–æ–≤–Ω–æ–π –¥–∞—à–±–æ—Ä–¥
```json
{
  "dashboard": {
    "id": null,
    "title": "NormalDance Main Dashboard",
    "tags": ["normaldance", "main"],
    "timezone": "browser",
    "panels": [
      {
        "id": 1,
        "title": "HTTP Requests Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])",
            "legendFormat": "{{method}} {{route}}"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
      },
      {
        "id": 2,
        "title": "Error Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total{status=~\"5..\"}[5m])",
            "legendFormat": "5xx Errors"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
      },
      {
        "id": 3,
        "title": "Response Time",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "95th percentile"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
      },
      {
        "id": 4,
        "title": "Active Users",
        "type": "singlestat",
        "targets": [
          {
            "expr": "active_users_total"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
      }
    ]
  }
}
```

#### –î–∞—à–±–æ—Ä–¥ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```json
{
  "dashboard": {
    "id": null,
    "title": "Database Metrics",
    "tags": ["normaldance", "database"],
    "panels": [
      {
        "id": 1,
        "title": "Database Connections",
        "type": "graph",
        "targets": [
          {
            "expr": "pg_stat_database_numbackends",
            "legendFormat": "Active Connections"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
      },
      {
        "id": 2,
        "title": "Query Performance",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(database_query_duration_sum[5m]) / rate(database_query_duration_count[5m])",
            "legendFormat": "Average Query Time"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
      },
      {
        "id": 3,
        "title": "Deadlocks",
        "type": "singlestat",
        "targets": [
          {
            "expr": "rate(pg_stat_database_deadlocks[5m])"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
      }
    ]
  }
}
```

#### –î–∞—à–±–æ—Ä–¥ WebSocket
```json
{
  "dashboard": {
    "id": null,
    "title": "WebSocket Metrics",
    "tags": ["normaldance", "websocket"],
    "panels": [
      {
        "id": 1,
        "title": "Active WebSocket Connections",
        "type": "graph",
        "targets": [
          {
            "expr": "active_connections_total{connection_type=\"websocket\"}",
            "legendFormat": "WebSocket Connections"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
      },
      {
        "id": 2,
        "title": "Message Processing Time",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(websocket_message_duration_bucket[5m]))",
            "legendFormat": "95th percentile"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
      }
    ]
  }
}
```

## üö® –ê–ª–µ—Ä—Ç–∏–Ω–≥

### Alertmanager Configuration
```yaml
# monitoring/alertmanager/alertmanager.yml
global:
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alerts@normaldance.com'
  smtp_auth_username: 'alerts@normaldance.com'
  smtp_auth_password: 'your-smtp-password'

route:
  group_by: ['alertname', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'web.hook'

receivers:
- name: 'web.hook'
  email_configs:
  - to: 'admin@normaldance.com'
    subject: 'NormalDance Alert: {{ .GroupLabels.alertname }}'
    body: |
      {{ range .Alerts }}
      Alert: {{ .Annotations.summary }}
      Description: {{ .Annotations.description }}
      Labels: {{ .Labels }}
      {{ end }}
  
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
    channel: '#alerts'
    title: 'NormalDance Alert'
    text: |
      {{ range .Alerts }}
      *{{ .Annotations.summary }}*
      {{ .Annotations.description }}
      {{ end }}

- name: 'pagerduty'
  pagerduty_configs:
  - service_key: 'your-pagerduty-service-key'
    severity: 'critical'

- name: 'critical'
  email_configs:
  - to: 'critical-team@normaldance.com'
    subject: 'CRITICAL: {{ .GroupLabels.alertname }}'
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
    channel: '#critical-alerts'
    color: 'danger'

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'service']
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã
```typescript
// src/lib/alerting.ts
import { AlertManager } from 'alertmanager-client'

const alertManager = new AlertManager({
  host: 'localhost',
  port: 9093,
  path: '/api/v1/alerts'
})

export class AlertService {
  static async sendAlert(
    alertName: string,
    severity: 'critical' | 'warning' | 'info',
    message: string,
    labels: Record<string, string> = {}
  ) {
    const alert = {
      labels: {
        alertname: alertName,
        severity,
        service: 'normaldance-api',
        ...labels
      },
      annotations: {
        summary: message,
        description: message
      },
      startsAt: new Date().toISOString()
    }

    try {
      await alertManager.post(alert)
      console.log(`Alert sent: ${alertName}`)
    } catch (error) {
      console.error('Failed to send alert:', error)
    }
  }

  static async sendCriticalAlert(message: string, labels?: Record<string, string>) {
    await this.sendAlert('Critical Error', 'critical', message, labels)
  }

  static async sendWarningAlert(message: string, labels?: Record<string, string>) {
    await this.sendAlert('Warning', 'warning', message, labels)
  }

  static async sendInfoAlert(message: string, labels?: Record<string, string>) {
    await this.sendAlert('Info', 'info', message, labels)
  }
}
```

## üîç –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
```typescript
// src/lib/database-monitoring.ts
import { databaseQueryDuration } from './metrics'

export class DatabaseMonitor {
  static async monitorQuery(query: string, params: any[], callback: () => Promise<any>) {
    const startTime = Date.now()
    
    try {
      const result = await callback()
      const duration = (Date.now() - startTime) / 1000
      
      databaseQueryDuration.observe(
        { query_type: 'select', table: this.getTableFromQuery(query) },
        duration
      )
      
      return result
    } catch (error) {
      const duration = (Date.now() - startTime) / 1000
      databaseQueryDuration.observe(
        { query_type: 'select', table: this.getTableFromQuery(query) },
        duration
      )
      throw error
    }
  }

  private static getTableFromQuery(query: string): string {
    // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
    const match = query.match(/FROM\s+(\w+)/i)
    return match ? match[1] : 'unknown'
  }
}
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
```typescript
// src/lib/websocket-monitoring.ts
import { WebSocketMetrics } from './websocket-metrics'

export class WebSocketMonitor {
  static trackMessageProcessing(socket: any, messageType: string, callback: () => Promise<any>) {
    const startTime = Date.now()
    
    return callback().finally(() => {
      const duration = Date.now() - startTime
      WebSocketMetrics.getInstance().trackMessageProcessing(
        'websocket',
        messageType,
        duration
      )
    })
  }

  static trackConnection(socket: any, connectionType: string) {
    WebSocketMetrics.getInstance().trackConnection(
      'websocket',
      connectionType,
      1
    )
  }
}
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ü–∞–º—è—Ç—å —É—Ç–µ—á–∫–∏
```typescript
// src/lib/memory-monitoring.ts
import { Gauge } from 'prom-client'

const memoryUsageGauge = new Gauge({
  name: 'nodejs_memory_usage_bytes',
  help: 'Memory usage in bytes',
  labelNames: ['type', 'service']
})

export class MemoryMonitor {
  static startMonitoring() {
    setInterval(() => {
      const usage = process.memoryUsage()
      
      memoryUsageGauge.set({ type: 'rss', service: 'api' }, usage.rss)
      memoryUsageGauge.set({ type: 'heapTotal', service: 'api' }, usage.heapTotal)
      memoryUsageGauge.set({ type: 'heapUsed', service: 'api' }, usage.heapUsed)
      memoryUsageGauge.set({ type: 'external', service: 'api' }, usage.external)
    }, 30000) // –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
  }
}
```

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
```typescript
// src/lib/analytics.ts
import { userActionCounter } from './metrics'

export class AnalyticsService {
  static trackUserAction(userId: string, action: string, details: any = {}) {
    userActionCounter.inc({
      action,
      user_type: this.getUserType(userId),
      service: 'api'
    })
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É
    this.sendToAnalytics({
      userId,
      action,
      details,
      timestamp: new Date().toISOString()
    })
  }

  static trackPageView(userId: string, page: string, referrer?: string) {
    this.trackUserAction(userId, 'page_view', {
      page,
      referrer
    })
  }

  static trackEvent(userId: string, event: string, properties: any = {}) {
    this.trackUserAction(userId, 'event', {
      event,
      properties
    })
  }

  private static getUserType(userId: string): string {
    // –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    return 'user'
  }

  private static async sendToAnalytics(data: any) {
    try {
      await fetch('/api/analytics', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
    } catch (error) {
      console.error('Failed to send analytics:', error)
    }
  }
}
```

### –û—Ç—á–µ—Ç—ã –∏ –¥–∞—à–±–æ—Ä–¥—ã
```typescript
// src/lib/reports.ts
import logger from './logger'

export class ReportService {
  static async generateDailyReport() {
    const report = {
      date: new Date().toISOString().split('T')[0],
      metrics: {
        totalUsers: await this.getTotalUsers(),
        activeUsers: await this.getActiveUsers(),
        totalTracks: await this.getTotalTracks(),
        totalNFTs: await this.getTotalNFTs(),
        totalTransactions: await this.getTotalTransactions()
      },
      errors: await this.getErrorSummary(),
      performance: await this.getPerformanceSummary()
    }

    logger.info('Daily Report Generated', report)
    return report
  }

  private static async getTotalUsers(): Promise<number> {
    // –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    return 0
  }

  private static async getActiveUsers(): Promise<number> {
    // –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —á–∏—Å–ª–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    return 0
  }

  private static async getTotalTracks(): Promise<number> {
    // –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ —Ç—Ä–µ–∫–æ–≤
    return 0
  }

  private static async getTotalNFTs(): Promise<number> {
    // –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ NFT
    return 0
  }

  private static async getTotalTransactions(): Promise<number> {
    // –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    return 0
  }

  private static async getErrorSummary(): Promise<any> {
    // –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–æ–¥–∫–∏ –ø–æ –æ—à–∏–±–∫–∞–º
    return {}
  }

  private static async getPerformanceSummary(): Promise<any> {
    // –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–æ–¥–∫–∏ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    return {}
  }
}
```

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Sentry –¥–ª—è –æ—à–∏–±–æ–∫
```typescript
// src/lib/sentry.ts
import * as Sentry from '@sentry/node'

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  tracesSampleRate: 1.0,
  environment: process.env.NODE_ENV,
  release: process.env.npm_package_version
})

export class SentryService {
  static captureException(error: Error, context?: any) {
    Sentry.captureException(error, {
      extra: context
    })
  }

  static captureMessage(message: string, level: Sentry.Severity = 'info') {
    Sentry.captureMessage(message, level)
  }

  static setUser(user: { id: string; email?: string }) {
    Sentry.setUser(user)
  }

  static configureScope(callback: (scope: Sentry.Scope) => void) {
    Sentry.configureScope(callback)
  }
}
```

### Datadog –¥–ª—è APM
```typescript
// src/lib/datadog.ts
import { StatsD } from 'hot-shots'

const statsd = new StatsD({
  host: process.env.DATADOG_HOST || 'localhost',
  port: 8125,
  prefix: 'normaldance.'
})

export class DatadogService {
  static increment(metric: string, tags: Record<string, string> = {}) {
    statsd.increment(metric, 1, tags)
  }

  static decrement(metric: string, tags: Record<string, string> = {}) {
    statsd.decrement(metric, 1, tags)
  }

  static timing(metric: string, milliseconds: number, tags: Record<string, string> = {}) {
    statsd.timing(metric, milliseconds, tags)
  }

  static gauge(metric: string, value: number, tags: Record<string, string> = {}) {
    statsd.gauge(metric, value, tags)
  }

  static histogram(metric: string, value: number, tags: Record<string, string> = {}) {
    statsd.histogram(metric, value, tags)
  }
}
```

## üìö –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è NORMAL DANCE v1.0.1 –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –ø–æ–∑–≤–æ–ª—è—èÂèäÊó∂ÂèëÁé∞ –∏ —Ä–µ—à–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã, –∞ —Ç–∞–∫–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- **Prometheus** –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
- **Grafana** –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- **Alertmanager** –¥–ª—è –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞
- **Winston** –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- **Elasticsearch** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤
- **Sentry** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
- **Datadog** –¥–ª—è APM

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.

---

**–°–æ–∑–¥–∞–Ω–æ:** –°–µ–Ω—Ç—è–±—Ä—å 2025
**–í–µ—Ä—Å–∏—è:** v1.0.1
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –°–µ–Ω—Ç—è–±—Ä—å 2025
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** DevOps Lead - –ö—É–∑–Ω–µ—Ü–æ–≤ –í.–ê.