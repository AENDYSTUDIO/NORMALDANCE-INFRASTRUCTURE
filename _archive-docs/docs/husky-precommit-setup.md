# Настройка Husky и pre-commit хуков

## Обзор

Проект использует Husky для автоматизации проверок перед коммитом. Это помогает предотвратить попадание потенциальных уязвимостей и проблемного кода в репозиторий.

## Установленные проверки

### 1. Линтинг

- Проверка кода на соответствие установленным правилам
- Запускается через `npm run lint`

### 2. Проверка типов

- Проверка TypeScript типов
- Запускается через `npm run type-check`

### 3. Тестирование

- Запуск юнит-тестов
- Запускается через `npm test`

### 4. Сканирование секретов

- Проверка на наличие потенциальных секретов в коде
- Использует несколько инструментов для комплексной проверки

## Unified Secret Scanning

### Скрипт: `scripts/hooks/pre-commit`

Unified скрипт проверки секретов объединяет несколько инструментов:

1. **Внутренний сканер** (`scripts/check-hardcoded-secrets.js`)

   - Проверяет наличие потенциальных секретов в текстовых файлах
   - Использует регулярные выражения для поиска API ключей, токенов, JWT и т.д.
   - Исключает ложные срабатывания и служебные файлы

2. **TruffleHog** (опционально)

   - Сканирование git истории на предмет утечек секретов
   - Требуется установка trufflehog

3. **Git-secrets** (опционально)
   - Стандартный инструмент AWS для поиска секретов
   - Требуется установка git-secrets

## Настройка

### Установка зависимостей

```bash
# Установка husky
npm install husky --save-dev

# Установка trufflehog (опционально)
# См. https://github.com/trufflesecurity/truffleHog

# Установка git-secrets (опционально)
# См. https://github.com/awslabs/git-secrets
```

### Инициализация Husky

```bash
npx husky install
```

## Пользовательские скрипты

### `scripts/check-hardcoded-secrets.js`

Кастомный скрипт для поиска потенциальных утечек секретов:

```bash
# Запуск вручную
node scripts/check-hardcoded-secrets.js

# Запуск через npm
npm run security:secrets
```

Скрипт проверяет:

- API ключи и токены
- JWT токены
- Приватные ключи
- Solana ключи
- PINATA ключи
- Другие потенциальные секреты

Исключает:

- Файлы node_modules
- .git директорию
- Служебные файлы (build, dist, .next и др.)
- Файлы с фиктивными значениями

## Настройка для разработчиков

Для активации pre-commit хуков, разработчику нужно выполнить:

```bash
# После клонирования репозитория
npm install
npx husky install
```

## Обход проверок (только при необходимости)

В редких случаях, когда нужно обойти проверки (например, для тестовых данных):

```bash
# Пропустить pre-commit хуки
git commit --no-verify -m "commit message"

# Или
git commit --no-verify -m "commit message"
```

**Важно**: Используйте только в исключительных случаях и с пониманием рисков.

## Troubleshooting

### Проблемы с доступом к файлам в Windows

Если возникают проблемы с выполнением скриптов в Windows:

```bash
# Включить выполнение скриптов
git config core.filemode false

# Или использовать Git Bash для коммитов
```

### Проблемы с husky в Windows

```bash
# Убедиться, что husky установлен
npm install husky --save-dev

# Переустановить хуки
npx husky install
npx husky add .husky/pre-commit "npm test"
```
