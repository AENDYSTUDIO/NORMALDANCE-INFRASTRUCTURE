# План обновления безопасности зависимостей

## Обнаруженные уязвимости

### 1. bigint-buffer (высокий уровень угрозы)

- **Проблема**: Уязвимость Buffer Overflow в пакете bigint-buffer
- **Зависимость**: @solana/buffer-layout-utils → @solana/spl-token → @solana/pay
- **Решение**:
  - Проверить наличие обновлений для @solana/spl-token
  - Рассмотреть возможность временного форка или альтернативной реализации
- Контрольная мера: ограничить размеры данных, передаваемых в Solana-транзакциях

### 2. fast-redact (средний уровень угрозы)

- **Проблема**: Уязвимость prototype pollution в fast-redact
- **Зависимость**: pino → @walletconnect/logger → @reown/appkit и др.
- **Решение**:
- Обновить @solana/wallet-adapter-wallets до версии 0.19.33 (ломающие изменения)
- Рассмотреть замену pino на другой логгер или обновление до версии с исправленным fast-redact

### 3. nanoid (средний уровень угрозы)

- **Проблема**: Предсказуемые результаты при некорректных значениях
- **Зависимость**: interface-datastore → ipfs-core-types и ipfs-core-utils
- **Решение**:
- Обновить ipfs-http-client до версии 39.0.2 (ломающие изменения)
- Рассмотреть переход на Helia как часть миграции IPFS (уже в плане)

### 4. parse-duration (высокий уровень угрозы)

- **Проблема**: DoS через регулярное выражение
- **Зависимость**: ipfs-core-utils → ipfs-http-client
- **Решение**:
  - Обновить ipfs-http-client до версии 39.0.2 (ломающие изменения)

## Рекомендуемые действия

### Краткосрочные (для немедленного выполнения)

1. Обновить package.json с принудительными переопределениями для nanoid и parse-duration
2. Обновить ipfs-http-client до последней безопасной версии
3. Временно исключить bigint-buffer и fast-redact из критических компонентов

### Среднесрочные (в рамках текущего спринта)

1. Провести тестирование совместимости после обновления зависимостей
2. Обновить @solana/spl-token и связанные пакеты
3. Рассмотреть альтернативы для pino логгера

### Долгосрочные (в рамках миграции)

1. Завершить миграцию с IPFS на Helia (уже в плане)
2. Обновить систему ведения логов
3. Заменить устаревшие Solana-библиотеки

## Риски

- Обновление @solana/wallet-adapter-wallets может привести к ломающим изменениям
- Обновление ipfs-http-client может повлиять на работу системы хранения
- Некоторые уязвимости могут не иметь немедленного решения из-за зависимости от внешних библиотек

## Рекомендации по снижению рисков

1. Создать тестовую ветку для обновления зависимостей
2. Провести полное тестирование после каждого обновления
3. Подготовить откатные изменения на случай проблем
4. Рассмотреть поэтапное обновление с тестированием между этапами
