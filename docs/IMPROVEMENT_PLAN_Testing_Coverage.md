# üß™ –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏ NORMAL DANCE

## üéØ –¶–µ–ª—å

–ü–æ–≤—ã—Å–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∏ –ø–æ–ª–Ω–æ—Ç—É —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞ NORMAL DANCE –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–π.

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

- –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: ~60% (–±–∞–∑–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã: ~40% (—á–∞—Å—Ç–∏—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)
- E2E —Ç–µ—Å—Ç—ã: ~10% (—Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)
- –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã: ~5% (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç)
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã: ~30% (—á–∞—Å—Ç–∏—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ)

### –ü—Ä–æ–±–ª–µ–º—ã

1. –ú–Ω–æ–≥–∏–µ —Ç–µ—Å—Ç—ã —è–≤–ª—è—é—Ç—Å—è "–∑–∞–≥–ª—É—à–∫–∞–º–∏" –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏
2. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
3. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –æ—à–∏–±–æ–∫ –∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
4. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
5. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìà –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏—è

### 1. –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ü—Ä–æ–±–ª–µ–º–∞

–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–π, –Ω–æ –Ω–µ –∏—Ö –ª–æ–≥–∏–∫—É.

#### –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã —Å –º–æ–∫–∞–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ª–æ–≥–∏–∫–∏.

#### –ü—Ä–∏–º–µ—Ä —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è `ipfs-helia-adapter.test.ts`:

```typescript
// –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è IPFS Helia –∞–¥–∞–ø—Ç–µ—Ä–∞
import { afterEach, beforeEach, describe, expect, it, vi } from "@jest/globals";

// –ú–æ–∫–∞–µ–º Helia –∏ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
const mockAddBytes = vi.fn();
const mockCat = vi.fn();
const mockPinsAdd = vi.fn();
const mockPinsRm = vi.fn();

vi.mock("helia", () => ({
  createHelia: vi.fn().mockResolvedValue({
    pins: {
      add: mockPinsAdd,
      rm: mockPinsRm,
    },
  }),
}));

vi.mock("@helia/unixfs", () => ({
  unixfs: vi.fn().mockReturnValue({
    addBytes: mockAddBytes,
    cat: mockCat,
  }),
}));

// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
import {
  uploadToIPFSHelia,
  getFileFromIPFSHelia,
  pinFileHelia,
  unpinFileHelia,
} from "../../src/lib/ipfs-helia-adapter";

describe("IPFS Helia Adapter Tests", () => {
  beforeEach(() => {
    // –û—á–∏—â–∞–µ–º –º–æ–∫–∏ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º
    vi.clearAllMocks();
  });

  afterEach(() => {
    vi.resetAllMocks();
  });

  describe("uploadToIPFSHelia", () => {
    it("should upload file to IPFS successfully", async () => {
      // Given
      const mockFile = new File(["test content"], "test.txt", {
        type: "text/plain",
      });
      const mockCid = { toString: () => "QmTest123" };
      mockAddBytes.mockResolvedValue(mockCid);

      // When
      const result = await uploadToIPFSHelia(mockFile);

      // Then
      expect(result).toEqual({
        cid: "QmTest123",
        size: 12, // —Ä–∞–∑–º–µ—Ä "test content"
      });
      expect(mockAddBytes).toHaveBeenCalledWith(expect.any(Uint8Array));
    });

    it("should reject files larger than 100MB", async () => {
      // Given
      // –°–æ–∑–¥–∞–µ–º –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª (101MB)
      const largeFile = new File(
        [new ArrayBuffer(101 * 1024 * 1024)],
        "large.txt"
      );

      // When/Then
      await expect(uploadToIPFSHelia(largeFile)).rejects.toThrow("File size");
    });

    it("should handle upload errors gracefully", async () => {
      // Given
      const mockFile = new File(["test content"], "test.txt");
      mockAddBytes.mockRejectedValue(new Error("Network error"));

      // When/Then
      await expect(uploadToIPFSHelia(mockFile)).rejects.toThrow(
        "Failed to upload"
      );
    });
  });

  describe("getFileFromIPFSHelia", () => {
    it("should retrieve file from IPFS successfully", async () => {
      // Given
      const mockCid = "QmTest123";
      const mockData = new TextEncoder().encode("test content");
      mockCat.mockReturnValue([mockData]);

      // When
      const result = await getFileFromIPFSHelia(mockCid);

      // Then
      expect(result).toBeInstanceOf(Buffer);
      expect(result.toString()).toBe("test content");
      expect(mockCat).toHaveBeenCalledWith(mockCid);
    });

    it("should validate CID format", async () => {
      // Given
      const invalidCid = "";

      // When/Then
      await expect(getFileFromIPFSHelia(invalidCid)).rejects.toThrow(
        "Invalid CID"
      );
    });
  });

  describe("pinFileHelia", () => {
    it("should pin file successfully", async () => {
      // Given
      const mockCid = "QmTest123";
      mockPinsAdd.mockResolvedValue(undefined);

      // When
      const result = await pinFileHelia(mockCid);

      // Then
      expect(result).toBe(true);
      expect(mockPinsAdd).toHaveBeenCalledWith(mockCid);
    });

    it("should handle pinning errors", async () => {
      // Given
      const mockCid = "QmTest123";
      mockPinsAdd.mockRejectedValue(new Error("Pin failed"));

      // When
      const result = await pinFileHelia(mockCid);

      // Then
      expect(result).toBe(false);
    });
  });

  describe("unpinFileHelia", () => {
    it("should unpin file successfully", async () => {
      // Given
      const mockCid = "QmTest123";
      mockPinsRm.mockResolvedValue(undefined);

      // When
      const result = await unpinFileHelia(mockCid);

      // Then
      expect(result).toBe(true);
      expect(mockPinsRm).toHaveBeenCalledWith(mockCid);
    });
  });
});
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### –ü—Ä–æ–±–ª–µ–º–∞

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –æ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.

#### –†–µ—à–µ–Ω–∏–µ

–†–∞—Å—à–∏—Ä–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

#### –ü—Ä–∏–º–µ—Ä –Ω–æ–≤—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:

```typescript
// tests/integration/user-workflow.test.ts
import { describe, it, expect } from "@jest/globals";

describe("User Workflow Integration Tests", () => {
  describe("Complete Artist Journey", () => {
    it("should handle artist registration, track upload, and monetization", async () => {
      // 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞—Ä—Ç–∏—Å—Ç–∞
      const artistData = {
        email: "artist@test.com",
        username: "test-artist",
        password: "SecurePass123!",
        displayName: "Test Artist",
        bio: "Electronic music producer",
      };

      const registrationResult = await api.auth.register(artistData);
      expect(registrationResult.status).toBe(201);
      expect(registrationResult.data.user.isArtist).toBe(true);

      // 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
      const walletConnection = await api.wallet.connect("phantom");
      expect(walletConnection.status).toBe(200);
      expect(walletConnection.data.connected).toBe(true);

      // 3. –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–∞
      const trackData = {
        title: "My First Track",
        genre: "Electronic",
        price: 9.99,
        file: createMockAudioFile(),
        cover: createMockImageFile(),
      };

      const uploadResult = await api.tracks.upload(trackData);
      expect(uploadResult.status).toBe(200);
      expect(uploadResult.data.trackId).toBeDefined();

      // 4. –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ç—Ä–µ–∫–∞
      const publishResult = await api.tracks.publish(uploadResult.data.trackId);
      expect(publishResult.status).toBe(200);
      expect(publishResult.data.published).toBe(true);

      // 5. –°–æ–∑–¥–∞–Ω–∏–µ NFT –¥–ª—è —Ç—Ä–µ–∫–∞
      const nftResult = await api.nft.create(uploadResult.data.trackId);
      expect(nftResult.status).toBe(200);
      expect(nftResult.data.nftId).toBeDefined();
    });
  });

  describe("User Purchase Journey", () => {
    it("should handle user purchase, playback, and royalty distribution", async () => {
      // 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º—É
      const loginResult = await api.auth.login({
        email: "user@test.com",
        password: "UserPass123!",
      });
      expect(loginResult.status).toBe(200);

      // 2. –ü–æ–∏—Å–∫ –∏ –ø–æ–∫—É–ø–∫–∞ —Ç—Ä–µ–∫–∞
      const searchResult = await api.search.tracks({ q: "My First Track" });
      const trackId = searchResult.data.tracks[0].id;

      const purchaseResult = await api.purchases.buy(trackId, {
        paymentMethod: "solana",
        wallet: "user-wallet-address",
      });
      expect(purchaseResult.status).toBe(200);
      expect(purchaseResult.data.transactionId).toBeDefined();

      // 3. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞
      const playbackResult = await api.playback.start(trackId);
      expect(playbackResult.status).toBe(200);
      expect(playbackResult.data.playing).toBe(true);

      // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ—è–ª—Ç–∏
      const royaltyResult = await api.royalties.check(trackId);
      expect(royaltyResult.data.distributed).toBe(true);
      expect(royaltyResult.data.artistShare).toBeGreaterThan(0);
    });
  });
});
```

### 3. E2E —Ç–µ—Å—Ç—ã

#### –ü—Ä–æ–±–ª–µ–º–∞

E2E —Ç–µ—Å—Ç—ã –æ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.

#### –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ E2E —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

#### –ü—Ä–∏–º–µ—Ä –Ω–æ–≤—ã—Ö E2E —Ç–µ—Å—Ç–æ–≤:

```typescript
// tests/e2e/full-user-journey.test.ts
import { test, expect } from "@playwright/test";

test.describe("Full User Journey", () => {
  test("should complete artist registration and track upload flow", async ({
    page,
  }) => {
    // 1. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    await page.goto("/");
    await expect(
      page.getByText("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ NORMAL DANCE")
    ).toBeVisible();

    // 2. –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    await page.getByRole("button", { name: "–°—Ç–∞—Ç—å –∞—Ä—Ç–∏—Å—Ç–æ–º" }).click();
    await expect(page).toHaveURL(/.*\/auth\/signup/);

    // 3. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    await page.getByLabel("Email").fill("artist@test.com");
    await page.getByLabel("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è").fill("test-artist");
    await page.getByLabel("–ü–∞—Ä–æ–ª—å").fill("SecurePass123!");
    await page.getByLabel("–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å").fill("SecurePass123!");
    await page.getByRole("button", { name: "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è" }).click();

    // 4. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email (–º–æ–∫)
    await page.waitForURL(/.*\/verify-email/);
    await page.getByRole("button", { name: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å email" }).click();

    // 5. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
    await page.waitForURL(/.*\/profile\/setup/);
    await page.getByLabel("–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è").fill("Test Artist");
    await page.getByLabel("–û —Å–µ–±–µ").fill("Electronic music producer");
    await page.getByRole("button", { name: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" }).click();

    // 6. –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∑–∞–≥—Ä—É–∑–∫–µ —Ç—Ä–µ–∫–∞
    await page.waitForURL(/.*\/dashboard/);
    await page.getByRole("link", { name: "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç—Ä–µ–∫" }).click();

    // 7. –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–∞
    await page.waitForURL(/.*\/upload/);
    await page.getByLabel("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞").fill("My First Track");
    await page.getByLabel("–ñ–∞–Ω—Ä").selectOption("Electronic");
    await page.getByLabel("–¶–µ–Ω–∞ (NDT)").fill("9.99");

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (–º–æ–∫)
    const audioFileChooser = page.waitForEvent("filechooser");
    await page.getByRole("button", { name: "–í—ã–±—Ä–∞—Ç—å –∞—É–¥–∏–æ" }).click();
    const audioFile = await audioFileChooser;
    await audioFile.setFiles("tests/fixtures/test-track.mp3");

    const imageFileChooser = page.waitForEvent("filechooser");
    await page.getByRole("button", { name: "–í—ã–±—Ä–∞—Ç—å –æ–±–ª–æ–∂–∫—É" }).click();
    const imageFile = await imageFileChooser;
    await imageFile.setFiles("tests/fixtures/test-cover.jpg");

    await page.getByRole("button", { name: "–ó–∞–≥—Ä—É–∑–∏—Ç—å" }).click();

    // 8. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
    await page.waitForURL(/.*\/tracks\/.*/);
    await expect(page.getByText("–¢—Ä–µ–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω")).toBeVisible();
  });

  test("should complete user purchase and playback flow", async ({ page }) => {
    // 1. –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
    await page.goto("/auth/login");
    await page.getByLabel("Email").fill("user@test.com");
    await page.getByLabel("–ü–∞—Ä–æ–ª—å").fill("UserPass123!");
    await page.getByRole("button", { name: "–í–æ–π—Ç–∏" }).click();

    // 2. –ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–∞
    await page.waitForURL("/");
    await page
      .getByPlaceholder("–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤, –∞—Ä—Ç–∏—Å—Ç–æ–≤, –∞–ª—å–±–æ–º–æ–≤...")
      .fill("My First Track");
    await page.keyboard.press("Enter");

    // 3. –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ç—Ä–µ–∫—É
    await page.getByText("My First Track").first().click();

    // 4. –ü–æ–∫—É–ø–∫–∞ —Ç—Ä–µ–∫–∞
    await page.getByRole("button", { name: "–ö—É–ø–∏—Ç—å –∑–∞ 9.99 NDT" }).click();
    await page.getByRole("button", { name: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–∫—É–ø–∫—É" }).click();

    // 5. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ (–º–æ–∫)
    await page.getByRole("button", { name: "–ü–æ–¥–∫–ª—é—á–∏—Ç—å Phantom" }).click();
    await page.getByRole("button", { name: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é" }).click();

    // 6. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞
    await page.getByRole("button", { name: "‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏" }).click();
    await expect(page.getByText("–°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç")).toBeVisible();
  });
});
```

### 4. –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### –ü—Ä–æ–±–ª–µ–º–∞

–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã.

#### –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Artillery –∏–ª–∏ k6.

#### –ü—Ä–∏–º–µ—Ä –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:

```javascript
// tests/performance/api-load-test.yml
config:
  target: "http://localhost:3000"
  phases:
    - duration: 60
      arrivalRate: 20
      name: "Ramp up load"
    - duration: 120
      arrivalRate: 50
      name: "Sustained load"
  defaults:
    headers:
      content-type: "application/json"

scenarios:
  - name: "User Authentication Flow"
    flow:
      - post:
          url: "/api/auth/login"
          json:
            email: "test@example.com"
            password: "password123"
          capture:
            json: "$.token"
            as: "authToken"
      - get:
          url: "/api/users/me"
          headers:
            Authorization: "Bearer {{ authToken }}"

  - name: "Track Search and Playback"
    flow:
      - get:
          url: "/api/tracks?limit=20&page=1"
      - get:
          url: "/api/tracks/12345"
      - post:
          url: "/api/tracks/12345/play"
          headers:
            Authorization: "Bearer {{ authToken }}"

  - name: "Playlist Operations"
    flow:
      - post:
          url: "/api/playlists"
          headers:
            Authorization: "Bearer {{ authToken }}"
          json:
            name: "Test Playlist"
            isPublic: true
      - put:
          url: "/api/playlists/67890/tracks"
          headers:
            Authorization: "Bearer {{ authToken }}"
          json:
            trackIds: ["12345", "67890", "11111"]
```

### 5. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### –ü—Ä–æ–±–ª–µ–º–∞

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

#### –†–µ—à–µ–Ω–∏–µ

–†–∞—Å—à–∏—Ä–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π.

#### –ü—Ä–∏–º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:

```typescript
// tests/security/auth-security.test.ts
import { describe, it, expect } from "@jest/globals";

describe("Authentication Security Tests", () => {
  describe("Rate Limiting", () => {
    it("should block excessive login attempts", async () => {
      const credentials = {
        email: "test@example.com",
        password: "wrongpassword",
      };

      // –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ 10 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥
      for (let i = 0; i < 10; i++) {
        await api.auth.login(credentials);
      }

      // 11-—è –ø–æ–ø—ã—Ç–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
      const result = await api.auth.login(credentials);
      expect(result.status).toBe(429); // Too Many Requests
      expect(result.error).toContain("rate limit");
    });
  });

  describe("Input Validation", () => {
    it("should reject malicious input", async () => {
      const maliciousInputs = [
        { email: "test@<script>alert(1)</script>.com", password: "password" },
        { email: "test@example.com", password: "a".repeat(1000) },
        { email: "", password: "" },
      ];

      for (const input of maliciousInputs) {
        const result = await api.auth.login(input);
        expect(result.status).toBe(400); // Bad Request
      }
    });
  });

  describe("JWT Security", () => {
    it("should reject expired tokens", async () => {
      const expiredToken =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyLCJleHAiOjE1MTYyMzkwMjJ9.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c";

      const result = await api.users.getProfile("123", expiredToken);
      expect(result.status).toBe(401); // Unauthorized
    });

    it("should reject tampered tokens", async () => {
      const tamperedToken =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c";

      const result = await api.users.getProfile("123", tamperedToken);
      expect(result.status).toBe(401); // Unauthorized
    });
  });
});
```

## üìÖ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ù–µ–¥–µ–ª—è 1

- [ ] –£–ª—É—á—à–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (10 –º–æ–¥—É–ª–µ–π)
- [ ] –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –ù–µ–¥–µ–ª—è 2

- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (5 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)
- [ ] –°–æ–∑–¥–∞—Ç—å E2E —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ (3 –ø–æ—Ç–æ–∫–∞)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç—á–µ—Ç—ã –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ —Ç–µ—Å—Ç–∞–º–∏

### –ù–µ–¥–µ–ª—è 3

- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è API endpoints
- [ ] –°–æ–∑–¥–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –≤ CI/CD pipeline

### –ù–µ–¥–µ–ª—è 4

- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞—É–¥–∏—Ç–∞
- [ ] –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏ —Å 40% –¥–æ 85%
- –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∞–≥–æ–≤ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–∞ 60%
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É PR –Ω–∞ 40%
- –ü–æ–≤—ã—à–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –≤ –æ–ø—Ä–æ—Å–∞—Ö –∫–æ–º–∞–Ω–¥—ã —Å 6 –¥–æ 9 –±–∞–ª–ª–æ–≤

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- Jest –¥–ª—è —é–Ω–∏—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- Playwright –¥–ª—è E2E —Ç–µ—Å—Ç–æ–≤
- Artillery/k6 –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- OWASP ZAP –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- Istanbul/nyc –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞
