# üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–µ—Ä–≤–∞–±–µ–ª—å–Ω–æ—Å—Ç—å

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

NORMAL DANCE –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   Prometheus    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   Grafana       ‚îÇ
‚îÇ   (–ú–µ—Ç—Ä–∏–∫–∏)     ‚îÇ    ‚îÇ   (–°–±–æ—Ä)        ‚îÇ    ‚îÇ   (–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Fluent Bit    ‚îÇ    ‚îÇ   Jaeger        ‚îÇ    ‚îÇ   AlertManager  ‚îÇ
‚îÇ   (–õ–æ–≥–∏)        ‚îÇ    ‚îÇ   (–¢—Ä–µ–π—Å–∏–Ω–≥)    ‚îÇ    ‚îÇ   (–ê–ª–µ—Ä—Ç–∏–Ω–≥)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

```typescript
// src/lib/metrics/system.ts
import client from 'prom-client';

export const cpuUsage = new client.Gauge({
  name: 'nodejs_cpu_usage_percentage',
  help: 'Current CPU usage percentage'
});

export const memoryUsage = new client.Gauge({
  name: 'nodejs_memory_usage_bytes',
  help: 'Memory usage in bytes'
});

export const activeConnections = new client.Gauge({
  name: 'nodejs_active_connections',
  help: 'Number of active connections'
});

export const eventLoopLag = new client.Histogram({
  name: 'nodejs_eventloop_lag_seconds',
  help: 'Lag of event loop in seconds',
  buckets: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1]
});
```

### –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏

```typescript
// src/lib/metrics/business.ts
export const tracksUploaded = new client.Counter({
  name: 'tracks_uploaded_total',
  help: 'Total number of tracks uploaded',
  labelNames: ['genre', 'user_type']
});

export const streamsStarted = new client.Counter({
  name: 'streams_started_total',
  help: 'Total number of streams started',
  labelNames: ['track_id', 'user_id', 'device_type']
});

export const nftMinted = new client.Counter({
  name: 'nft_minted_total',
  help: 'Total number of NFTs minted',
  labelNames: ['track_id', 'collection_id']
});
```

### Health Check –º–µ—Ç—Ä–∏–∫–∏

```typescript
// src/lib/metrics/health.ts
export const healthCheckDuration = new client.Histogram({
  name: 'health_check_duration_seconds',
  help: 'Duration of health checks',
  labelNames: ['check_type']
});

export const serviceStatus = new client.Gauge({
  name: 'service_status',
  help: 'Service health status (1 = healthy, 0 = unhealthy)',
  labelNames: ['service_name']
});
```

## üìä –î–∞—à–±–æ—Ä–¥—ã Grafana

### –û—Å–Ω–æ–≤–Ω–æ–π –¥–∞—à–±–æ—Ä–¥

**–ü–∞–Ω–µ–ª–∏:**
- CPU –∏ –ø–∞–º—è—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- RPS (requests per second)
- Error rate
- Response time —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

### –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ –¥–∞—à–±–æ—Ä–¥

**–ü–∞–Ω–µ–ª–∏:**
- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏ –ø–æ –∂–∞–Ω—Ä–∞–º
- –°—Ç—Ä–∏–º—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏
- –î–æ—Ö–æ–¥ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –¥–∞—à–±–æ—Ä–¥

**–ü–∞–Ω–µ–ª–∏:**
- Kubernetes pod —Å—Ç–∞—Ç—É—Å—ã
- Resource utilization –ø–æ –Ω–µ–π–º—Å–ø–µ–π—Å–∞–º
- Network I/O
- Disk usage
- Node exporter –º–µ—Ç—Ä–∏–∫–∏

## üö® –ê–ª–µ—Ä—Ç–∏–Ω–≥

### –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞

```yaml
# alertmanager/alert-rules.yml
groups:
  - name: application
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status_code=~"5.."}[5m]) > 0.05
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value }}% over the last 5 minutes"

      - alert: HighResponseTime
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 2
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "High response time"
          description: "95th percentile response time is {{ $value }}s"

      - alert: ServiceDown
        expr: up{job="normaldance"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Service is down"
          description: "Service has been down for more than 1 minute"
```

### –ö–∞–Ω–∞–ª—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### Slack —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```yaml
# alertmanager/config.yml
route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'slack'

receivers:
  - name: 'slack'
    slack_configs:
      - api_url: '${SLACK_WEBHOOK_URL}'
        channel: '#alerts'
        title: 'Alert: {{ .GroupLabels.alertname }}'
        text: '{{ range .Alerts }}{{ .Annotations.summary }} - {{ .Annotations.description }}\n{{ end }}'
```

#### Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```yaml
- name: 'email'
  email_configs:
    - to: 'oncall@normaldance.com'
      from: 'alertmanager@normaldance.com'
      smarthost: 'smtp.gmail.com:587'
      auth_username: '${SMTP_USERNAME}'
      auth_password: '${SMTP_PASSWORD}'
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```typescript
// src/lib/logger.ts
import winston from 'winston';

const logger = winston.createLogger({
  level: process.env.NODE_ENV === 'production' ? 'info' : 'debug',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json(),
    winston.format.printf(({ timestamp, level, message, ...meta }) => {
      return JSON.stringify({
        timestamp,
        level,
        message,
        service: 'normaldance',
        ...meta
      });
    })
  ),
  transports: [
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      )
    }),
    new winston.transports.File({ filename: 'logs/combined.log' }),
    new winston.transports.File({ filename: 'logs/errors.log', level: 'error' })
  ]
});

export default logger;
```

### Fluent Bit –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```yaml
# fluent-bit/fluent-bit.conf
[SERVICE]
    Flush        5
    Log_Level    info

[INPUT]
    Name         tail
    Path         /var/log/containers/*normaldance*.log
    Parser       docker
    Tag          normaldance.*
    Refresh_Interval 5

[FILTER]
    Name         kubernetes
    Match        normaldance.*
    Kube_URL     https://kubernetes.default.svc:443
    Kube_CA_File /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    Kube_Token_File /var/run/secrets/kubernetes.io/serviceaccount/token

[OUTPUT]
    Name         elasticsearch
    Match        *
    Host         elasticsearch
    Port         9200
    Logstash_Format On
```

## üîç –¢—Ä–µ–π—Å–∏–Ω–≥

### OpenTelemetry –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```typescript
// src/lib/tracing.ts
import { NodeSDK } from '@opentelemetry/sdk-node';
import { getNodeAutoInstrumentations } from '@opentelemetry/auto-instrumentations-node';
import { OTLPTraceExporter } from '@opentelemetry/exporter-otlp-grpc';

const sdk = new NodeSDK({
  traceExporter: new OTLPTraceExporter({
    url: 'http://jaeger:4317',
  }),
  instrumentations: [getNodeAutoInstrumentations()],
});

sdk.start();
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ç—Ä–µ–π—Å—ã

```typescript
import { trace } from '@opentelemetry/api';

export const withTracing = async <T>(
  spanName: string,
  fn: () => Promise<T>
): Promise<T> => {
  const tracer = trace.getTracer('normaldance');
  const span = tracer.startSpan(spanName);

  try {
    const result = await fn();
    span.setStatus({ code: 0 }); // OK
    return result;
  } catch (error) {
    span.setStatus({ code: 1, message: error.message }); // ERROR
    throw error;
  } finally {
    span.end();
  }
};
```

## üè• Health Checks

### Kubernetes Health Checks

```yaml
# deployment.yaml
livenessProbe:
  httpGet:
    path: /api/health
    port: 3000
    scheme: HTTP
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /api/ready
    port: 3000
    scheme: HTTP
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

startupProbe:
  httpGet:
    path: /api/startup
    port: 3000
    scheme: HTTP
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30
```

### Health Check —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

```typescript
// src/app/api/health/route.ts
export async function GET() {
  const health = {
    status: 'ok',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    services: {
      database: await checkDatabase(),
      redis: await checkRedis(),
      ipfs: await checkIPFS(),
      solana: await checkSolana()
    }
  };

  const isHealthy = Object.values(health.services).every(s => s.status === 'ok');

  return Response.json(health, {
    status: isHealthy ? 200 : 503
  });
}

// src/app/api/ready/route.ts
export async function GET() {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
  const ready = await checkApplicationReadiness();

  return Response.json({ status: ready ? 'ready' : 'not_ready' }, {
    status: ready ? 200 : 503
  });
}
```

## üìä –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –±–ª–æ–∫—á–µ–π–Ω –æ–ø–µ—Ä–∞—Ü–∏–π

```typescript
// src/lib/metrics/blockchain.ts
export const blockchainOperations = new client.Counter({
  name: 'blockchain_operations_total',
  help: 'Total blockchain operations',
  labelNames: ['operation', 'network', 'status']
});

export const gasUsed = new client.Histogram({
  name: 'blockchain_gas_used',
  help: 'Gas used in blockchain operations',
  labelNames: ['operation'],
  buckets: [1000, 5000, 10000, 50000, 100000]
});
```

### –ú–µ—Ç—Ä–∏–∫–∏ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞

```typescript
// src/lib/metrics/streaming.ts
export const streamDuration = new client.Histogram({
  name: 'stream_duration_seconds',
  help: 'Duration of music streams',
  labelNames: ['track_id', 'user_id'],
  buckets: [10, 30, 60, 300, 600, 1800, 3600]
});

export const bufferEvents = new client.Counter({
  name: 'stream_buffer_events_total',
  help: 'Total buffer events during streaming',
  labelNames: ['track_id', 'reason']
});
```

## üîß –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### Kubernetes –º–µ—Ç—Ä–∏–∫–∏

```yaml
# prometheus/prometheus.yml
scrape_configs:
  - job_name: 'kubernetes-pods'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_namespace]
        target_label: namespace
      - source_labels: [__meta_kubernetes_pod_name]
        target_label: pod

  - job_name: 'normaldance-app'
    static_configs:
      - targets: ['normaldance:3000']
    metrics_path: '/metrics'
    scrape_interval: 15s
```

### Node Exporter

```yaml
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É–∑–ª–æ–≤ Kubernetes
- job_name: 'node-exporter'
  static_configs:
    - targets: ['node-exporter:9100']
  scrape_interval: 30s
```

## üìã –î–∞—à–±–æ—Ä–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞

```json
{
  "dashboard": {
    "title": "NORMAL DANCE - Application Overview",
    "panels": [
      {
        "title": "Requests per Second",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])",
            "legendFormat": "{{method}} {{status_code}}"
          }
        ]
      },
      {
        "title": "Response Time",
        "type": "heatmap",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))"
          }
        ]
      }
    ]
  }
}
```

## üö® –ò–Ω—Ü–∏–¥–µ–Ω—Ç–Ω—ã–π –æ—Ç–∫–ª–∏–∫

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∞–ª–µ—Ä—Ç–∏–Ω–≥
2. **–û—Ü–µ–Ω–∫–∞**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
3. **–†–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
4. **–ê–Ω–∞–ª–∏–∑**: –ü–æ—Å—Ç-–º–æ—Ä—Ç–µ–º –∞–Ω–∞–ª–∏–∑
5. **–£–ª—É—á—à–µ–Ω–∏–µ**: –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã

### Runbook'–∏

#### –í—ã—Å–æ–∫–∏–π error rate

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
kubectl logs -f deployment/normaldance -n production

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã
kubectl top pods -n production

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
curl -f https://api.solana.com/ || echo "Solana API down"

# 4. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
kubectl scale deployment normaldance --replicas=5 -n production
```

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
kubectl exec -it deployment/postgres -n production -- pg_isready

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ PostgreSQL
kubectl logs deployment/postgres -n production

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
kubectl rollout restart deployment/postgres -n production
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### APM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```typescript
// src/lib/apm.ts
import elasticApm from 'elastic-apm-node';

elasticApm.start({
  serviceName: 'normaldance',
  serverUrl: process.env.APM_SERVER_URL,
  environment: process.env.NODE_ENV
});

export default elasticApm;
```

### Database Query –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```typescript
// src/lib/db-monitoring.ts
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient({
  log: [
    { emit: 'event', level: 'query' },
    { emit: 'event', level: 'error' },
    { emit: 'event', level: 'warn' }
  ]
});

prisma.$on('query', (e) => {
  queryDurationHistogram.observe(e.duration);
  if (e.duration > 1000) {
    logger.warn('Slow query detected', { query: e.query, duration: e.duration });
  }
});
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è Grafana

```yaml
# grafana/values.yaml
adminUser: admin
adminPassword: "${GRAFANA_ADMIN_PASSWORD}"

ingress:
  enabled: true
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - monitoring.normaldance.com
  tls:
    - secretName: grafana-tls
      hosts:
        - monitoring.normaldance.com
```

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```yaml
# fluent-bit –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
[OUTPUT]
    Name         secure_forward
    Host         log-aggregator
    Port         24284
    Shared_Key   "${FLUENT_BIT_SHARED_KEY}"
    Self_Hostname normaldance-prod
```

---

*–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º –≤ –ø–∞–ø–∫–µ `monitoring/` –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.*
