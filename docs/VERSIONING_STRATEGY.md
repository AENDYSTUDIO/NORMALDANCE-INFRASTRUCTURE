# Стратегия Версионирования и Управления Ветками для NORMALDANCE

## Обзор

Этот документ описывает стратегию версионирования и управления ветками для проекта NORMALDANCE. В проекте используется семантическое версионирование (SemVer) 2.0.0 в сочетании с моделью ветвления GitFlow для обеспечения стабильности, прозрачности и эффективного управления разработкой.

## Семантическое Версионирование (SemVer) 2.0.0

### Формат версии

Версии принимают формат `MAJOR.MINOR.PATCH`:

- `MAJOR` - изменяется при внесении несовместимых изменений API
- `MINOR` - изменяется при добавлении новой функциональности, не нарушающей совместимость
- `PATCH` - изменяется при исправлении ошибок, не нарушающих совместимость

Примеры:

- `1.9.0` - стабильная версия
- `2.4.5` - стабильная версия

### Предрелизные теги

Предрелизная версия может быть обозначена добавлением дефиса и идентификатора предрелиза после номера версии:

Примеры:

- `1.0.0-alpha`
- `1.0.0-alpha.1`
- `1.0.0-0.3.7`
- `1.0.0-x.7.z.92`

### Метаданные сборки

Метаданные сборки могут быть добавлены после номера версии с использованием знака плюс:

Примеры:

- `1.0.0+20130313144700`
- `1.0.0+exp.sha.5114f85`
- `1.0.0-alpha+exp.sha.514f85`

## Стратегия Ветвления GitFlow

### Основные ветки

#### `main`

- Основная ветка для стабильного кода
- Содержит последнюю стабильную версию приложения
- Ветка защищена от прямых коммитов
- Каждый мердж в `main` создает новый релиз
- Для каждого релиза создается Git тег

#### `develop`

- Ветка для интеграции функций
- Содержит последнюю разработку
- Все feature ветки мерджатся в `develop`
- Периодически мерджится в `main` для релизов

### Вспомогательные ветки

#### `feature/*`

- Ветки для разработки новых функций
- Создаются из `develop`
- Мерджатся обратно в `develop`
- Именование: `feature/название-функции`, `feature/user-authentication`

#### `release/*`

- Ветки для подготовки релизов
- Создаются из `develop` при подготовке к релизу
- Используются для исправления багов и финальной подготовки
- Мерджатся в `main` (с созданием тега) и в `develop`
- Именование: `release/v1.2.0`, `release/2025.1.0`

#### `hotfix/*`

- Ветки для срочных исправлений в продакшене
- Создаются из `main`
- Мерджатся в `main` и `develop`
- Именование: `hotfix/v1.1`, `hotfix/critical-security-fix`

#### `support/*`

- Ветки для поддержки старых версий
- Создаются из тегов старых версий
- Используются для багфиксов в старых версиях
- Именование: `support/v1.x`, `support/legacy-fixes`

## Процесс разработки

### Создание новой функции

```
git checkout develop
git checkout -b feature/new-feature-name
# Работа над функцией
git add .
git commit -m "feat: add new feature description"
git push origin feature/new-feature-name
# Создание Pull Request в develop
```

### Подготовка релиза

```
git checkout develop
git pull origin develop
git checkout -b release/v1.2.0
# Обновление версии в package.json
npm run version:release
# Исправление багов, если необходимо
git add .
git commit -m "chore(release): prepare v1.2.0"
git push origin release/v1.2.0
# Создание Pull Request в main и develop
```

### Релиз на продакшен

```
git checkout main
git merge --no-ff release/v1.2.0
git tag -a v1.2.0 -m "Release version 1.2.0"
git push origin main --tags
git checkout develop
git merge --no-ff release/v1.2.0
git push origin develop
```

### Исправление критической ошибки

```
git checkout main
git checkout -b hotfix/critical-fix-v1.1.1
# Исправление ошибки
npm run version:patch
git add .
git commit -m "fix: critical issue fix"
git push origin hotfix/critical-fix-v1.1.1
# Создание Pull Request в main и develop
```

## Типы коммитов и соответствующие изменения версии

| Тип коммита                     | Тип изменения                | Увеличение версии |
| ------------------------------- | ---------------------------- | ----------------- |
| `feat!:` или `BREAKING CHANGE:` | Несовместимые изменения      | MAJOR             |
| `feat:`                         | Новая функциональность       | MINOR             |
| `fix:`                          | Исправление ошибок           | PATCH             |
| `docs:`                         | Обновление документации      | PATCH             |
| `style:`                        | Изменения форматирования     | PATCH             |
| `refactor:`                     | Рефакторинг кода             | PATCH             |
| `perf:`                         | Улучшения производительности | PATCH             |
| `test:`                         | Изменения в тестах           | PATCH             |
| `chore:`                        | Рутинные задачи              | PATCH             |

## Скрипты управления версией

В проекте доступны следующие скрипты для управления версиями:

### Основные команды

```bash
npm run version:current          # Показать текущую версию
npm run version:report           # Генерация отчета о версии
npm run version:tags             # Список всех тегов версий
npm run version:changelog        # Генерация changelog
```

### Изменение версии

```bash
npm run version:patch            # Увеличить PATCH версию (1.0.0 -> 1.0.1)
npm run version:minor            # Увеличить MINOR версию (1.0.1 -> 1.1.0)
npm run version:major            # Увеличить MAJOR версию (1.1.0 -> 2.0.0)
```

### Предрелизные версии

```bash
npm run version:alpha            # Создать alpha версию (1.0.0 -> 1.0.1-alpha.0)
npm run version:beta             # Создать beta версию (1.0.0 -> 1.0.1-beta.0)
npm run version:rc               # Создать release candidate (1.0.0 -> 1.0.1-rc.0)
npm run version:prerelease       # Создать предрелизную версию (alpha по умолчанию)
```

### Сборка

```bash
npm run version:build            # Добавить метаданные сборки (1.0.0 -> 1.0.0+build.info)
```

### Создание релиза

```bash
npm run version:release          # Создать релиз (обновить версию, создать тег, обновить changelog)
```

## CI/CD Интеграция

### GitLab CI/CD

- Автоматическая проверка типов коммитов
- Автоматическая сборка и тестирование
- Автоматическое развертывание на Render
- Уведомления о статусе деплоя

### Условия запуска пайплайнов

- `main`: автоматический деплой на продакшен
- `develop`: автоматический деплой на staging
- `feature/*`: автоматические тесты
- `release/*`: предрелизное тестирование
- `hotfix/*`: срочный деплой на продакшен

## Обработка предрелизных версий

### Alpha-версии

- Используются для ранних внутренних тестов
- Формат: `x.y.z-alpha.n`
- Деплой на специальные тестовые окружения

### Beta-версии

- Используются для предварительного тестирования
- Формат: `x.y.z-beta.n`
- Деплой на окружения для бета-тестирования

### Release Candidate (RC)

- Используются для финального тестирования перед релизом
- Формат: `x.y.z-rc.n`
- Деплой на предпродакшен окружения

## Метаданные сборки

Метаданные сборки включают:

- Информацию о билде
- Хеш коммита Git
- Дату сборки
- Информацию о CI/CD окружении
- Информацию о среде развертывания

## Автоматическая генерация CHANGELOG

При каждом изменении версии автоматически генерируется или обновляется файл CHANGELOG.md с учетом:

- Типов коммитов
- Описаний изменений
- Авторов изменений
- Хешей коммитов

## Защита веток

### Ветка `main`

- Защита от прямых коммитов
- Требуется Pull Request с код-ревью
- Требуется прохождение CI тестов
- Требуется проверка статуса отдельных задач

### Ветка `develop`

- Защита от прямых коммитов
- Требуется Pull Request
- Требуется прохождение базовых CI тестов

## Работа с тегами

Каждый релиз в `main` сопровождается созданием Git тега в формате `vMAJOR.MINOR.PATCH`:

- `v1.0.0` - первый стабильный релиз
- `v1.2.3` - стабильный релиз
- `v2.0.0-rc.1` - релиз-кандидат

## Миграция с предыдущей системы

При переходе на новую систему:

1. Создать тег для текущего состояния как `v0.2.0` (текущая версия из package.json)
2. Обновить все скрипты для соответствия новой стратегии
3. Обновить документацию
4. Обучить команду новым процессам

## Роли и ответственность

### Lead Developer

- Утверждение релизов
- Управление защищенными ветками
- Обновление стратегии версионирования

### Developers

- Следование правилам именования веток
- Правильное форматирование коммитов
- Создание Pull Requests с описанием изменений

### DevOps Engineer

- Настройка и поддержка CI/CD пайплайнов
- Обновление скриптов автоматизации
- Мониторинг процесса релизов

## Примеры использования

### Нормальный релиз

```
1.0 -> 1.0.1 (исправление ошибки)
1.0.1 -> 1.1.0 (новая функция)
1.1.0 -> 2.0.0 (несовместимые изменения)
```

### Предрелизные версии

```
1.0.0 -> 1.1.0-alpha.0 -> 1.1.0-alpha.1 -> 1.1.0-beta.0 -> 1.1.0-rc.0 -> 1.1.0
```

### Метаданные сборки

```
1.0.0+build.123
1.0.0-alpha.1+20250101.abc123
```

## Откат версий

В случае необходимости отката:

1. Использовать предыдущий тег как точку отката
2. Создать новую ветку из тега
3. Применить необходимые исправления
4. Создать новый релиз с исправлениями

## Обучение команды

Все участники проекта должны быть ознакомлены с:

- Системой версионирования
- Правилами оформления коммитов
- Процессами создания веток
- Процедурами релизов
