# üõ°Ô∏è –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è NORMAL DANCE

## üéØ –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏, –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è NORMAL DANCE.

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Ñ—É–Ω–∫—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ try/catch –±–ª–æ–∫–æ–≤, –Ω–æ –±–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ API, –Ω–æ –Ω–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –ü—Ä–æ—Å—Ç–æ–π –ª–æ–≥–≥–µ—Ä —Å –±–∞–∑–æ–≤—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ (error, warn, info, debug)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (Sentry, DataDog –∏ —Ç.–¥.)

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –ù–∞–ª–∏—á–∏–µ –±–∞–∑–æ–≤—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤ –≤ Prometheus
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ Application Performance Monitoring (APM)

## üìà –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏—è

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### –ü—Ä–æ–±–ª–µ–º–∞

–û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –≤ –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –µ–¥–∏–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞.

#### –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –∫–ª–∞—Å—Å–∞–º–∏ –æ—à–∏–±–æ–∫.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```typescript
// src/errors/BaseError.ts
export class BaseError extends Error {
  public readonly name: string;
  public readonly statusCode: number;
  public readonly isOperational: boolean;
  public readonly metadata?: Record<string, any>;

  constructor(
    name: string,
    statusCode: number,
    message: string,
    isOperational: boolean = true,
    metadata?: Record<string, any>
  ) {
    super(message);
    this.name = name;
    this.statusCode = statusCode;
    this.isOperational = isOperational;
    this.metadata = metadata;

    // Maintains proper stack trace for where our error was thrown
    Error.captureStackTrace(this, this.constructor);
  }
}

// src/errors/ValidationError.ts
export class ValidationError extends BaseError {
  constructor(message: string, metadata?: Record<string, any>) {
    super("ValidationError", 400, message, true, metadata);
  }
}

// src/errors/AuthenticationError.ts
export class AuthenticationError extends BaseError {
  constructor(message: string = "Authentication failed") {
    super("AuthenticationError", 401, message, true);
  }
}

// src/errors/AuthorizationError.ts
export class AuthorizationError extends BaseError {
  constructor(message: string = "Access denied") {
    super("AuthorizationError", 403, message, true);
  }
}

// src/errors/NotFoundError.ts
export class NotFoundError extends BaseError {
  constructor(message: string = "Resource not found") {
    super("NotFoundError", 404, message, true);
  }
}

// src/errors/BusinessLogicError.ts
export class BusinessLogicError extends BaseError {
  constructor(message: string, metadata?: Record<string, any>) {
    super("BusinessLogicError", 422, message, true, metadata);
  }
}

// src/errors/ExternalServiceError.ts
export class ExternalServiceError extends BaseError {
  constructor(message: string, metadata?: Record<string, any>) {
    super("ExternalServiceError", 502, message, false, metadata);
  }
}

// src/errors/InternalServerError.ts
export class InternalServerError extends BaseError {
  constructor(message: string = "Internal server error") {
    super("InternalServerError", 500, message, false);
  }
}
```

#### –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `ipfs-helia-adapter.ts`:

```typescript
// src/lib/ipfs-helia-adapter.ts (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
import { type Helia } from "@helia/interface";
import { unixfs } from "@helia/unixfs";
import { createHelia } from "helia";
import { type IPFSTrackMetadata } from "./ipfs";
import { createLogger } from "../utils/logger";
import {
  ValidationError,
  ExternalServiceError,
  InternalServerError,
} from "../errors";

const logger = createLogger("ipfs-helia");

// Singleton instance for Helia
let heliaInstance: Helia | null = null;
let unixfsInstance: ReturnType<typeof unixfs> | null = null;

/**
 * Get or create Helia instance with UnixFS
 */
async function getHelia(): Promise<{
  helia: Helia;
  fs: ReturnType<typeof unixfs>;
}> {
  if (!heliaInstance || !unixfsInstance) {
    try {
      logger.info("Initializing Helia IPFS instance...", {
        maxConnections: 50,
        minConnections: 10,
      });

      heliaInstance = await createHelia({
        start: true,
        libp2p: {
          connectionManager: {
            maxConnections: 50,
            minConnections: 10,
          },
        },
      });

      unixfsInstance = unixfs(heliaInstance);
      logger.info("Helia IPFS instance initialized successfully");
    } catch (error) {
      logger.error("Failed to initialize Helia", { error });

      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ—à–∏–±–∫—É –≤ –Ω–∞—à —Ñ–æ—Ä–º–∞—Ç
      if (error instanceof Error) {
        throw new ExternalServiceError(
          `Helia initialization failed: ${error.message}`,
          { originalError: error.message, stack: error.stack }
        );
      }

      throw new InternalServerError("Unknown Helia initialization error");
    }
  }

  return { helia: heliaInstance, fs: unixfsInstance };
}

/**
 * Upload file to IPFS using Helia with enhanced security
 */
export async function uploadToIPFSHelia(
  file: File | Buffer,
  metadata?: IPFSTrackMetadata
): Promise<{ cid: string; size: number }> {
  try {
    // Validate input parameters
    if (!file) {
      logger.warn("File is required for IPFS upload");
      throw new ValidationError("File is required for upload");
    }

    // File size validation (max 100MB)
    const maxSize = 100 * 1024 * 1024; // 100MB
    const fileSize = file instanceof File ? file.size : (file as Buffer).length;

    if (fileSize > maxSize) {
      logger.warn("File size exceeds limit", {
        fileSize,
        maxSize,
        fileName: file instanceof File ? file.name : "buffer",
      });

      throw new ValidationError(
        `File size ${fileSize} exceeds maximum allowed size of ${maxSize} bytes`,
        { fileSize, maxSize }
      );
    }

    logger.info("Starting Helia IPFS upload", { fileSize });

    const { fs } = await getHelia();

    // Validate and convert file/buffer to Uint8Array
    let fileBytes: Uint8Array;

    if (file instanceof File) {
      // Additional validation for File objects
      if (!file.type || file.type === "") {
        logger.warn("File has no MIME type, proceeding with caution", {
          fileName: file.name,
        });
      }

      const arrayBuffer = await file.arrayBuffer();
      fileBytes = new Uint8Array(arrayBuffer);
    } else if (Buffer.isBuffer(file)) {
      fileBytes = new Uint8Array(file);
    } else {
      logger.error("Unsupported file type for IPFS upload", {
        fileType: typeof file,
      });

      throw new ValidationError(
        "Unsupported file type: expected File or Buffer",
        { fileType: typeof file }
      );
    }

    // Sanitize metadata if provided
    const sanitizedMetadata = metadata
      ? {
          title: metadata.title?.substring(0, 255) || "",
          artist: metadata.artist?.substring(0, 255) || "",
          genre: metadata.genre?.substring(0, 100) || "",
          duration:
            typeof metadata.duration === "number" && metadata.duration > 0
              ? metadata.duration
              : 0,
          format: metadata.format?.substring(0, 50) || "",
          sampleRate:
            typeof metadata.sampleRate === "number"
              ? metadata.sampleRate
              : 44100,
          bitDepth:
            typeof metadata.bitDepth === "number" ? metadata.bitDepth : 16,
        }
      : undefined;

    let resultCid: string;
    let resultSize: number;

    if (sanitizedMetadata) {
      // Create secure metadata object
      const metadataWithFile = {
        ...sanitizedMetadata,
        file: file instanceof File ? file.name.substring(0, 255) : "buffer",
        timestamp: new Date().toISOString(),
        version: "1.0",
      };

      // Add metadata to IPFS
      const metadataBytes = new TextEncoder().encode(
        JSON.stringify(metadataWithFile)
      );
      const metadataCid = await fs.addBytes(metadataBytes);

      // Add file to IPFS
      const fileCid = await fs.addBytes(fileBytes);

      // Create combined object with validation
      const combined = {
        metadata: metadataCid.toString(),
        file: fileCid.toString(),
        type: "track",
        checksum: await calculateChecksum(fileBytes),
        createdAt: new Date().toISOString(),
      };

      const combinedBytes = new TextEncoder().encode(JSON.stringify(combined));
      const combinedCid = await fs.addBytes(combinedBytes);

      resultCid = combinedCid.toString();
      resultSize = combinedBytes.length;
    } else {
      // Just add the file with basic metadata
      const cid = await fs.addBytes(fileBytes);
      resultCid = cid.toString();
      resultSize = fileBytes.length;
    }

    logger.info("Helia IPFS upload successful", {
      cid: resultCid,
      size: resultSize,
      hasMetadata: !!sanitizedMetadata,
    });

    return { cid: resultCid, size: resultSize };
  } catch (error) {
    // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
    logger.error("Helia IPFS upload failed", {
      error,
      hasMetadata: !!metadata,
      fileType:
        file instanceof File
          ? "File"
          : Buffer.isBuffer(file)
          ? "Buffer"
          : typeof file,
    });

    // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ –Ω–∞—à–∞ –æ—à–∏–±–∫–∞, –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
    if (error instanceof BaseError) {
      throw error;
    }

    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏
    if (error instanceof Error) {
      throw new ExternalServiceError(
        `Failed to upload to Helia IPFS: ${error.message}`,
        { originalError: error.message, stack: error.stack }
      );
    }

    throw new InternalServerError("Unknown error during IPFS upload");
  }
}
```

### 2. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ü—Ä–æ–±–ª–µ–º–∞

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–µ, –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏.

#### –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ª–æ–≥–≥–µ—Ä —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–æ–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```typescript
// src/utils/advanced-logger.ts
import winston from "winston";
import Sentry from "@sentry/nextjs";
import { format, transports } from "winston";
import { v4 as uuidv4 } from "uuid";

// –°–æ–∑–¥–∞–µ–º —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–æ–≥–≥–µ—Ä
interface LogMetadata {
  correlationId?: string;
  userId?: string;
  requestId?: string;
  service?: string;
  [key: string]: any;
}

class AdvancedLogger {
  private logger: winston.Logger;
  private service: string;

  constructor(service: string) {
    this.service = service;

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    const logLevel = process.env.LOG_LEVEL || "info";

    this.logger = winston.createLogger({
      level: logLevel,
      format: format.combine(
        format.timestamp(),
        format.errors({ stack: true }),
        format.metadata({
          fillExcept: ["message", "level", "timestamp", "label"],
        }),
        format((info) => {
          // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ä–≤–∏—Å –∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º
          info.metadata = {
            service: this.service,
            ...info.metadata,
          };
          return info;
        })(),
        process.env.NODE_ENV === "production"
          ? format.json()
          : format.prettyPrint()
      ),
      defaultMeta: { service: this.service },
      transports: [
        // –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
        new transports.Console({
          format: format.combine(
            format.colorize(),
            format.printf(({ level, message, timestamp, metadata }) => {
              const metaString = Object.keys(metadata).length
                ? ` | Metadata: ${JSON.stringify(metadata)}`
                : "";
              return `${timestamp} [${level}] ${this.service}: ${message}${metaString}`;
            })
          ),
        }),

        // –§–∞–π–ª–æ–≤—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–ª—è production
        ...(process.env.NODE_ENV === "production"
          ? [
              new transports.File({
                filename: "logs/error.log",
                level: "error",
                maxsize: 5242880, // 5MB
                maxFiles: 5,
              }),
              new transports.File({
                filename: "logs/combined.log",
                maxsize: 5242880, // 5MB
                maxFiles: 5,
              }),
            ]
          : []),
      ],
    });
  }

  // –ú–µ—Ç–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫ –ª–æ–≥–≥–µ—Ä—É
  withContext(context: LogMetadata): AdvancedLogger {
    const contextualLogger = new AdvancedLogger(this.service);
    contextualLogger.logger.defaultMeta = {
      ...contextualLogger.logger.defaultMeta,
      ...context,
    };
    return contextualLogger;
  }

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è correlation ID –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
  static generateCorrelationId(): string {
    return uuidv4();
  }

  error(message: string, metadata?: LogMetadata): void {
    this.logger.error(message, { ...metadata });
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Sentry
    if (process.env.NODE_ENV === "production") {
      Sentry.captureException(new Error(message), {
        contexts: { metadata },
      });
    }
  }

  warn(message: string, metadata?: LogMetadata): void {
    this.logger.warn(message, { ...metadata });
  }

  info(message: string, metadata?: LogMetadata): void {
    this.logger.info(message, { ...metadata });
  }

  debug(message: string, metadata?: LogMetadata): void {
    this.logger.debug(message, { ...metadata });
  }

  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
  http(
    method: string,
    url: string,
    statusCode: number,
    metadata?: LogMetadata
  ): void {
    const level =
      statusCode >= 500 ? "error" : statusCode >= 400 ? "warn" : "info";

    this.logger.log(level, `${method} ${url} ${statusCode}`, {
      http: { method, url, statusCode },
      ...metadata,
    });
  }

  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  metric(name: string, value: number, metadata?: LogMetadata): void {
    this.logger.info(`Metric: ${name}`, {
      metric: { name, value },
      ...metadata,
    });
  }
}

// Middleware –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è correlation ID –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É
export function loggingMiddleware() {
  return (req: any, res: any, next: () => void) => {
    const correlationId = AdvancedLogger.generateCorrelationId();
    req.correlationId = correlationId;

    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫ –æ—Ç–≤–µ—Ç—É
    res.setHeader("X-Correlation-ID", correlationId);

    next();
  };
}

// –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞
export function createRequestLogger(req: any, service: string): AdvancedLogger {
  const context: LogMetadata = {
    correlationId: req.correlationId,
    requestId: req.id,
    userAgent: req.get("User-Agent"),
    ip: req.ip,
    method: req.method,
    url: req.url,
  };

  // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞
  if (req.user) {
    context.userId = req.user.id;
  }

  return new AdvancedLogger(service).withContext(context);
}

export function createLogger(service: string): AdvancedLogger {
  return new AdvancedLogger(service);
}

export default AdvancedLogger;
```

### 3. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ API

#### –ü—Ä–æ–±–ª–µ–º–∞

–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ API —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–∞.

#### –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å middleware –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```typescript
// src/middleware/error-handler.ts
import { NextRequest, NextResponse } from "next/server";
import { BaseError } from "@/errors/BaseError";
import { createLogger } from "@/utils/advanced-logger";

const logger = createLogger("error-handler");

// Error response interface
interface ErrorResponse {
  error: string;
  message: string;
  statusCode: number;
  timestamp: string;
  correlationId?: string;
  details?: Record<string, any>;
}

// Error handler middleware
export async function errorHandler(
  error: Error,
  req: NextRequest,
  correlationId?: string
): Promise<NextResponse> {
  // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
  logger.error("Unhandled error in API route", {
    error: error.message,
    stack: error.stack,
    url: req.url,
    method: req.method,
    correlationId,
  });

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏
  let statusCode = 500;
  let message = "Internal Server Error";
  let errorName = "InternalServerError";
  let details: Record<string, any> | undefined;

  if (error instanceof BaseError) {
    statusCode = error.statusCode;
    message = error.message;
    errorName = error.name;
    details = error.metadata;
  } else {
    // –î–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Sentry
    if (process.env.NODE_ENV === "production") {
      // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Sentry
      console.error("Unhandled error:", error);
    }
  }

  // –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
  const errorResponse: ErrorResponse = {
    error: errorName,
    message,
    statusCode,
    timestamp: new Date().toISOString(),
    correlationId,
    ...(details && { details }),
  };

  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Å—Ç–∞—Ç—É—Å–æ–º
  return NextResponse.json(errorResponse, { status: statusCode });
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π error handler –¥–ª—è API routes
export function withErrorHandling(handler: Function) {
  return async (req: NextRequest) => {
    const correlationId =
      req.headers.get("X-Correlation-ID") ||
      Math.random().toString(36).substring(2, 15) +
        Math.random().toString(36).substring(2, 15);

    try {
      return await handler(req);
    } catch (error: any) {
      return errorHandler(error, req, correlationId);
    }
  };
}
```

#### –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è Telegram webhook —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫:

```typescript
// src/app/api/telegram/webhook/route.ts (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
import { NextRequest, NextResponse } from "next/server";
import { telegramIntegration2025 } from "@/lib/telegram-integration-2025";
import { withErrorHandling } from "@/middleware/error-handler";
import { createLogger } from "@/utils/advanced-logger";
import { BusinessLogicError, ValidationError } from "@/errors";

const logger = createLogger("telegram-webhook");

// POST /api/telegram/webhook - Telegram webhook handler
export const POST = withErrorHandling(async (req: NextRequest) => {
  const correlationId = req.headers.get("X-Correlation-ID") || "unknown";

  try {
    const body = await req.json();

    logger.info("Processing Telegram webhook", {
      updateType: Object.keys(body)[0],
      correlationId,
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
    if (body.message) {
      await handleMessage(body.message, correlationId);
    } else if (body.callback_query) {
      await handleCallbackQuery(body.callback_query, correlationId);
    } else if (body.inline_query) {
      await handleInlineQuery(body.inline_query, correlationId);
    } else if (body.pre_checkout_query) {
      await handlePreCheckoutQuery(body.pre_checkout_query, correlationId);
    } else {
      logger.warn("Unknown Telegram update type", {
        updateKeys: Object.keys(body),
        correlationId,
      });

      throw new ValidationError("Unknown Telegram update type", {
        updateType: Object.keys(body)[0],
      });
    }

    logger.info("Telegram webhook processed successfully", { correlationId });
    return NextResponse.json({ ok: true });
  } catch (error) {
    logger.error("Error processing Telegram webhook", {
      error: error instanceof Error ? error.message : "Unknown error",
      correlationId,
    });

    throw error;
  }
});

// GET /api/telegram/webhook - Webhook info
export const GET = withErrorHandling(async (req: NextRequest) => {
  const correlationId = req.headers.get("X-Correlation-ID") || "unknown";

  logger.info("Telegram webhook info requested", { correlationId });

  return NextResponse.json({
    status: "active",
    integration: "Telegram 2025",
    features: [
      "mini_app",
      "social_payments",
      "notifications",
      "analytics",
      "quick_swap",
    ],
    timestamp: Date.now(),
  });
});

/**
 * üì± –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
 */
async function handleMessage(message: any, correlationId: string) {
  try {
    const chatId = message.chat.id;
    const userId = message.from.id;
    const text = message.text;

    logger.info("Handling Telegram message", {
      chatId,
      userId,
      textLength: text?.length || 0,
      correlationId,
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
    if (text?.startsWith("/")) {
      await handleCommand(chatId, userId, text, message.from, correlationId);
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    else if (text) {
      await handleTextMessage(
        chatId,
        userId,
        text,
        message.from,
        correlationId
      );
    }
  } catch (error) {
    logger.error("Error handling Telegram message", {
      error: error instanceof Error ? error.message : "Unknown error",
      chatId: message?.chat?.id,
      userId: message?.from?.id,
      correlationId,
    });

    throw error;
  }
}

/**
 * üéØ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
 */
async function handleCommand(
  chatId: number,
  userId: number,
  command: string,
  user: any,
  correlationId: string
) {
  try {
    logger.info("Handling Telegram command", {
      chatId,
      userId,
      command,
      correlationId,
    });

    switch (command) {
      case "/start":
        await telegramIntegration2025.sendTelegramMessage(chatId, {
          text:
            `üöÄ *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ NormalDance DEX!*\n\n` +
            `–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π DEX —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ AMM –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏.\n\n` +
            `*–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:*\n` +
            `/dex - –û—Ç–∫—Ä—ã—Ç—å DEX –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å\n` +
            `/analytics - –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏\n` +
            `/orders - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞–º–∏\n` +
            `/help - –°–ø—Ä–∞–≤–∫–∞\n\n` +
            `*–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ 2025:*\n` +
            `ü§ñ –ò–ò-–ø—Ä–æ–≥–Ω–æ–∑—ã\n` +
            `üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏\n` +
            `‚ö° –ì–∏–±—Ä–∏–¥–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã AMM\n` +
            `üíß –£–º–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞\n` +
            `üìä –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞`,
          parse_mode: "Markdown",
          reply_markup: {
            inline_keyboard: [
              [
                {
                  text: "üöÄ –û—Ç–∫—Ä—ã—Ç—å DEX",
                  web_app: { url: `${process.env.TELEGRAM_WEB_APP_URL}/dex` },
                },
              ],
              [
                {
                  text: "üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞",
                  web_app: {
                    url: `${process.env.TELEGRAM_WEB_APP_URL}/analytics`,
                  },
                },
                {
                  text: "üéØ –û—Ä–¥–µ—Ä–∞",
                  web_app: {
                    url: `${process.env.TELEGRAM_WEB_APP_URL}/dex?tab=orders`,
                  },
                },
              ],
            ],
          },
        });
        break;

      // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

      default:
        logger.warn("Unknown Telegram command", {
          chatId,
          userId,
          command,
          correlationId,
        });

        await telegramIntegration2025.sendTelegramMessage(chatId, {
          text: `‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏.`,
        });
    }
  } catch (error) {
    logger.error("Error handling Telegram command", {
      error: error instanceof Error ? error.message : "Unknown error",
      chatId,
      userId,
      command,
      correlationId,
    });

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    await telegramIntegration2025.sendTelegramMessage(chatId, {
      text: `‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–æ–º–∞–Ω–¥—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.`,
    });

    throw new BusinessLogicError("Failed to handle Telegram command", {
      command,
      chatId,
      userId,
      originalError: error instanceof Error ? error.message : "Unknown error",
    });
  }
}
```

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### –ü—Ä–æ–±–ª–µ–º–∞

–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ Application Performance Monitoring.

#### –†–µ—à–µ–Ω–∏–µ

–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Sentry –∏ DataDog –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –æ—à–∏–±–æ–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```typescript
// src/utils/monitoring.ts
import * as Sentry from "@sentry/nextjs";
import { createLogger } from "./advanced-logger";

const logger = createLogger("monitoring");

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Sentry
export function initSentry() {
  if (process.env.NODE_ENV === "production" && process.env.SENTRY_DSN) {
    Sentry.init({
      dsn: process.env.SENTRY_DSN,
      tracesSampleRate: process.env.SENTRY_TRACES_SAMPLE_RATE
        ? parseFloat(process.env.SENTRY_TRACES_SAMPLE_RATE)
        : 1.0,
      environment: process.env.NODE_ENV,
      release: process.env.NEXT_PUBLIC_APP_VERSION,

      // Integrations
      integrations: [
        // Add profiling integration to get good quality profiling data
        new Sentry.Integrations.Http({ tracing: true }),
        new Sentry.Integrations.Undici(),
      ],
    });

    logger.info("Sentry initialized successfully");
  } else {
    logger.info("Sentry initialization skipped", {
      hasDsn: !!process.env.SENTRY_DSN,
      environment: process.env.NODE_ENV,
    });
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
export function traceTransaction<T>(
  name: string,
  operation: string,
  callback: () => Promise<T>
): Promise<T> {
  return Sentry.startSpan(
    {
      name,
      op: operation,
    },
    async (span) => {
      try {
        logger.info("Starting traced transaction", { name, operation });
        const result = await callback();
        logger.info("Transaction completed successfully", { name, operation });
        return result;
      } catch (error) {
        logger.error("Transaction failed", {
          name,
          operation,
          error: error instanceof Error ? error.message : "Unknown error",
        });

        // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤ Sentry
        Sentry.captureException(error);
        throw error;
      }
    }
  );
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
export function measurePerformance<T>(
  metricName: string,
  callback: () => Promise<T>
): Promise<T> {
  return traceTransaction(metricName, "performance", async () => {
    const startTime = Date.now();

    try {
      const result = await callback();
      const duration = Date.now() - startTime;

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫—É
      logger.metric(metricName, duration);

      // –í production –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ DataDog –∏–ª–∏ –¥—Ä—É–≥—É—é —Å–∏—Å—Ç–µ–º—É
      if (process.env.NODE_ENV === "production") {
        // –ü—Ä–∏–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ DataDog (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
        // datadog.distribution(`performance.${metricName}`, duration);
      }

      return result;
    } catch (error) {
      const duration = Date.now() - startTime;
      logger.metric(`${metricName}.error`, duration);
      throw error;
    }
  });
}

// Middleware –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
export function tracingMiddleware() {
  return (req: any, res: any, next: () => void) => {
    const transaction = Sentry.startTransaction({
      name: `${req.method} ${req.url}`,
      op: "http.server",
    });

    Sentry.getCurrentHub().configureScope((scope) => {
      scope.setSpan(transaction);
    });

    res.on("finish", () => {
      transaction.setHttpStatus(res.statusCode);
      transaction.finish();
    });

    next();
  };
}
```

### 5. –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

#### –ü—Ä–æ–±–ª–µ–º–∞

–ê–ª–µ—Ä—Ç—ã –±–∞–∑–æ–≤—ã–µ, –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

#### –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã —Å –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```yaml
# monitoring/business-alerts.yml
groups:
  - name: normaldance-business-alerts
    rules:
      # –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
      - alert: LowUserEngagement
        expr: rate(user_actions_total[1h]) < 10
        for: 10m
        labels:
          severity: warning
          team: product
        annotations:
          summary: "Low user engagement detected"
          description: "User actions rate is {{ $value }} per hour, below threshold of 10"

      - alert: HighTrackUploadFailureRate
        expr: rate(track_upload_failures_total[5m]) / rate(track_uploads_total[5m]) > 0.05
        for: 5m
        labels:
          severity: critical
          team: backend
        annotations:
          summary: "High track upload failure rate"
          description: "Track upload failure rate is {{ $value | humanizePercentage }}, above threshold of 5%"

      - alert: LowNFTMintingSuccessRate
        expr: rate(nft_minting_success_total[5m]) / rate(nft_minting_attempts_total[5m]) < 0.95
        for: 5m
        labels:
          severity: critical
          team: blockchain
        annotations:
          summary: "Low NFT minting success rate"
          description: "NFT minting success rate is {{ $value | humanizePercentage }}, below threshold of 95%"

      - alert: HighWalletConnectionFailures
        expr: rate(wallet_connection_failures_total[5m]) / rate(wallet_connection_attempts_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
          team: frontend
        annotations:
          summary: "High wallet connection failure rate"
          description: "Wallet connection failure rate is {{ $value | humanizePercentage }}, above threshold of 10%"

      - alert: LowTelegramBotResponseRate
        expr: rate(telegram_messages_sent_total[5m]) / rate(telegram_messages_received_total[5m]) < 0.8
        for: 5m
        labels:
          severity: warning
          team: product
        annotations:
          summary: "Low Telegram bot response rate"
          description: "Telegram bot response rate is {{ $value | humanizePercentage }}, below threshold of 80%"

      # –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
      - alert: AbnormalRevenueDrop
        expr: rate(revenue_usd_total[1h]) < (rate(revenue_usd_total[24h]) * 0.5)
        for: 15m
        labels:
          severity: critical
          team: finance
        annotations:
          summary: "Abnormal revenue drop detected"
          description: "Current revenue rate is {{ $value }} USD/h, significantly below 24h average"

      - alert: HighRefundRate
        expr: rate(refunds_total[1h]) / rate(purchases_total[1h]) > 0.02
        for: 10m
        labels:
          severity: warning
          team: finance
        annotations:
          summary: "High refund rate detected"
          description: "Refund rate is {{ $value | humanizePercentage }}, above threshold of 2%"

      # –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
      - alert: HighDatabaseConnectionLatency
        expr: histogram_quantile(0.95, rate(db_query_duration_seconds_bucket[5m])) > 1
        for: 5m
        labels:
          severity: warning
          team: backend
        annotations:
          summary: "High database connection latency"
          description: "95th percentile database query latency is {{ $value }} seconds, above threshold of 1s"

      - alert: LowCacheHitRatio
        expr: rate(cache_hits_total[5m]) / (rate(cache_hits_total[5m]) + rate(cache_misses_total[5m])) < 0.8
        for: 5m
        labels:
          severity: warning
          team: backend
        annotations:
          summary: "Low cache hit ratio"
          description: "Cache hit ratio is {{ $value | humanizePercentage }}, below threshold of 80%"

      - alert: HighIPFSUploadLatency
        expr: histogram_quantile(0.95, rate(ipfs_upload_duration_seconds_bucket[5m])) > 30
        for: 5m
        labels:
          severity: warning
          team: backend
        annotations:
          summary: "High IPFS upload latency"
          description: "95th percentile IPFS upload latency is {{ $value }} seconds, above threshold of 30s"

      # –ë–ª–æ–∫—á–µ–π–Ω –º–µ—Ç—Ä–∏–∫–∏
      - alert: HighTransactionFailureRate
        expr: rate(blockchain_transactions_failed_total[5m]) / rate(blockchain_transactions_total[5m]) > 0.05
        for: 5m
        labels:
          severity: critical
          team: blockchain
        annotations:
          summary: "High blockchain transaction failure rate"
          description: "Blockchain transaction failure rate is {{ $value | humanizePercentage }}, above threshold of 5%"

      - alert: LowSolanaRPCAvailability
        expr: up{job="solana-rpc"} == 0
        for: 2m
        labels:
          severity: critical
          team: blockchain
        annotations:
          summary: "Solana RPC unavailable"
          description: "Solana RPC endpoint is unavailable"
```

## üìÖ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ù–µ–¥–µ–ª—è 1

- [ ] –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –æ—à–∏–±–æ–∫
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ª–æ–≥–≥–µ—Ä
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ API
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Sentry –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –æ—à–∏–±–æ–∫

### –ù–µ–¥–µ–ª—è 2

- [ ] –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤–æ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫ –ª–æ–≥–∞–º (correlation ID, user ID –∏ —Ç.–¥.)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ù–µ–¥–µ–ª—è 3

- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å DataDog –∏–ª–∏ –¥—Ä—É–≥—É—é —Å–∏—Å—Ç–µ–º—É APM
- [ ] –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã —Å –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∞–º–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–ª–æ–∫—á–µ–π–Ω –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –ù–µ–¥–µ–ª—è 4

- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∞–ª–µ—Ä—Ç—ã –∏ –º–µ—Ç—Ä–∏–∫–∏
- [ ] –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ —Å–∏—Å—Ç–µ–º–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã –≤ Grafana

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ –Ω–∞ 80%
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ Mean Time To Resolution (MTTR) –Ω–∞ 60%
- –ü–æ–≤—ã—à–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è –ª–æ–≥–∞–º–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π –¥–æ 100%
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º–∞—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞ 90%
- –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–∞ 70%

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- Winston –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- Sentry –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –æ—à–∏–±–æ–∫
- DataDog/NewRelic –¥–ª—è APM
- Prometheus –¥–ª—è –º–µ—Ç—Ä–∏–∫
- Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- OpenTelemetry –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
