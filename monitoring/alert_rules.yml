groups:
  - name: normaldance.alerts
    interval: 30s
    rules:

    # üö® Critical Application Alerts
    - alert: ApplicationDown
      expr: up{job="normaldance-app"} == 0
      for: 2m
      labels:
        severity: critical
        service: normaldance
      annotations:
        summary: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ"
        description: "–°–µ—Ä–≤–∏—Å {{ $labels.instance }} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –±–æ–ª–µ–µ 2 –º–∏–Ω—É—Ç"
        runbook_url: "https://docs.normaldance.local/runbooks/application-down"

    - alert: HighErrorRate
      expr: rate(http_requests_total{status_code=~"5.."}[5m]) > 0.1
      for: 3m
      labels:
        severity: critical
        service: normaldance
      annotations:
        summary: "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫ HTTP"
        description: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –æ—à–∏–±–æ–∫ > 10% –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç"
        runbook_url: "https://docs.normaldance.local/runbooks/high-error-rate"

    - alert: HighLatency
      expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 2
      for: 5m
      labels:
        severity: warning
        service: normaldance
      annotations:
        summary: "–í—ã—Å–æ–∫–∞—è latency –∑–∞–ø—Ä–æ—Å–æ–≤"
        description: "95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ > 2 —Å–µ–∫—É–Ω–¥"

    # üóÑÔ∏è Database Alerts
    - alert: DatabaseConnectionFailed
      expr: pg_stat_activity_count == 0
      for: 1m
      labels:
        severity: critical
        service: postgres
      annotations:
        summary: "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
        description: "PostgreSQL –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã"

    - alert: HighDatabaseConnections
      expr: pg_stat_activity_count > 100
      for: 5m
      labels:
        severity: warning
        service: postgres
      annotations:
        summary: "–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"
        description: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π > 100"

    - alert: DatabaseDeadlocks
      expr: increase(pg_stat_database_deadlocks[5m]) > 0
      for: 0m
      labels:
        severity: warning
        service: postgres
      annotations:
        summary: "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –¥–µ–¥–ª–æ–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"
        description: "PostgreSQL –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª –¥–µ–¥–ª–æ–∫–∏"

    # ‚ö° Redis Alerts
    - alert: RedisDown
      expr: up{job="redis"} == 0
      for: 1m
      labels:
        severity: critical
        service: redis
      annotations:
        summary: "Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
        description: "Redis —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"

    - alert: HighRedisMemoryUsage
      expr: redis_memory_used_bytes / redis_memory_max_bytes > 0.8
      for: 5m
      labels:
        severity: warning
        service: redis
      annotations:
        summary: "–í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ Redis"
        description: "Redis –∏—Å–ø–æ–ª—å–∑—É–µ—Ç > 80% –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–∞–º—è—Ç–∏"

    # üåê IPFS Alerts
    - alert: IPFSNodeDown
      expr: up{job="ipfs"} == 0
      for: 3m
      labels:
        severity: critical
        service: ipfs
      annotations:
        summary: "IPFS —É–∑–µ–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
        description: "IPFS —É–∑–µ–ª –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –±–æ–ª–µ–µ 3 –º–∏–Ω—É—Ç"

    - alert: IPFSStorageFull
      expr: ipfs_repo_size > 1000000000000  # 1TB
      for: 10m
      labels:
        severity: warning
        service: ipfs
      annotations:
        summary: "IPFS —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ"
        description: "–†–∞–∑–º–µ—Ä —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è IPFS –ø—Ä–µ–≤—ã—Å–∏–ª 1TB"

    # üìä System Alerts
    - alert: HighCPUUsage
      expr: 100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
      for: 5m
      labels:
        severity: warning
        service: system
      annotations:
        summary: "–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ CPU"
        description: "CPU –Ω–∞–≥—Ä—É–∑–∫–∞ > 80% –Ω–∞ {{ $labels.instance }}"

    - alert: HighMemoryUsage
      expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 85
      for: 5m
      labels:
        severity: warning
        service: system
      annotations:
        summary: "–í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏"
        description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ > 85% –Ω–∞ {{ $labels.instance }}"

    - alert: DiskSpaceLow
      expr: (node_filesystem_avail_bytes / node_filesystem_size_bytes) * 100 < 10
      for: 5m
      labels:
        severity: critical
        service: system
      annotations:
        summary: "–ú–∞–ª–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ"
        description: "–°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ < 10% –Ω–∞ {{ $labels.instance }}"

    # üîí Security Alerts
    - alert: UnauthorizedAccess
      expr: increase(http_requests_total{status_code="401"}[5m]) > 100
      for: 2m
      labels:
        severity: warning
        service: security
      annotations:
        summary: "–ú–Ω–æ–≥–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"
        description: "–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ > 100 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∑–∞ 5 –º–∏–Ω—É—Ç"

    - alert: SuspiciousActivity
      expr: rate(http_requests_total{status_code="403"}[5m]) > 50
      for: 3m
      labels:
        severity: warning
        service: security
      annotations:
        summary: "–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
        description: "–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ > 50 –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∫–æ–¥–æ–º 403 –∑–∞ 5 –º–∏–Ω—É—Ç"

    # üí∞ Blockchain Alerts (Solana)
    - alert: SolanaRPCDown
      expr: up{job="external-services", instance="solana-rpc:8899"} == 0
      for: 2m
      labels:
        severity: critical
        service: solana
      annotations:
        summary: "Solana RPC –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
        description: "Solana RPC —É–∑–µ–ª –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"

    - alert: HighGasPrice
      expr: solana_gas_price > 1000000  # 0.001 SOL
      for: 10m
      labels:
        severity: warning
        service: solana
      annotations:
        summary: "–í—ã—Å–æ–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è Solana"
        description: "–ö–æ–º–∏—Å—Å–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π > 0.001 SOL"

    # üì± Mobile App Alerts
    - alert: MobileAppErrors
      expr: rate(mobile_app_errors_total[5m]) > 10
      for: 5m
      labels:
        severity: warning
        service: mobile
      annotations:
        summary: "–û—à–∏–±–∫–∏ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏"
        description: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ > 10 –∑–∞ 5 –º–∏–Ω—É—Ç"

    # üéµ Music Platform Specific Alerts
    - alert: HighTrackUploadFailures
      expr: rate(track_upload_failures_total[5m]) > 5
      for: 3m
      labels:
        severity: warning
        service: music
      annotations:
        summary: "–û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–∫–æ–≤"
        description: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ —Ç—Ä–µ–∫–æ–≤ > 5 –∑–∞ 5 –º–∏–Ω—É—Ç"

    - alert: NFTCreationFailures
      expr: rate(nft_creation_failures_total[5m]) > 3
      for: 2m
      labels:
        severity: warning
        service: nft
      annotations:
        summary: "–û—à–∏–±–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è NFT"
        description: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∏–π NFT > 3 –∑–∞ 5 –º–∏–Ω—É—Ç"

    - alert: StakingContractErrors
      expr: rate(staking_contract_errors_total[5m]) > 1
      for: 1m
      labels:
        severity: critical
        service: staking
      annotations:
        summary: "–û—à–∏–±–∫–∏ –≤ staking –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ"
        description: "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ staking –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ"

    # üìà Business Metrics Alerts
    - alert: LowUserRegistration
      expr: rate(user_registrations_total[1h]) < 5
      for: 24h
      labels:
        severity: info
        service: business
      annotations:
        summary: "–ù–∏–∑–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
        description: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π < 5 –≤ —á–∞—Å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞"

    - alert: HighChurnRate
      expr: rate(user_churn_total[1h]) / rate(user_registrations_total[1h]) > 0.5
      for: 6h
      labels:
        severity: warning
        service: business
      annotations:
        summary: "–í—ã—Å–æ–∫–∏–π churn rate"
        description: "–û—Ç—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π > 50% –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 —á–∞—Å–æ–≤"