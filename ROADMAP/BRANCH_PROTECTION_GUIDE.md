# Руководство по защите веток

## Обзор

В этом документе описывается конфигурация защиты веток для репозитория NormalDance, включая основные меры безопасности, применяемые к основной ветке `main`.

## Конфигурация защиты ветки main

### Требуемые статус-чеки

Для слияния изменений в ветку `main` требуются следующие проверки:

- `test` - Прохождение всех тестов
- `build` - Успешная сборка проекта
- `security` - Проверка на уязвимости
- `lint` - Проверка стиля кода
- `deploy` - Проверка успешного развертывания

### Проверки код-ревью

- Требуется как минимум 1 одобрение ревью
- Устаревшие ревью автоматически отклоняются
- Требуется ревью владельца кода
- Требуется одобрение последнего пуша

### Дополнительные ограничения

- Администраторы также подчиняются правилам защиты (`enforce_admins: true`)
- Запрещены принудительные пушы (`allow_force_pushes: false`)
- Запрещено удаление ветки (`allow_deletions: false`)

## Конфигурация защиты ветки develop

### Требуемые статус-чеки

Для слияния изменений в ветку `develop` требуются следующие проверки:

- `test` - Прохождение всех тестов
- `build` - Успешная сборка проекта
- `lint` - Проверка стиля кода

### Проверки код-ревью

- Требуется как минимум 1 одобрение ревью
- Устаревшие ревью автоматически отклоняются
- Ревью владельца кода не требуется
- Одобрение последнего пуша не требуется

### Дополнительные ограничения

- Администраторы также подчиняются правилам защиты (`enforce_admins: true`)
- Запрещены принудительные пушы (`allow_force_pushes: false`)
- Запрещено удаление ветки (`allow_deletions: false`)

## Применение изменений

Конфигурация защиты веток определена в файле [.github/settings.yml](.github/settings.yml) и применяется автоматически через GitHub Settings.

## Проверка защиты веток

Для проверки текущей конфигурации защиты веток можно использовать скрипт `scripts/check-branch-protection.sh`:

```bash
chmod +x scripts/check-branch-protection.sh
./scripts/check-branch-protection.sh
```

## Важность защиты основной ветки

Защита основной ветки критически важна для стабильности проекта, поскольку:

1. Она предотвращает случайное или злонамеренное изменение критически важного кода
2. Обеспечивает обязательное прохождение проверок качества и безопасности
3. Требует одобрения изменений другими разработчиками
4. Поддерживает целостность истории коммитов

## Восстановление после ошибок

В случае необходимости отката изменений в защищенной ветке:

1. Создайте новую ветку с исправлениями
2. Пройдите все необходимые проверки
3. Получите одобрение код-ревью
4. Слейте изменения через pull request
