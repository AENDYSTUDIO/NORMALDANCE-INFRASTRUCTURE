# NORMAL DANCE - Структура Проекта

## Организация Корневой Директории

### Основное Приложение
- **`src/`** - Основной исходный код приложения
  - **`app/`** - Страницы и макеты Next.js App Router
  - **`components/`** - Переиспользуемые React компоненты, организованные по функциям
  - **`lib/`** - Утилитарные библиотеки и интеграции сервисов
  - **`hooks/`** - Пользовательские React хуки
  - **`store/`** - Управление состоянием (Zustand)
  - **`types/`** - Определения типов TypeScript
  - **`workers/`** - Web Workers для обработки аудио

### Блокчейн Программы
- **`programs/`** - Программы блокчейна Solana (Rust)
  - **`ndt/`** - Программа токена NDT
  - **`staking/`** - Программа стейкинг наград
  - **`tracknft/`** - Программа музыкальных NFT
  - **`royalty-distribution/`** - Система роялти артистов

### Мобильные Приложения
- **`mobile-app/`** - Мобильное приложение React Native
- **`telegram-mini-app/`** - Реализация Telegram Mini App

### Инфраструктура и DevOps
- **`k8s/`** - Конфигурации развертывания Kubernetes
- **`helm/`** - Helm чарты для оркестрации контейнеров
- **`monitoring/`** - Настройка Prometheus, Grafana и алертинга
- **`nginx/`** - Обратный прокси и SSL конфигурации
- **`scripts/`** - Скрипты автоматизации и развертывания

### Документация и Руководства
- **`docs/`** - Комплексная документация проекта
- **`ROADMAP/`** - Дорожные карты разработки и планирование
- **`grants/`** - Заявки на гранты и документация финансирования

## Архитектура Исходного Кода (`src/`)

### Структура Приложения (`app/`)
```
app/
├── (landing)/          # Группа лендинг страницы
├── admin/             # Админ панель
├── api/               # API маршруты
├── auth/              # Страницы аутентификации
├── grave/             # Мемориальная система
├── nft/               # NFT маркетплейс
├── profile/           # Профили пользователей
├── tracks/            # Музыкальный стриминг
├── upload/            # Загрузка музыки
├── wallet/            # Интеграция кошелька
└── telegram-app/      # Telegram Mini App
```

### Организация Компонентов (`components/`)
```
components/
├── ui/                # Базовые UI компоненты (Radix UI)
├── audio/             # Аудио плеер и элементы управления
├── wallet/            # Компоненты подключения кошелька
├── nft/               # Компоненты NFT маркетплейса
├── staking/           # Интерфейс стейкинга
├── grave/             # Компоненты мемориальной системы
├── telegram/          # Telegram-специфичные компоненты
├── auth/              # Компоненты аутентификации
├── music/             # Музыкально-связанные компоненты
└── layout/            # Макет и навигация
```

### Библиотечные Сервисы (`lib/`)
```
lib/
├── web3/              # Блокчейн интеграции
├── ipfs-helia-adapter.ts    # Сервис хранения IPFS
├── solana-pay.ts      # Интеграция платежей Solana
├── ton-connect-service.ts   # Сервис блокчейна TON
├── telegram-auth.ts   # Аутентификация Telegram
├── db.ts              # Подключение к базе данных
├── auth.ts            # Логика аутентификации
└── utils.ts           # Утилитарные функции
```

## Ключевые Архитектурные Паттерны

### Фронтенд Архитектура
- **Next.js App Router**: Современная маршрутизация с серверными компонентами
- **Компонентная Основа**: Модульные React компоненты с TypeScript
- **Управление Состоянием**: Zustand для глобального состояния, React хуки для локального
- **UI Фреймворк**: Примитивы Radix UI со стилизацией Tailwind CSS
- **Реальное Время**: Socket.IO для живых обновлений и уведомлений

### Бэкенд Архитектура
- **API Маршруты**: API маршруты Next.js для серверной логики
- **База Данных**: Prisma ORM с SQLite/PostgreSQL
- **Аутентификация**: NextAuth.js с интеграцией Web3 кошельков
- **Файловое Хранение**: IPFS/Filecoin для децентрализованного хранения
- **Кэширование**: Redis для сессий и кэширования данных

### Блокчейн Архитектура
- **Мульти-Блокчейн**: Solana (основной) и TON (интеграция Telegram)
- **Смарт-Контракты**: Rust программы для Solana, TypeScript для TON
- **Интеграция Кошельков**: Phantom (Solana), TON Connect (TON)
- **Стандарты Токенов**: SPL токены на Solana, Jettons на TON

### Мобильная Архитектура
- **React Native**: Кроссплатформенное мобильное приложение
- **Telegram Mini App**: Веб-приложение внутри Telegram
- **Общие Компоненты**: Переиспользуемые компоненты на всех платформах
- **Нативные Интеграции**: Платформо-специфичные функции и API

## Архитектура Потока Данных

### Поток Загрузки Музыки
1. **Фронтенд**: Пользователь выбирает аудио файл
2. **Обработка**: Web Worker обрабатывает метаданные аудио
3. **Хранение**: Файл загружается в IPFS через адаптер Helia
4. **Блокчейн**: Метаданные сохраняются в Solana как NFT
5. **База Данных**: Информация о треке кэшируется в базе данных Prisma

### Поток Стриминга
1. **Запрос**: Пользователь запрашивает воспроизведение трека
2. **Разрешение**: IPFS хэш разрешается через множественные шлюзы
3. **Доставка**: Аудио стримится с прогрессивной загрузкой
4. **Аналитика**: Метрики воспроизведения отслеживаются и сохраняются

### Поток Платежей
1. **Инициация**: Пользователь инициирует платеж (Solana Pay/TON)
2. **Валидация**: Смарт-контракт валидирует транзакцию
3. **Обработка**: Токены переводятся и комиссии распределяются
4. **Подтверждение**: Транзакция подтверждается и UI обновляется

## Архитектура Безопасности

### Слои Аутентификации
- **Аутентификация Кошелька**: Криптографическая верификация подписи
- **Управление Сессиями**: JWT токены с безопасным хранением
- **Защита API**: Ограничение скорости и валидация запросов
- **CSRF Защита**: Предотвращение межсайтовой подделки запросов

### Защита Данных
- **Шифрование**: Чувствительные данные зашифрованы в покое и при передаче
- **Контроль Доступа**: Система разрешений на основе ролей
- **Аудит Логирование**: Комплексное логирование активности
- **Стратегия Резервного Копирования**: Автоматические резервные копии с шифрованием

## Архитектура Развертывания

### Продакшен Окружение
- **Vercel**: Основная платформа хостинга для веб-приложения
- **Kubernetes**: Оркестрация контейнеров для бэкенд сервисов
- **CDN**: Глобальная доставка контента для статических ресурсов
- **Мониторинг**: Prometheus/Grafana для системного мониторинга

### Окружение Разработки
- **Локальная Разработка**: Docker Compose для локальных сервисов
- **Тестирование**: Jest для юнит тестов, Playwright для E2E
- **CI/CD**: GitHub Actions для автоматизированного тестирования и развертывания
- **Качественные Ворота**: ESLint, TypeScript и сканирование безопасности