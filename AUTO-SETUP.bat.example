@echo off
chcp 65001 >nul
echo ============================================
echo    АВТОМАТИЧЕСКИЙ SETUP (EXAMPLE)
echo ============================================
echo.
echo ⚠️  ИНСТРУКЦИЯ:
echo 1. Скопируйте этот файл в AUTO-SETUP.bat
echo 2. Замените YOUR_SERVER_IP и YOUR_PASSWORD на реальные значения
echo 3. НИКОГДА не коммитьте AUTO-SETUP.bat с реальными данными!
echo.

set SERVER=YOUR_SERVER_IP
set PASSWORD=YOUR_PASSWORD

echo 📡 Настройка SSH ключа...
for /f "delims=" %%i in ('type C:\Users\AENDY\.ssh\id_ed25519.pub') do set PUBKEY=%%i

echo 🔧 Копирование ключа на сервер...
plink -batch -pw %PASSWORD% root@%SERVER% "mkdir -p ~/.ssh && echo %PUBKEY% >> ~/.ssh/authorized_keys && chmod 700 ~/.ssh && chmod 600 ~/.ssh/authorized_keys && echo ✅ SSH ключ установлен"

echo.
echo 📦 Создание сервера на удалённой машине...
plink -batch -pw %PASSWORD% root@%SERVER% "cd /var/www/normaldance && cat > server.js << 'ENDFILE'
const http = require('http');
http.createServer((req, res) => {
  res.writeHead(200, {'Content-Type': 'text/html; charset=utf-8'});
  res.end('<!DOCTYPE html><html><head><meta charset=\"utf-8\"><title>NORMALDANCE</title><style>body{margin:0;padding:50px;font-family:Arial;text-align:center;background:linear-gradient(135deg,#667eea,#764ba2);color:white;min-height:100vh}h1{font-size:4em}p{font-size:1.5em}</style></head><body><h1>🎵 NORMALDANCE</h1><p>normaldance.ru | normaldance.online</p><p>✅ Сервер работает!</p></body></html>');
}).listen(3000, '0.0.0.0', () => console.log('✅ NORMALDANCE running on :3000'));
ENDFILE
pm2 delete normaldance 2>/dev/null || true && pm2 start server.js --name normaldance && pm2 save && ufw allow 3000 && pm2 list"

echo.
echo ============================================
echo ✅ ГОТОВО!
echo ============================================
echo.
echo 🌍 Открывай: http://%SERVER%:3000
echo.
echo 📊 Статус: pm2 status
echo 📋 Логи: pm2 logs normaldance
echo.
pause
